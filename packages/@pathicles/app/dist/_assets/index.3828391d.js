function e(e,t){const n=Object.create(null),i=e.split(",");for(let e=0;e<i.length;e++)n[i[e]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}const t=e("Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl"),n=e("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function i(e){if(M(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],r=i(A(o)?a(o):o);if(r)for(const e in r)t[e]=r[e]}return t}if(z(e))return e}const o=/;(?![^(]*\))/g,r=/:(.+)/;function a(e){const t={};return e.split(o).forEach(e=>{if(e){const n=e.split(r);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function s(e){let t="";if(A(e))t=e;else if(M(e))for(let n=0;n<e.length;n++)t+=s(e[n])+" ";else if(z(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function l(e,t){if(e===t)return!0;let n=E(e),i=E(t);if(n||i)return!(!n||!i)&&e.getTime()===t.getTime();if(n=M(e),i=M(t),n||i)return!(!n||!i)&&function(e,t){if(e.length!==t.length)return!1;let n=!0;for(let i=0;n&&i<e.length;i++)n=l(e[i],t[i]);return n}(e,t);if(n=z(e),i=z(t),n||i){if(!n||!i)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e){const i=e.hasOwnProperty(n),o=t.hasOwnProperty(n);if(i&&!o||!i&&o||!l(e[n],t[n]))return!1}}return String(e)===String(t)}function c(e,t){return e.findIndex(e=>l(e,t))}function u(e,t){for(let n of e)if(l(n,t))return!0;return!1}const h=e=>null==e?"":z(e)?JSON.stringify(e,f,2):String(e),f=(e,t)=>P(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,n])=>(e[t+" =>"]=n,e),{})}:S(t)?{[`Set(${t.size})`]:[...t.values()]}:!z(t)||M(t)||D(t)?t:String(t),d={},p=[],m=()=>{},v=()=>!1,g=/^on[^a-z]/,y=e=>g.test(e),b=e=>e.startsWith("onUpdate:"),w=Object.assign,x=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},_=Object.prototype.hasOwnProperty,C=(e,t)=>_.call(e,t),M=Array.isArray,P=e=>"[object Map]"===L(e),S=e=>"[object Set]"===L(e),E=e=>e instanceof Date,T=e=>"function"==typeof e,A=e=>"string"==typeof e,O=e=>"symbol"==typeof e,z=e=>null!==e&&"object"==typeof e,R=e=>z(e)&&T(e.then)&&T(e.catch),F=Object.prototype.toString,L=e=>F.call(e),D=e=>"[object Object]"===L(e),k=e=>A(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,N=e("key,ref,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),I=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},W=/-(\w)/g,V=I(e=>e.replace(W,(e,t)=>t?t.toUpperCase():"")),B=/\B([A-Z])/g,G=I(e=>e.replace(B,"-$1").toLowerCase()),Y=I(e=>e.charAt(0).toUpperCase()+e.slice(1)),j=(e,t)=>e!==t&&(e==e||t==t),X=(e,t)=>{for(let n=0;n<e.length;n++)e[n](t)},H=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})},U=new WeakMap,q=[];let Z;const $=Symbol(""),J=Symbol("");function Q(e,t=d){(function(e){return e&&!0===e._isEffect})(e)&&(e=e.raw);const n=function(e,t){const n=function(){if(!n.active)return t.scheduler?void 0:e();if(!q.includes(n)){te(n);try{return re(),q.push(n),Z=n,e()}finally{q.pop(),ae(),Z=q[q.length-1]}}};return n.id=ee++,n._isEffect=!0,n.active=!0,n.raw=e,n.deps=[],n.options=t,n}(e,t);return t.lazy||n(),n}function K(e){e.active&&(te(e),e.options.onStop&&e.options.onStop(),e.active=!1)}let ee=0;function te(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let ne=!0;const ie=[];function oe(){ie.push(ne),ne=!1}function re(){ie.push(ne),ne=!0}function ae(){const e=ie.pop();ne=void 0===e||e}function se(e,t,n){if(!ne||void 0===Z)return;let i=U.get(e);i||U.set(e,i=new Map);let o=i.get(n);o||i.set(n,o=new Set),o.has(Z)||(o.add(Z),Z.deps.push(o))}function le(e,t,n,i,o,r){const a=U.get(e);if(!a)return;const s=new Set,l=e=>{e&&e.forEach(e=>{(e!==Z||e.options.allowRecurse)&&s.add(e)})};if("clear"===t)a.forEach(l);else if("length"===n&&M(e))a.forEach((e,t)=>{("length"===t||t>=i)&&l(e)});else switch(void 0!==n&&l(a.get(n)),t){case"add":M(e)?k(n)&&l(a.get("length")):(l(a.get($)),P(e)&&l(a.get(J)));break;case"delete":M(e)||(l(a.get($)),P(e)&&l(a.get(J)));break;case"set":P(e)&&l(a.get($))}s.forEach(e=>{e.options.scheduler?e.options.scheduler(e):e()})}const ce=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(O)),ue=me(),he=me(!1,!0),fe=me(!0),de=me(!0,!0),pe={};function me(e=!1,t=!1){return function(n,i,o){if("__v_isReactive"===i)return!e;if("__v_isReadonly"===i)return e;if("__v_raw"===i&&o===(e?Ge:Be).get(n))return n;const r=M(n);if(r&&C(pe,i))return Reflect.get(pe,i,o);const a=Reflect.get(n,i,o);if(O(i)?ce.has(i):"__proto__"===i||"__v_isRef"===i)return a;if(e||se(n,0,i),t)return a;if(Qe(a)){return!r||!k(i)?a.value:a}return z(a)?e?Xe(a):je(a):a}}["includes","indexOf","lastIndexOf"].forEach(e=>{const t=Array.prototype[e];pe[e]=function(...e){const n=$e(this);for(let e=0,t=this.length;e<t;e++)se(n,0,e+"");const i=t.apply(n,e);return-1===i||!1===i?t.apply(n,e.map($e)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{const t=Array.prototype[e];pe[e]=function(...e){oe();const n=t.apply(this,e);return re(),n}});function ve(e=!1){return function(t,n,i,o){const r=t[n];if(!e&&(i=$e(i),!M(t)&&Qe(r)&&!Qe(i)))return r.value=i,!0;const a=M(t)&&k(n)?Number(n)<t.length:C(t,n),s=Reflect.set(t,n,i,o);return t===$e(o)&&(a?j(i,r)&&le(t,"set",n,i):le(t,"add",n,i)),s}}const ge={get:ue,set:ve(),deleteProperty:function(e,t){const n=C(e,t),i=(e[t],Reflect.deleteProperty(e,t));return i&&n&&le(e,"delete",t,void 0),i},has:function(e,t){const n=Reflect.has(e,t);return O(t)&&ce.has(t)||se(e,0,t),n},ownKeys:function(e){return se(e,0,$),Reflect.ownKeys(e)}},ye={get:fe,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},be=w({},ge,{get:he,set:ve(!0)}),we=(w({},ye,{get:de}),e=>z(e)?je(e):e),xe=e=>z(e)?Xe(e):e,_e=e=>e,Ce=e=>Reflect.getPrototypeOf(e);function Me(e,t,n=!1,i=!1){const o=$e(e=e.__v_raw),r=$e(t);t!==r&&!n&&se(o,0,t),!n&&se(o,0,r);const{has:a}=Ce(o),s=n?xe:i?_e:we;return a.call(o,t)?s(e.get(t)):a.call(o,r)?s(e.get(r)):void 0}function Pe(e,t=!1){const n=this.__v_raw,i=$e(n),o=$e(e);return e!==o&&!t&&se(i,0,e),!t&&se(i,0,o),e===o?n.has(e):n.has(e)||n.has(o)}function Se(e,t=!1){return e=e.__v_raw,!t&&se($e(e),0,$),Reflect.get(e,"size",e)}function Ee(e){e=$e(e);const t=$e(this),n=Ce(t).has.call(t,e),i=t.add(e);return n||le(t,"add",e,e),i}function Te(e,t){t=$e(t);const n=$e(this),{has:i,get:o}=Ce(n);let r=i.call(n,e);r||(e=$e(e),r=i.call(n,e));const a=o.call(n,e),s=n.set(e,t);return r?j(t,a)&&le(n,"set",e,t):le(n,"add",e,t),s}function Ae(e){const t=$e(this),{has:n,get:i}=Ce(t);let o=n.call(t,e);o||(e=$e(e),o=n.call(t,e));i&&i.call(t,e);const r=t.delete(e);return o&&le(t,"delete",e,void 0),r}function Oe(){const e=$e(this),t=0!==e.size,n=e.clear();return t&&le(e,"clear",void 0,void 0),n}function ze(e,t){return function(n,i){const o=this,r=o.__v_raw,a=$e(r),s=e?xe:t?_e:we;return!e&&se(a,0,$),r.forEach((e,t)=>n.call(i,s(e),s(t),o))}}function Re(e,t,n){return function(...i){const o=this.__v_raw,r=$e(o),a=P(r),s="entries"===e||e===Symbol.iterator&&a,l="keys"===e&&a,c=o[e](...i),u=t?xe:n?_e:we;return!t&&se(r,0,l?J:$),{next(){const{value:e,done:t}=c.next();return t?{value:e,done:t}:{value:s?[u(e[0]),u(e[1])]:u(e),done:t}},[Symbol.iterator](){return this}}}}function Fe(e){return function(...t){return"delete"!==e&&this}}const Le={get(e){return Me(this,e)},get size(){return Se(this)},has:Pe,add:Ee,set:Te,delete:Ae,clear:Oe,forEach:ze(!1,!1)},De={get(e){return Me(this,e,!1,!0)},get size(){return Se(this)},has:Pe,add:Ee,set:Te,delete:Ae,clear:Oe,forEach:ze(!1,!0)},ke={get(e){return Me(this,e,!0)},get size(){return Se(this,!0)},has(e){return Pe.call(this,e,!0)},add:Fe("add"),set:Fe("set"),delete:Fe("delete"),clear:Fe("clear"),forEach:ze(!0,!1)};function Ne(e,t){const n=t?De:e?ke:Le;return(t,i,o)=>"__v_isReactive"===i?!e:"__v_isReadonly"===i?e:"__v_raw"===i?t:Reflect.get(C(n,i)&&i in t?n:t,i,o)}["keys","values","entries",Symbol.iterator].forEach(e=>{Le[e]=Re(e,!1,!1),ke[e]=Re(e,!0,!1),De[e]=Re(e,!1,!0)});const Ie={get:Ne(!1,!1)},We={get:Ne(!1,!0)},Ve={get:Ne(!0,!1)},Be=new WeakMap,Ge=new WeakMap;function Ye(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((e=>L(e).slice(8,-1))(e))}function je(e){return e&&e.__v_isReadonly?e:He(e,!1,ge,Ie)}function Xe(e){return He(e,!0,ye,Ve)}function He(e,t,n,i){if(!z(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const o=t?Ge:Be,r=o.get(e);if(r)return r;const a=Ye(e);if(0===a)return e;const s=new Proxy(e,2===a?i:n);return o.set(e,s),s}function Ue(e){return qe(e)?Ue(e.__v_raw):!(!e||!e.__v_isReactive)}function qe(e){return!(!e||!e.__v_isReadonly)}function Ze(e){return Ue(e)||qe(e)}function $e(e){return e&&$e(e.__v_raw)||e}const Je=e=>z(e)?je(e):e;function Qe(e){return Boolean(e&&!0===e.__v_isRef)}class Ke{constructor(e,t=!1){this._rawValue=e,this._shallow=t,this.__v_isRef=!0,this._value=t?e:Je(e)}get value(){return se($e(this),0,"value"),this._value}set value(e){j($e(e),this._rawValue)&&(this._rawValue=e,this._value=this._shallow?e:Je(e),le($e(this),"set","value",e))}}function et(e,t=!1){return Qe(e)?e:new Ke(e,t)}function tt(e){return Qe(e)?e.value:e}const nt={get:(e,t,n)=>tt(Reflect.get(e,t,n)),set:(e,t,n,i)=>{const o=e[t];return Qe(o)&&!Qe(n)?(o.value=n,!0):Reflect.set(e,t,n,i)}};class it{constructor(e,t,n){this._setter=t,this._dirty=!0,this.__v_isRef=!0,this.effect=Q(e,{lazy:!0,scheduler:()=>{this._dirty||(this._dirty=!0,le($e(this),"set","value"))}}),this.__v_isReadonly=n}get value(){return this._dirty&&(this._value=this.effect(),this._dirty=!1),se($e(this),0,"value"),this._value}set value(e){this._setter(e)}}function ot(e,t,n,i){let o;try{o=i?e(...i):e()}catch(e){at(e,t,n)}return o}function rt(e,t,n,i){if(T(e)){const o=ot(e,t,n,i);return o&&R(o)&&o.catch(e=>{at(e,t,n)}),o}const o=[];for(let r=0;r<e.length;r++)o.push(rt(e[r],t,n,i));return o}function at(e,t,n,i=!0){t&&t.vnode;if(t){let i=t.parent;const o=t.proxy,r=n;for(;i;){const t=i.ec;if(t)for(let n=0;n<t.length;n++)if(t[n](e,o,r))return;i=i.parent}const a=t.appContext.config.errorHandler;if(a)return void ot(a,null,10,[e,o,r])}!function(e,t,n,i=!0){console.error(e)}(e,0,0,i)}let st=!1,lt=!1;const ct=[];let ut=0;const ht=[];let ft=null,dt=0;const pt=[];let mt=null,vt=0;const gt=Promise.resolve();let yt=null,bt=null;function wt(e){const t=yt||gt;return e?t.then(e):t}function xt(e){ct.length&&ct.includes(e,st&&e.allowRecurse?ut+1:ut)||e===bt||(ct.push(e),_t())}function _t(){st||lt||(lt=!0,yt=gt.then(Et))}function Ct(e,t,n,i){M(e)?n.push(...e):t&&t.includes(e,e.allowRecurse?i+1:i)||n.push(e),_t()}function Mt(e,t=null){if(ht.length){for(bt=t,ft=[...new Set(ht)],ht.length=0,dt=0;dt<ft.length;dt++)ft[dt]();ft=null,dt=0,bt=null,Mt(e,t)}}function Pt(e){if(pt.length){const e=[...new Set(pt)];if(pt.length=0,mt)return void mt.push(...e);for(mt=e,mt.sort((e,t)=>St(e)-St(t)),vt=0;vt<mt.length;vt++)mt[vt]();mt=null,vt=0}}const St=e=>null==e.id?1/0:e.id;function Et(e){lt=!1,st=!0,Mt(e),ct.sort((e,t)=>St(e)-St(t));try{for(ut=0;ut<ct.length;ut++){const e=ct[ut];e&&ot(e,null,14)}}finally{ut=0,ct.length=0,Pt(),st=!1,yt=null,(ct.length||pt.length)&&Et(e)}}function Tt(e,t,...n){const i=e.vnode.props||d;let o="on"+Y(t),r=i[o];if(!r&&t.startsWith("update:")&&(o="on"+Y(G(t)),r=i[o]),!r)if(r=i[o+"Once"],e.emitted){if(e.emitted[o])return}else(e.emitted={})[o]=!0;r&&rt(r,e,6,n)}function At(e,t,n=!1){const i=t.app?t.app._uid:-1,o=e.__emits||(e.__emits={}),r=o[i];if(void 0!==r)return r;const a=e.emits;let s={},l=!1;if(!T(e)){const i=e=>{l=!0,w(s,At(e,t,!0))};!n&&t.mixins.length&&t.mixins.forEach(i),e.extends&&i(e.extends),e.mixins&&e.mixins.forEach(i)}return a||l?(M(a)?a.forEach(e=>s[e]=null):w(s,a),o[i]=s):o[i]=null}function Ot(e,t){return!(!e||!y(t))&&(t=t.replace(/Once$/,""),C(e,t[2].toLowerCase()+t.slice(3))||C(e,t.slice(2)))}let zt=null;function Rt(e){zt=e}function Ft(e){const{type:t,vnode:n,proxy:i,withProxy:o,props:r,propsOptions:[a],slots:s,attrs:l,emit:c,render:u,renderCache:h,data:f,setupState:d,ctx:p}=e;let m;zt=e;try{let e;if(4&n.shapeFlag){const t=o||i;m=ln(u.call(t,t,h,r,d,f,p)),e=l}else{const n=t;0,m=ln(n.length>1?n(r,{attrs:l,slots:s,emit:c}):n(r,null)),e=t.props?l:Dt(l)}let v=m;if(!1!==t.inheritAttrs&&e){const t=Object.keys(e),{shapeFlag:n}=v;t.length&&(1&n||6&n)&&(a&&t.some(b)&&(e=kt(e,a)),v=rn(v,e))}n.dirs&&(v.dirs=n.dirs),n.transition&&(v.transition=n.transition),m=v}catch(t){at(t,e,1),m=on(Ht)}return zt=null,m}function Lt(e){const t=e.filter(e=>!(Kt(e)&&e.type===Ht&&"v-if"!==e.children));return 1===t.length&&Kt(t[0])?t[0]:null}const Dt=e=>{let t;for(const n in e)("class"===n||"style"===n||y(n))&&((t||(t={}))[n]=e[n]);return t},kt=(e,t)=>{const n={};for(const i in e)b(i)&&i.slice(9)in t||(n[i]=e[i]);return n};function Nt(e,t,n){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let o=0;o<i.length;o++){const r=i[o];if(t[r]!==e[r]&&!Ot(n,r))return!0}return!1}function It(e){if(T(e)&&(e=e()),M(e)){e=Lt(e)}return ln(e)}let Wt=0;const Vt=e=>Wt+=e;function Bt(e){return function(e,t,n=!0){const i=zt||di;if(i){const n=i.type;if("components"===e){const e=n.displayName||n.name;if(e&&(e===t||e===V(t)||e===Y(V(t))))return n}return Yt(i[e]||n[e],t)||Yt(i.appContext[e],t)}}("components",e)||e}const Gt=Symbol();function Yt(e,t){return e&&(e[t]||e[V(t)]||e[Y(V(t))])}const jt=Symbol(void 0),Xt=Symbol(void 0),Ht=Symbol(void 0),Ut=Symbol(void 0),qt=[];let Zt=null;function $t(e=!1){qt.push(Zt=e?null:[])}function Jt(){qt.pop(),Zt=qt[qt.length-1]||null}function Qt(e,t,n,i,o){const r=on(e,t,n,i,o,!0);return r.dynamicChildren=Zt||p,Jt(),Zt&&Zt.push(r),r}function Kt(e){return!!e&&!0===e.__v_isVNode}function en(e,t){return e.type===t.type&&e.key===t.key}const tn=({key:e})=>null!=e?e:null,nn=({ref:e})=>null!=e?M(e)?e:{i:zt,r:e}:null,on=function(e,t=null,n=null,o=0,r=null,a=!1){e&&e!==Gt||(e=Ht);if(Kt(e)){const i=rn(e,t,!0);return n&&un(i,n),i}l=e,T(l)&&"__vccOpts"in l&&(e=e.__vccOpts);var l;if(t){(Ze(t)||"__vInternal"in t)&&(t=w({},t));let{class:e,style:n}=t;e&&!A(e)&&(t.class=s(e)),z(n)&&(Ze(n)&&!M(n)&&(n=w({},n)),t.style=i(n))}const c=A(e)?1:(e=>e.__isSuspense)(e)?128:(e=>e.__isTeleport)(e)?64:z(e)?4:T(e)?2:0,u={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&tn(t),ref:t&&nn(t),scopeId:null,children:null,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:c,patchFlag:o,dynamicProps:r,dynamicChildren:null,appContext:null};if(un(u,n),128&c){const{content:e,fallback:t}=function(e){const{shapeFlag:t,children:n}=e;let i,o;return 32&t?(i=It(n.default),o=It(n.fallback)):(i=It(n),o=ln(null)),{content:i,fallback:o}}(u);u.ssContent=e,u.ssFallback=t}!a&&Zt&&(o>0||6&c)&&32!==o&&Zt.push(u);return u};function rn(e,t,n=!1){const{props:o,ref:r,patchFlag:a}=e,l=t?function(...e){const t=w({},e[0]);for(let n=1;n<e.length;n++){const o=e[n];for(const e in o)if("class"===e)t.class!==o.class&&(t.class=s([t.class,o.class]));else if("style"===e)t.style=i([t.style,o.style]);else if(y(e)){const n=t[e],i=o[e];n!==i&&(t[e]=n?[].concat(n,o[e]):i)}else t[e]=o[e]}return t}(o||{},t):o;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&tn(l),ref:t&&t.ref?n&&r?M(r)?r.concat(nn(t)):[r,nn(t)]:nn(t):r,scopeId:e.scopeId,children:e.children,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==jt?-1===a?16:16|a:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&rn(e.ssContent),ssFallback:e.ssFallback&&rn(e.ssFallback),el:e.el,anchor:e.anchor}}function an(e=" ",t=0){return on(Xt,null,e,t)}function sn(e="",t=!1){return t?($t(),Qt(Ht,null,e)):on(Ht,null,e)}function ln(e){return null==e||"boolean"==typeof e?on(Ht):M(e)?on(jt,null,e):"object"==typeof e?null===e.el?e:rn(e):on(Xt,null,String(e))}function cn(e){return null===e.el?e:rn(e)}function un(e,t){let n=0;const{shapeFlag:i}=e;if(null==t)t=null;else if(M(t))n=16;else if("object"==typeof t){if(1&i||64&i){const n=t.default;return void(n&&(n._c&&Vt(1),un(e,n()),n._c&&Vt(-1)))}{n=32;const i=t._;i||"__vInternal"in t?3===i&&zt&&(1024&zt.vnode.patchFlag?(t._=2,e.patchFlag|=1024):t._=1):t._ctx=zt}}else T(t)?(t={default:t,_ctx:zt},n=32):(t=String(t),64&i?(n=16,t=[an(t)]):n=8);e.children=t,e.shapeFlag|=n}function hn(e,t,n,i=!1){const o={},r={};H(r,"__vInternal",1),fn(e,t,o,r),n?e.props=i?o:He(o,!1,be,We):e.type.props?e.props=o:e.props=r,e.attrs=r}function fn(e,t,n,i){const[o,r]=e.propsOptions;if(t)for(const r in t){const a=t[r];if(N(r))continue;let s;o&&C(o,s=V(r))?n[s]=a:Ot(e.emitsOptions,r)||(i[r]=a)}if(r){const t=$e(n);for(let i=0;i<r.length;i++){const a=r[i];n[a]=dn(o,t,a,t[a],e)}}}function dn(e,t,n,i,o){const r=e[n];if(null!=r){const e=C(r,"default");if(e&&void 0===i){const e=r.default;r.type!==Function&&T(e)?(pi(o),i=e(t),pi(null)):i=e}r[0]&&(C(t,n)||e?!r[1]||""!==i&&i!==G(n)||(i=!0):i=!1)}return i}function pn(e,t,n=!1){const i=t.app?t.app._uid:-1,o=e.__props||(e.__props={}),r=o[i];if(r)return r;const a=e.props,s={},l=[];let c=!1;if(!T(e)){const i=e=>{c=!0;const[n,i]=pn(e,t,!0);w(s,n),i&&l.push(...i)};!n&&t.mixins.length&&t.mixins.forEach(i),e.extends&&i(e.extends),e.mixins&&e.mixins.forEach(i)}if(!a&&!c)return o[i]=p;if(M(a))for(let e=0;e<a.length;e++){const t=V(a[e]);yn(t)&&(s[t]=d)}else if(a)for(const e in a){const t=V(e);if(yn(t)){const n=a[e],i=s[t]=M(n)||T(n)?{type:n}:n;if(i){const e=gn(Boolean,i.type),n=gn(String,i.type);i[0]=e>-1,i[1]=n<0||e<n,(e>-1||C(i,"default"))&&l.push(t)}}}return o[i]=[s,l]}function mn(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function vn(e,t){return mn(e)===mn(t)}function gn(e,t){if(M(t)){for(let n=0,i=t.length;n<i;n++)if(vn(t[n],e))return n}else if(T(t))return vn(t,e)?0:-1;return-1}function yn(e){return"$"!==e[0]}function bn(e,t,n=di,i=!1){if(n){const o=n[e]||(n[e]=[]),r=t.__weh||(t.__weh=(...i)=>{if(n.isUnmounted)return;oe(),pi(n);const o=rt(t,n,e,i);return pi(null),ae(),o});return i?o.unshift(r):o.push(r),r}}const wn=e=>(t,n=di)=>!mi&&bn(e,t,n),xn=wn("bm"),_n=wn("m"),Cn=wn("bu"),Mn=wn("u"),Pn=wn("bum"),Sn=wn("um"),En=wn("rtg"),Tn=wn("rtc"),An=e=>e.type.__isKeepAlive;function On(e,t,n=di){const i=e.__wdc||(e.__wdc=()=>{let t=n;for(;t;){if(t.isDeactivated)return;t=t.parent}e()});if(bn(t,i,n),n){let e=n.parent;for(;e&&e.parent;)An(e.parent.vnode)&&zn(i,t,n,e),e=e.parent}}function zn(e,t,n,i){const o=bn(t,e,i,!0);Sn(()=>{x(i[t],o)},n)}const Rn=e=>"_"===e[0]||"$stable"===e,Fn=e=>M(e)?e.map(ln):[ln(e)],Ln=(e,t,n)=>function(e,t=zt){if(!t)return e;const n=(...n)=>{Wt||$t(!0);const i=zt;Rt(t);const o=e(...n);return Rt(i),Wt||Jt(),o};return n._c=!0,n}(e=>Fn(t(e)),n),Dn=(e,t)=>{const n=e._ctx;for(const i in e){if(Rn(i))continue;const o=e[i];if(T(o))t[i]=Ln(0,o,n);else if(null!=o){const e=Fn(o);t[i]=()=>e}}},kn=(e,t)=>{const n=Fn(t);e.slots.default=()=>n};function Nn(e,t){if(null===zt)return e;const n=zt.proxy,i=e.dirs||(e.dirs=[]);for(let e=0;e<t.length;e++){let[o,r,a,s=d]=t[e];T(o)&&(o={mounted:o,updated:o}),i.push({dir:o,instance:n,value:r,oldValue:void 0,arg:a,modifiers:s})}return e}function In(e,t,n,i){const o=e.dirs,r=t&&t.dirs;for(let a=0;a<o.length;a++){const s=o[a];r&&(s.oldValue=r[a].value);const l=s.dir[i];l&&rt(l,n,8,[e.el,s,e,t])}}function Wn(){return{app:null,config:{isNativeTag:v,performance:!1,globalProperties:{},optionMergeStrategies:{},isCustomElement:v,errorHandler:void 0,warnHandler:void 0},mixins:[],components:{},directives:{},provides:Object.create(null)}}let Vn=0;function Bn(e,t){return function(n,i=null){null==i||z(i)||(i=null);const o=Wn(),r=new Set;let a=!1;const s=o.app={_uid:Vn++,_component:n,_props:i,_container:null,_context:o,version:Ci,get config(){return o.config},set config(e){},use:(e,...t)=>(r.has(e)||(e&&T(e.install)?(r.add(e),e.install(s,...t)):T(e)&&(r.add(e),e(s,...t))),s),mixin:e=>(o.mixins.includes(e)||o.mixins.push(e),s),component:(e,t)=>t?(o.components[e]=t,s):o.components[e],directive:(e,t)=>t?(o.directives[e]=t,s):o.directives[e],mount(r,l){if(!a){const c=on(n,i);return c.appContext=o,l&&t?t(c,r):e(c,r),a=!0,s._container=r,r.__vue_app__=s,c.component.proxy}},unmount(){a&&e(null,s._container)},provide:(e,t)=>(o.provides[e]=t,s)};return s}}const Gn={scheduler:xt,allowRecurse:!0},Yn=function(e,t){t&&t.pendingBranch?M(e)?t.effects.push(...e):t.effects.push(e):Ct(e,mt,pt,vt)},jn=(e,t,n,i,o)=>{if(M(e))return void e.forEach((e,r)=>jn(e,t&&(M(t)?t[r]:t),n,i,o));let r;r=o?4&o.shapeFlag?o.component.proxy:o.el:null;const{i:a,r:s}=e,l=t&&t.r,c=a.refs===d?a.refs={}:a.refs,u=a.setupState;if(null!=l&&l!==s&&(A(l)?(c[l]=null,C(u,l)&&(u[l]=null)):Qe(l)&&(l.value=null)),A(s)){const e=()=>{c[s]=r,C(u,s)&&(u[s]=r)};r?(e.id=-1,Yn(e,i)):e()}else if(Qe(s)){const e=()=>{s.value=r};r?(e.id=-1,Yn(e,i)):e()}else T(s)&&ot(s,n,12,[r,c])};function Xn(e){return function(e,t){const{insert:n,remove:i,patchProp:o,forcePatchProp:r,createElement:a,createText:s,createComment:l,setText:c,setElementText:u,parentNode:h,nextSibling:f,setScopeId:v=m,cloneNode:g,insertStaticContent:y}=e,b=(e,t,n,i=null,o=null,r=null,a=!1,s=!1)=>{e&&!en(e,t)&&(i=ne(e),Z(e,o,r,!0),e=null),-2===t.patchFlag&&(s=!1,t.dynamicChildren=null);const{type:l,ref:c,shapeFlag:u}=t;switch(l){case Xt:x(e,t,n,i);break;case Ht:_(e,t,n,i);break;case Ut:null==e&&P(t,n,i,a);break;case jt:L(e,t,n,i,o,r,a,s);break;default:1&u?S(e,t,n,i,o,r,a,s):6&u?D(e,t,n,i,o,r,a,s):(64&u||128&u)&&l.process(e,t,n,i,o,r,a,s,se)}null!=c&&o&&jn(c,e&&e.ref,o,r,t)},x=(e,t,i,o)=>{if(null==e)n(t.el=s(t.children),i,o);else{const n=t.el=e.el;t.children!==e.children&&c(n,t.children)}},_=(e,t,i,o)=>{null==e?n(t.el=l(t.children||""),i,o):t.el=e.el},P=(e,t,n,i)=>{[e.el,e.anchor]=y(e.children,t,n,i)},S=(e,t,n,i,o,r,a,s)=>{a=a||"svg"===t.type,null==e?E(t,n,i,o,r,a,s):O(e,t,o,r,a,s)},E=(e,t,i,r,s,l,c)=>{let h,f;const{type:d,props:p,shapeFlag:m,transition:v,scopeId:y,patchFlag:b,dirs:w}=e;if(e.el&&void 0!==g&&-1===b)h=e.el=g(e.el);else{if(h=e.el=a(e.type,l,p&&p.is),8&m?u(h,e.children):16&m&&A(e.children,h,null,r,s,l&&"foreignObject"!==d,c||!!e.dynamicChildren),w&&In(e,null,r,"created"),p){for(const t in p)N(t)||o(h,t,null,p[t],l,e.children,r,s,te);(f=p.onVnodeBeforeMount)&&Hn(f,r,e)}T(h,y,e,r)}w&&In(e,null,r,"beforeMount");const x=(!s||s&&!s.pendingBranch)&&v&&!v.persisted;x&&v.beforeEnter(h),n(h,t,i),((f=p&&p.onVnodeMounted)||x||w)&&Yn(()=>{f&&Hn(f,r,e),x&&v.enter(h),w&&In(e,null,r,"mounted")},s)},T=(e,t,n,i)=>{if(t&&v(e,t),i){const o=i.type.__scopeId;o&&o!==t&&v(e,o+"-s"),n===i.subTree&&T(e,i.vnode.scopeId,i.vnode,i.parent)}},A=(e,t,n,i,o,r,a,s=0)=>{for(let l=s;l<e.length;l++){const s=e[l]=a?cn(e[l]):ln(e[l]);b(null,s,t,n,i,o,r,a)}},O=(e,t,n,i,a,s)=>{const l=t.el=e.el;let{patchFlag:c,dynamicChildren:h,dirs:f}=t;c|=16&e.patchFlag;const p=e.props||d,m=t.props||d;let v;if((v=m.onVnodeBeforeUpdate)&&Hn(v,n,t,e),f&&In(t,e,n,"beforeUpdate"),c>0){if(16&c)F(l,t,p,m,n,i,a);else if(2&c&&p.class!==m.class&&o(l,"class",null,m.class,a),4&c&&o(l,"style",p.style,m.style,a),8&c){const s=t.dynamicProps;for(let t=0;t<s.length;t++){const c=s[t],u=p[c],h=m[c];(h!==u||r&&r(l,c))&&o(l,c,u,h,a,e.children,n,i,te)}}1&c&&e.children!==t.children&&u(l,t.children)}else s||null!=h||F(l,t,p,m,n,i,a);const g=a&&"foreignObject"!==t.type;h?z(e.dynamicChildren,h,l,n,i,g):s||Y(e,t,l,null,n,i,g),((v=m.onVnodeUpdated)||f)&&Yn(()=>{v&&Hn(v,n,t,e),f&&In(t,e,n,"updated")},i)},z=(e,t,n,i,o,r)=>{for(let a=0;a<t.length;a++){const s=e[a],l=t[a],c=s.type===jt||!en(s,l)||6&s.shapeFlag||64&s.shapeFlag?h(s.el):n;b(s,l,c,null,i,o,r,!0)}},F=(e,t,n,i,a,s,l)=>{if(n!==i){for(const c in i){if(N(c))continue;const u=i[c],h=n[c];(u!==h||r&&r(e,c))&&o(e,c,h,u,l,t.children,a,s,te)}if(n!==d)for(const r in n)N(r)||r in i||o(e,r,n[r],null,l,t.children,a,s,te)}},L=(e,t,i,o,r,a,l,c)=>{const u=t.el=e?e.el:s(""),h=t.anchor=e?e.anchor:s("");let{patchFlag:f,dynamicChildren:d}=t;f>0&&(c=!0),null==e?(n(u,i,o),n(h,i,o),A(t.children,i,h,r,a,l,c)):f>0&&64&f&&d?(z(e.dynamicChildren,d,i,r,a,l),(null!=t.key||r&&t===r.subTree)&&ie(e,t,!0)):Y(e,t,i,h,r,a,l,c)},D=(e,t,n,i,o,r,a,s)=>{null==e?512&t.shapeFlag?o.ctx.activate(t,n,i,a,s):k(t,n,i,o,r,a,s):I(e,t,s)},k=(e,t,n,i,o,r,a)=>{const s=e.component=function(e,t,n){const i=e.type,o=(t?t.appContext:e.appContext)||hi,r={uid:fi++,vnode:e,type:i,parent:t,appContext:o,root:null,next:null,subTree:null,update:null,render:null,proxy:null,withProxy:null,effects:null,provides:t?t.provides:Object.create(o.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pn(i,o),emitsOptions:At(i,o),emit:null,emitted:null,ctx:d,data:d,props:d,attrs:d,slots:d,refs:d,setupState:d,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=Tt.bind(null,r),r}(e,i,o);if(An(e)&&(s.ctx.renderer=se),function(e,t=!1){mi=t;const{props:n,children:i,shapeFlag:o}=e.vnode,r=4&o;hn(e,n,r,t),((e,t)=>{if(32&e.vnode.shapeFlag){const n=t._;n?(e.slots=t,H(t,"_",n)):Dn(t,e.slots={})}else e.slots={},t&&kn(e,t);H(e.slots,"__vInternal",1)})(e,i);const a=r?function(e,t){const n=e.type;e.accessCache={},e.proxy=new Proxy(e.ctx,ci);const{setup:i}=n;if(i){const n=e.setupContext=i.length>1?function(e){return{attrs:e.attrs,slots:e.slots,emit:e.emit}}(e):null;di=e,oe();const o=ot(i,e,0,[e.props,n]);if(ae(),di=null,R(o)){if(t)return o.then(t=>{vi(e,t)});e.asyncDep=o}else vi(e,o)}else gi(e)}(e,t):void 0;mi=!1}(s),s.asyncDep){if(o&&o.registerDep(s,W),!e.el){const e=s.subTree=on(Ht);_(null,e,t,n)}}else W(s,e,t,n,o,r,a)},I=(e,t,n)=>{const i=t.component=e.component;if(function(e,t,n){const{props:i,children:o,component:r}=e,{props:a,children:s,patchFlag:l}=t,c=r.emitsOptions;if(t.dirs||t.transition)return!0;if(!(n&&l>0))return!(!o&&!s||s&&s.$stable)||i!==a&&(i?!a||Nt(i,a,c):!!a);if(1024&l)return!0;if(16&l)return i?Nt(i,a,c):!!a;if(8&l){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t];if(a[n]!==i[n]&&!Ot(c,n))return!0}}return!1}(e,t,n)){if(i.asyncDep&&!i.asyncResolved)return void B(i,t,n);i.next=t,function(e){const t=ct.indexOf(e);t>-1&&(ct[t]=null)}(i.update),i.update()}else t.component=e.component,t.el=e.el,i.vnode=t},W=(e,t,n,i,o,r,a)=>{e.update=Q((function(){if(e.isMounted){let t,{next:n,bu:i,u:s,parent:l,vnode:c}=e,u=n;n?B(e,n,a):n=c,n.el=c.el,i&&X(i),(t=n.props&&n.props.onVnodeBeforeUpdate)&&Hn(t,l,n,c);const f=Ft(e),p=e.subTree;e.subTree=f,e.refs!==d&&(e.refs={}),b(p,f,h(p.el),ne(p),e,o,r),n.el=f.el,null===u&&function({vnode:e,parent:t},n){for(;t&&t.subTree===e;)(e=t.vnode).el=n,t=t.parent}(e,f.el),s&&Yn(s,o),(t=n.props&&n.props.onVnodeUpdated)&&Yn(()=>{Hn(t,l,n,c)},o)}else{let a;const{el:s,props:l}=t,{bm:c,m:u,parent:h}=e;c&&X(c),(a=l&&l.onVnodeBeforeMount)&&Hn(a,h,t);const f=e.subTree=Ft(e);s&&ue?ue(t.el,f,e,o):(b(null,f,n,i,e,o,r),t.el=f.el),u&&Yn(u,o),(a=l&&l.onVnodeMounted)&&Yn(()=>{Hn(a,h,t)},o);const{a:d}=e;d&&256&t.shapeFlag&&Yn(d,o),e.isMounted=!0}}),Gn)},B=(e,t,n)=>{t.component=e;const i=e.vnode.props;e.vnode=t,e.next=null,function(e,t,n,i){const{props:o,attrs:r,vnode:{patchFlag:a}}=e,s=$e(o),[l]=e.propsOptions;if(!(i||a>0)||16&a){let i;fn(e,t,o,r);for(const r in s)t&&(C(t,r)||(i=G(r))!==r&&C(t,i))||(l?!n||void 0===n[r]&&void 0===n[i]||(o[r]=dn(l,t||d,r,void 0,e)):delete o[r]);if(r!==s)for(const e in r)t&&C(t,e)||delete r[e]}else if(8&a){const n=e.vnode.dynamicProps;for(let i=0;i<n.length;i++){const a=n[i],c=t[a];if(l)if(C(r,a))r[a]=c;else{const t=V(a);o[t]=dn(l,s,t,c,e)}else r[a]=c}}le(e,"set","$attrs")}(e,t.props,i,n),((e,t)=>{const{vnode:n,slots:i}=e;let o=!0,r=d;if(32&n.shapeFlag){const e=t._;e?1===e?o=!1:w(i,t):(o=!t.$stable,Dn(t,i)),r=t}else t&&(kn(e,t),r={default:1});if(o)for(const e in i)Rn(e)||e in r||delete i[e]})(e,t.children),Mt(void 0,e.update)},Y=(e,t,n,i,o,r,a,s=!1)=>{const l=e&&e.children,c=e?e.shapeFlag:0,h=t.children,{patchFlag:f,shapeFlag:d}=t;if(f>0){if(128&f)return void U(l,h,n,i,o,r,a,s);if(256&f)return void j(l,h,n,i,o,r,a,s)}8&d?(16&c&&te(l,o,r),h!==l&&u(n,h)):16&c?16&d?U(l,h,n,i,o,r,a,s):te(l,o,r,!0):(8&c&&u(n,""),16&d&&A(h,n,i,o,r,a,s))},j=(e,t,n,i,o,r,a,s)=>{t=t||p;const l=(e=e||p).length,c=t.length,u=Math.min(l,c);let h;for(h=0;h<u;h++){const i=t[h]=s?cn(t[h]):ln(t[h]);b(e[h],i,n,null,o,r,a,s)}l>c?te(e,o,r,!0,u):A(t,n,i,o,r,a,s,u)},U=(e,t,n,i,o,r,a,s)=>{let l=0;const c=t.length;let u=e.length-1,h=c-1;for(;l<=u&&l<=h;){const i=e[l],c=t[l]=s?cn(t[l]):ln(t[l]);if(!en(i,c))break;b(i,c,n,null,o,r,a,s),l++}for(;l<=u&&l<=h;){const i=e[u],l=t[h]=s?cn(t[h]):ln(t[h]);if(!en(i,l))break;b(i,l,n,null,o,r,a,s),u--,h--}if(l>u){if(l<=h){const e=h+1,u=e<c?t[e].el:i;for(;l<=h;)b(null,t[l]=s?cn(t[l]):ln(t[l]),n,u,o,r,a),l++}}else if(l>h)for(;l<=u;)Z(e[l],o,r,!0),l++;else{const f=l,d=l,m=new Map;for(l=d;l<=h;l++){const e=t[l]=s?cn(t[l]):ln(t[l]);null!=e.key&&m.set(e.key,l)}let v,g=0;const y=h-d+1;let w=!1,x=0;const _=new Array(y);for(l=0;l<y;l++)_[l]=0;for(l=f;l<=u;l++){const i=e[l];if(g>=y){Z(i,o,r,!0);continue}let c;if(null!=i.key)c=m.get(i.key);else for(v=d;v<=h;v++)if(0===_[v-d]&&en(i,t[v])){c=v;break}void 0===c?Z(i,o,r,!0):(_[c-d]=l+1,c>=x?x=c:w=!0,b(i,t[c],n,null,o,r,a,s),g++)}const C=w?function(e){const t=e.slice(),n=[0];let i,o,r,a,s;const l=e.length;for(i=0;i<l;i++){const l=e[i];if(0!==l){if(o=n[n.length-1],e[o]<l){t[i]=o,n.push(i);continue}for(r=0,a=n.length-1;r<a;)s=(r+a)/2|0,e[n[s]]<l?r=s+1:a=s;l<e[n[r]]&&(r>0&&(t[i]=n[r-1]),n[r]=i)}}r=n.length,a=n[r-1];for(;r-- >0;)n[r]=a,a=t[a];return n}(_):p;for(v=C.length-1,l=y-1;l>=0;l--){const e=d+l,s=t[e],u=e+1<c?t[e+1].el:i;0===_[l]?b(null,s,n,u,o,r,a):w&&(v<0||l!==C[v]?q(s,n,u,2):v--)}}},q=(e,t,i,o,r=null)=>{const{el:a,type:s,transition:l,children:c,shapeFlag:u}=e;if(6&u)return void q(e.component.subTree,t,i,o);if(128&u)return void e.suspense.move(t,i,o);if(64&u)return void s.move(e,t,i,se);if(s===jt){n(a,t,i);for(let e=0;e<c.length;e++)q(c[e],t,i,o);return void n(e.anchor,t,i)}if(2!==o&&1&u&&l)if(0===o)l.beforeEnter(a),n(a,t,i),Yn(()=>l.enter(a),r);else{const{leave:e,delayLeave:o,afterLeave:r}=l,s=()=>n(a,t,i),c=()=>{e(a,()=>{s(),r&&r()})};o?o(a,s,c):c()}else n(a,t,i)},Z=(e,t,n,i=!1)=>{const{type:o,props:r,ref:a,children:s,dynamicChildren:l,shapeFlag:c,patchFlag:u,dirs:h}=e;if(null!=a&&t&&jn(a,null,t,n,null),256&c)return void t.ctx.deactivate(e);const f=1&c&&h;let d;if((d=r&&r.onVnodeBeforeUnmount)&&Hn(d,t,e),6&c)ee(e.component,n,i);else{if(128&c)return void e.suspense.unmount(n,i);f&&In(e,null,t,"beforeUnmount"),l&&(o!==jt||u>0&&64&u)?te(l,t,n):16&c&&te(s,t,n),64&c&&e.type.remove(e,se),i&&$(e)}((d=r&&r.onVnodeUnmounted)||f)&&Yn(()=>{d&&Hn(d,t,e),f&&In(e,null,t,"unmounted")},n)},$=e=>{const{type:t,el:n,anchor:o,transition:r}=e;if(t===jt)return void J(n,o);const a=()=>{i(n),r&&!r.persisted&&r.afterLeave&&r.afterLeave()};if(1&e.shapeFlag&&r&&!r.persisted){const{leave:t,delayLeave:i}=r,o=()=>t(n,a);i?i(e.el,a,o):o()}else a()},J=(e,t)=>{let n;for(;e!==t;)n=f(e),i(e),e=n;i(t)},ee=(e,t,n)=>{const{bum:i,effects:o,update:r,subTree:a,um:s}=e;if(i&&X(i),o)for(let e=0;e<o.length;e++)K(o[e]);r&&(K(r),Z(a,e,t,n)),s&&Yn(s,t),Yn(()=>{e.isUnmounted=!0},t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},te=(e,t,n,i=!1,o=0)=>{for(let r=o;r<e.length;r++)Z(e[r],t,n,i)},ne=e=>6&e.shapeFlag?ne(e.component.subTree):128&e.shapeFlag?e.suspense.next():f(e.anchor||e.el),ie=(e,t,n=!1)=>{const i=e.children,o=t.children;if(M(i)&&M(o))for(let e=0;e<i.length;e++){const t=i[e],r=o[e]=cn(o[e]);1&r.shapeFlag&&!r.dynamicChildren&&((r.patchFlag<=0||32===r.patchFlag)&&(r.el=t.el),n||ie(t,r))}},re=(e,t)=>{null==e?t._vnode&&Z(t._vnode,null,null,!0):b(t._vnode||null,e,t),Pt(),t._vnode=e},se={p:b,um:Z,m:q,r:$,mt:k,mc:A,pc:Y,pbc:z,n:ne,o:e};let ce,ue;t&&([ce,ue]=t(se));return{render:re,hydrate:ce,createApp:Bn(re,ce)}}(e)}function Hn(e,t,n,i=null){rt(e,t,7,[n,i])}const Un={};function qn(e,t,n){return Zn(e,t,n)}function Zn(e,t,{immediate:n,deep:i,flush:o,onTrack:r,onTrigger:a}=d,s=di){let l;const c=Qe(e);if(c?l=()=>e.value:Ue(e)?(l=()=>e,i=!0):l=M(e)?()=>e.map(e=>Qe(e)?e.value:Ue(e)?Jn(e):T(e)?ot(e,s,2):void 0):T(e)?t?()=>ot(e,s,2):()=>{if(!s||!s.isUnmounted)return u&&u(),ot(e,s,3,[h])}:m,t&&i){const e=l;l=()=>Jn(e())}let u;const h=e=>{u=g.options.onStop=()=>{ot(e,s,4)}};let f=M(e)?[]:Un;const p=()=>{if(g.active)if(t){const e=g();(i||c||j(e,f))&&(u&&u(),rt(t,s,3,[e,f===Un?void 0:f,h]),f=e)}else g()};let v;p.allowRecurse=!!t,v="sync"===o?p:"post"===o?()=>Yn(p,s&&s.suspense):()=>{!s||s.isMounted?function(e){Ct(e,ft,ht,dt)}(p):p()};const g=Q(l,{lazy:!0,onTrack:r,onTrigger:a,scheduler:v});return yi(g),t?n?p():f=g():"post"===o?Yn(g,s&&s.suspense):g(),()=>{K(g),s&&x(s.effects,g)}}function $n(e,t,n){const i=this.proxy;return Zn(A(e)?()=>i[e]:e.bind(i),t.bind(i),n,this)}function Jn(e,t=new Set){if(!z(e)||t.has(e))return e;if(t.add(e),Qe(e))Jn(e.value,t);else if(M(e))for(let n=0;n<e.length;n++)Jn(e[n],t);else if(P(e))e.forEach((n,i)=>{Jn(e.get(i),t)});else if(S(e))e.forEach(e=>{Jn(e,t)});else for(const n in e)Jn(e[n],t);return e}function Qn(e,t){if(di){let n=di.provides;const i=di.parent&&di.parent.provides;i===n&&(n=di.provides=Object.create(i)),n[e]=t}else;}function Kn(e,t,n=!1){const i=di||zt;if(i){const o=i.provides;if(e in o)return o[e];if(arguments.length>1)return n&&T(t)?t():t}}let ei=!1;function ti(e,t,n=[],i=[],o=!1){const{mixins:r,extends:a,data:s,computed:l,methods:c,watch:u,provide:h,inject:f,components:d,directives:p,beforeMount:v,mounted:g,beforeUpdate:y,updated:b,activated:x,deactivated:_,beforeDestroy:C,beforeUnmount:P,destroyed:S,unmounted:E,render:A,renderTracked:O,renderTriggered:R,errorCaptured:F}=t,L=e.proxy,D=e.ctx,k=e.appContext.mixins;if(o&&A&&e.render===m&&(e.render=A),o||(ei=!0,ni("beforeCreate",t,L,k),ei=!1,oi(e,k,n,i)),a&&ti(e,a,n,i,!0),r&&oi(e,r,n,i),f)if(M(f))for(let e=0;e<f.length;e++){const t=f[e];D[t]=Kn(t)}else for(const e in f){const t=f[e];z(t)?D[e]=Kn(t.from||e,t.default,!0):D[e]=Kn(t)}if(c)for(const e in c){const t=c[e];T(t)&&(D[e]=t.bind(L))}if(o?s&&n.push(s):(n.length&&n.forEach(t=>ri(e,t,L)),s&&ri(e,s,L)),l)for(const e in l){const t=l[e],n=bi({get:T(t)?t.bind(L,L):T(t.get)?t.get.bind(L,L):m,set:!T(t)&&T(t.set)?t.set.bind(L):m});Object.defineProperty(D,e,{enumerable:!0,configurable:!0,get:()=>n.value,set:e=>n.value=e})}if(u&&i.push(u),!o&&i.length&&i.forEach(e=>{for(const t in e)ai(e[t],D,L,t)}),h){const e=T(h)?h.call(L):h;for(const t in e)Qn(t,e[t])}var N;o&&(d&&w(e.components||(e.components=w({},e.type.components)),d),p&&w(e.directives||(e.directives=w({},e.type.directives)),p)),o||ni("created",t,L,k),v&&xn(v.bind(L)),g&&_n(g.bind(L)),y&&Cn(y.bind(L)),b&&Mn(b.bind(L)),x&&On(x.bind(L),"a",N),_&&function(e,t){On(e,"da",t)}(_.bind(L)),F&&((e,t=di)=>{bn("ec",e,t)})(F.bind(L)),O&&Tn(O.bind(L)),R&&En(R.bind(L)),P&&Pn(P.bind(L)),E&&Sn(E.bind(L))}function ni(e,t,n,i){ii(e,i,n);const{extends:o,mixins:r}=t;o&&function e(t,n,i){n.extends&&e(t,n.extends,i);const o=n[t];o&&o.call(i)}(e,o,n),r&&ii(e,r,n);const a=t[e];a&&a.call(n)}function ii(e,t,n){for(let i=0;i<t.length;i++){const o=t[i].mixins;o&&ii(e,o,n);const r=t[i][e];r&&r.call(n)}}function oi(e,t,n,i){for(let o=0;o<t.length;o++)ti(e,t[o],n,i,!0)}function ri(e,t,n){const i=t.call(n,n);z(i)&&(e.data===d?e.data=je(i):w(e.data,i))}function ai(e,t,n,i){const o=i.includes(".")?function(e,t){const n=t.split(".");return()=>{let t=e;for(let e=0;e<n.length&&t;e++)t=t[n[e]];return t}}(n,i):()=>n[i];if(A(e)){const n=t[e];T(n)&&qn(o,n)}else if(T(e))qn(o,e.bind(n));else if(z(e))if(M(e))e.forEach(e=>ai(e,t,n,i));else{const i=T(e.handler)?e.handler.bind(n):t[e.handler];T(i)&&qn(o,i,e)}}function si(e,t,n){const i=n.appContext.config.optionMergeStrategies,{mixins:o,extends:r}=t;r&&si(e,r,n),o&&o.forEach(t=>si(e,t,n));for(const o in t)i&&C(i,o)?e[o]=i[o](e[o],t[o],n.proxy,o):e[o]=t[o]}const li=w(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>e.parent&&e.parent.proxy,$root:e=>e.root&&e.root.proxy,$emit:e=>e.emit,$options:e=>function(e){const t=e.type,{__merged:n,mixins:i,extends:o}=t;if(n)return n;const r=e.appContext.mixins;if(!r.length&&!i&&!o)return t;const a={};return r.forEach(t=>si(a,t,e)),si(a,t,e),t.__merged=a}(e),$forceUpdate:e=>()=>xt(e.update),$nextTick:()=>wt,$watch:e=>$n.bind(e)}),ci={get({_:e},t){const{ctx:n,setupState:i,data:o,props:r,accessCache:a,type:s,appContext:l}=e;if("__v_skip"===t)return!0;let c;if("$"!==t[0]){const s=a[t];if(void 0!==s)switch(s){case 0:return i[t];case 1:return o[t];case 3:return n[t];case 2:return r[t]}else{if(i!==d&&C(i,t))return a[t]=0,i[t];if(o!==d&&C(o,t))return a[t]=1,o[t];if((c=e.propsOptions[0])&&C(c,t))return a[t]=2,r[t];if(n!==d&&C(n,t))return a[t]=3,n[t];ei||(a[t]=4)}}const u=li[t];let h,f;return u?("$attrs"===t&&se(e,0,t),u(e)):(h=s.__cssModules)&&(h=h[t])?h:n!==d&&C(n,t)?(a[t]=3,n[t]):(f=l.config.globalProperties,C(f,t)?f[t]:void 0)},set({_:e},t,n){const{data:i,setupState:o,ctx:r}=e;if(o!==d&&C(o,t))o[t]=n;else if(i!==d&&C(i,t))i[t]=n;else if(t in e.props)return!1;return("$"!==t[0]||!(t.slice(1)in e))&&(r[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:i,appContext:o,propsOptions:r}},a){let s;return void 0!==n[a]||e!==d&&C(e,a)||t!==d&&C(t,a)||(s=r[0])&&C(s,a)||C(i,a)||C(li,a)||C(o.config.globalProperties,a)}},ui=w({},ci,{get(e,t){if(t!==Symbol.unscopables)return ci.get(e,t,e)},has:(e,n)=>"_"!==n[0]&&!t(n)}),hi=Wn();let fi=0;let di=null;const pi=e=>{di=e};let mi=!1;function vi(e,t,n){var i;T(t)?e.render=t:z(t)&&(e.setupState=Ue(i=t)?i:new Proxy(i,nt)),gi(e)}function gi(e,t){const n=e.type;e.render||(e.render=n.render||m,e.render._rc&&(e.withProxy=new Proxy(e.ctx,ui))),di=e,ti(e,n),di=null}function yi(e){di&&(di.effects||(di.effects=[])).push(e)}function bi(e){const t=function(e){let t,n;return T(e)?(t=e,n=m):(t=e.get,n=e.set),new it(t,n,T(e)||!e.set)}(e);return yi(t.effect),t}function wi(e){return T(e)?{setup:e,name:e.name}:e}function xi(e,t,n){const i=arguments.length;return 2===i?z(t)&&!M(t)?Kt(t)?on(e,null,[t]):on(e,t):on(e,null,t):(i>3?n=Array.prototype.slice.call(arguments,2):3===i&&Kt(n)&&(n=[n]),on(e,t,n))}function _i(e,t){let n;if(M(e)||A(e)){n=new Array(e.length);for(let i=0,o=e.length;i<o;i++)n[i]=t(e[i],i)}else if("number"==typeof e){n=new Array(e);for(let i=0;i<e;i++)n[i]=t(i+1,i)}else if(z(e))if(e[Symbol.iterator])n=Array.from(e,t);else{const i=Object.keys(e);n=new Array(i.length);for(let o=0,r=i.length;o<r;o++){const r=i[o];n[o]=t(e[r],r,o)}}else n=[];return n}const Ci="3.0.0",Mi="http://www.w3.org/2000/svg",Pi="undefined"!=typeof document?document:null;let Si,Ei;const Ti={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n)=>t?Pi.createElementNS(Mi,e):Pi.createElement(e,n?{is:n}:void 0),createText:e=>Pi.createTextNode(e),createComment:e=>Pi.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Pi.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},cloneNode:e=>e.cloneNode(!0),insertStaticContent(e,t,n,i){const o=i?Ei||(Ei=Pi.createElementNS(Mi,"svg")):Si||(Si=Pi.createElement("div"));o.innerHTML=e;const r=o.firstChild;let a=r,s=a;for(;a;)s=a,Ti.insert(a,t,n),a=o.firstChild;return[r,s]}};const Ai=/\s*!important$/;function Oi(e,t,n){if(M(n))n.forEach(n=>Oi(e,t,n));else if(t.startsWith("--"))e.setProperty(t,n);else{const i=function(e,t){const n=Ri[t];if(n)return n;let i=V(t);if("filter"!==i&&i in e)return Ri[t]=i;i=Y(i);for(let n=0;n<zi.length;n++){const o=zi[n]+i;if(o in e)return Ri[t]=o}return t}(e,t);Ai.test(n)?e.setProperty(G(i),n.replace(Ai,""),"important"):e[i]=n}}const zi=["Webkit","Moz","ms"],Ri={};const Fi="http://www.w3.org/1999/xlink";let Li=Date.now;"undefined"!=typeof document&&Li()>document.createEvent("Event").timeStamp&&(Li=()=>performance.now());let Di=0;const ki=Promise.resolve(),Ni=()=>{Di=0};function Ii(e,t,n,i){e.addEventListener(t,n,i)}function Wi(e,t,n,i,o=null){const r=e._vei||(e._vei={}),a=r[t];if(i&&a)a.value=i;else{const[n,s]=function(e){let t;if(Vi.test(e)){let n;for(t={};n=e.match(Vi);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e.slice(2).toLowerCase(),t]}(t);if(i){Ii(e,n,r[t]=function(e,t){const n=e=>{(e.timeStamp||Li())>=n.attached-1&&rt(function(e,t){if(M(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(e=>t=>!t._stopped&&e(t))}return t}(e,n.value),t,5,[e])};return n.value=e,n.attached=(()=>Di||(ki.then(Ni),Di=Li()))(),n}(i,o),s)}else a&&(!function(e,t,n,i){e.removeEventListener(t,n,i)}(e,n,a,s),r[t]=void 0)}}const Vi=/(?:Once|Passive|Capture)$/;const Bi=/^on[a-z]/;const Gi=e=>{const t=e.props["onUpdate:modelValue"];return M(t)?e=>X(t,e):t},Yi={created(e,t,n){Ii(e,"change",()=>{const t=Array.prototype.filter.call(e.options,e=>e.selected).map(Xi);e._assign(e.multiple?t:t[0])}),e._assign=Gi(n)},mounted(e,{value:t}){ji(e,t)},beforeUpdate(e,t,n){e._assign=Gi(n)},updated(e,{value:t}){ji(e,t)}};function ji(e,t){const n=e.multiple;if(!n||M(t)||S(t)){for(let i=0,o=e.options.length;i<o;i++){const o=e.options[i],r=Xi(o);if(n)M(t)?o.selected=c(t,r)>-1:o.selected=u(t,r);else if(l(Xi(o),t))return void(e.selectedIndex=i)}n||(e.selectedIndex=-1)}}function Xi(e){return"_value"in e?e._value:e.value}const Hi=w({patchProp:(e,t,i,o,r=!1,a,s,l,c)=>{switch(t){case"class":!function(e,t,n){if(null==t&&(t=""),n)e.setAttribute("class",t);else{const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),e.className=t}}(e,o,r);break;case"style":!function(e,t,n){const i=e.style;if(n)if(A(n))t!==n&&(i.cssText=n);else{for(const e in n)Oi(i,e,n[e]);if(t&&!A(t))for(const e in t)null==n[e]&&Oi(i,e,"")}else e.removeAttribute("style")}(e,i,o);break;default:y(t)?b(t)||Wi(e,t,0,o,s):function(e,t,n,i){if(i)return"innerHTML"===t||!!(t in e&&Bi.test(t)&&T(n));if("spellcheck"===t||"draggable"===t)return!1;if("form"===t&&"string"==typeof n)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if(Bi.test(t)&&A(n))return!1;return t in e}(e,t,o,r)?function(e,t,n,i,o,r,a){if("innerHTML"===t||"textContent"===t)return i&&a(i,o,r),void(e[t]=null==n?"":n);if("value"!==t||"PROGRESS"===e.tagName)if(""===n&&"boolean"==typeof e[t])e[t]=!0;else if(null==n&&"string"==typeof e[t])e[t]="",e.removeAttribute(t);else try{e[t]=n}catch(e){}else{e._value=n;const t=null==n?"":n;e.value!==t&&(e.value=t)}}(e,t,o,a,s,l,c):("true-value"===t?e._trueValue=o:"false-value"===t&&(e._falseValue=o),function(e,t,i,o){if(o&&t.startsWith("xlink:"))null==i?e.removeAttributeNS(Fi,t.slice(6,t.length)):e.setAttributeNS(Fi,t,i);else{const o=n(t);null==i||o&&!1===i?e.removeAttribute(t):e.setAttribute(t,o?"":i)}}(e,t,o,r))}},forcePatchProp:(e,t)=>"value"===t},Ti);let Ui;var qi={name:"App",computed:{printMode:function(){return null!==new URL(window.location.href).searchParams.get("print")},prerender:function(){return null!==new URL(window.location.href).searchParams.get("prerender")}}};qi.render=function(e,t,n,i,o,r){const a=Bt("router-view");return $t(),Qt(a,{key:e.$route.fullPath,class:{prerender:r.prerender}},null,8,["class"])},qi.__file="src/App.vue";
/*!
  * vue-router v4.0.0-beta.13
  * (c) 2020 Eduardo San Martin Morote
  * @license MIT
  */
const Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,$i=e=>Zi?Symbol(e):"_vr_"+e,Ji=$i("rvlm"),Qi=$i("rvd"),Ki=$i("r"),eo=$i("rl"),to="undefined"!=typeof window;const no=Object.assign;function io(e,t){const n={};for(const i in t){const o=t[i];n[i]=Array.isArray(o)?o.map(e):e(o)}return n}let oo=()=>{};const ro=/\/$/;function ao(e,t,n="/"){let i,o={},r="",a="";const s=t.indexOf("?"),l=t.indexOf("#",s>-1?s:0);return s>-1&&(i=t.slice(0,s),r=t.slice(s+1,l>-1?l:t.length),o=e(r)),l>-1&&(i=i||t.slice(0,l),a=t.slice(l,t.length)),i=function(e,t){if(e.startsWith("/"))return e;if(!e)return t;const n=t.split("/"),i=e.split("/");let o,r,a=n.length-1;for(o=0;o<i.length;o++)if(r=i[o],1!==a&&"."!==r){if(".."!==r)break;a--}return n.slice(0,a).join("/")+"/"+i.slice(o-(o===i.length?1:0)).join("/")}(null!=i?i:t,n),{fullPath:i+(r&&"?")+r+a,path:i,query:o,hash:a}}function so(e,t){return!t||e.toLowerCase().indexOf(t.toLowerCase())?e:e.slice(t.length)||"/"}function lo(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function co(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(!uo(e[n],t[n]))return!1;return!0}function uo(e,t){return Array.isArray(e)?ho(e,t):Array.isArray(t)?ho(t,e):e===t}function ho(e,t){return Array.isArray(t)?e.length===t.length&&e.every((e,n)=>e===t[n]):1===e.length&&e[0]===t}var fo,po,mo,vo;function go(e){if(!e)if(to){const t=document.querySelector("base");e=(e=t&&t.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),e.replace(ro,"")}(po=fo||(fo={})).pop="pop",po.push="push",(vo=mo||(mo={})).back="back",vo.forward="forward",vo.unknown="";const yo=/^[^#]+#/;function bo(e,t){return e.replace(yo,"#")+t}const wo=()=>({left:window.pageXOffset,top:window.pageYOffset});function xo(e){let t;if("el"in e){let n=e.el;const i="string"==typeof n&&n.startsWith("#"),o="string"==typeof n?i?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!o)return;t=function(e,t){const n=document.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect();return{behavior:t.behavior,left:i.left-n.left-(t.left||0),top:i.top-n.top-(t.top||0)}}(o,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.pageXOffset,null!=t.top?t.top:window.pageYOffset)}function _o(e,t){return(history.state?history.state.position-t:-1)+e}const Co=new Map;function Mo(e,t){const{pathname:n,search:i,hash:o}=t;if(e.indexOf("#")>-1){let e=o.slice(1);return"/"!==e[0]&&(e="/"+e),so(e,"")}return so(n,e)+i+o}function Po(e,t,n,i=!1,o=!1){return{back:e,current:t,forward:n,replaced:i,position:window.history.length,scroll:o?wo():null}}function So(e){const{history:t,location:n}=window;let i={value:Mo(e,n)},o={value:t.state};function r(i,r,a){const s=e.indexOf("#"),l=s>-1?e.slice(s)+i:location.protocol+"//"+location.host+e+i;try{t[a?"replaceState":"pushState"](r,"",l),o.value=r}catch(e){console.error(e),n[a?"replace":"assign"](l)}}return o.value||r(i.value,{back:null,current:i.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:i,state:o,push:function(e,n){const a=no({},o.value,t.state,{forward:e,scroll:wo()});r(a.current,a,!0),r(e,no({},Po(i.value,e,null),{position:a.position+1},n),!1),i.value=e},replace:function(e,n){r(e,no({},t.state,Po(o.value.back,e,o.value.forward,!0),n,{position:o.value.position}),!0),i.value=e}}}function Eo(e){return"string"==typeof e||"symbol"==typeof e}const To={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Ao=$i("nf");var Oo,zo;function Ro(e,t){return no(new Error,{type:e,[Ao]:!0},t)}function Fo(e,t){return e instanceof Error&&Ao in e&&(null==t||!!(e.type&t))}(zo=Oo||(Oo={}))[zo.aborted=4]="aborted",zo[zo.cancelled=8]="cancelled",zo[zo.duplicated=16]="duplicated";const Lo={sensitive:!1,strict:!1,start:!0,end:!0},Do=/[.+*?^${}()[\]/\\]/g;function ko(e,t){let n=0;for(;n<e.length&&n<t.length;){const i=t[n]-e[n];if(i)return i;n++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function No(e,t){let n=0;const i=e.score,o=t.score;for(;n<i.length&&n<o.length;){const e=ko(i[n],o[n]);if(e)return e;n++}return o.length-i.length}const Io={type:0,value:""},Wo=/[a-zA-Z0-9_]/;function Vo(e,t,n){const i=function(e,t){const n=no({},Lo,t);let i=[],o=n.start?"^":"";const r=[];for(const t of e){const e=t.length?[]:[90];n.strict&&!t.length&&(o+="/");for(let i=0;i<t.length;i++){const a=t[i];let s=40+(n.sensitive?.25:0);if(0===a.type)i||(o+="/"),o+=a.value.replace(Do,"\\$&"),s+=40;else if(1===a.type){const{value:e,repeatable:t,optional:n,regexp:l}=a;r.push({name:e,repeatable:t,optional:n});const c=l||"[^/]+?";if("[^/]+?"!==c){s+=10;try{new RegExp(`(${c})`)}catch(t){throw new Error(`Invalid custom RegExp for param "${e}" (${c}): `+t.message)}}let u=t?`((?:${c})(?:/(?:${c}))*)`:`(${c})`;i||(u=n?`(?:/${u})`:"/"+u),n&&(u+="?"),o+=u,s+=20,n&&(s+=-8),t&&(s+=-20),".*"===c&&(s+=-50)}e.push(s)}i.push(e)}if(n.strict&&n.end){const e=i.length-1;i[e][i[e].length-1]+=.7000000000000001}n.strict||(o+="/?"),n.end?o+="$":n.strict&&(o+="(?:/|$)");const a=new RegExp(o,n.sensitive?"":"i");return{re:a,score:i,keys:r,parse:function(e){const t=e.match(a),n={};if(!t)return null;for(let e=1;e<t.length;e++){const i=t[e]||"",o=r[e-1];n[o.name]=i&&o.repeatable?i.split("/"):i}return n},stringify:function(t){let n="",i=!1;for(const o of e){i&&n.endsWith("/")||(n+="/"),i=!1;for(const e of o)if(0===e.type)n+=e.value;else if(1===e.type){const{value:o,repeatable:r,optional:a}=e,s=o in t?t[o]:"";if(Array.isArray(s)&&!r)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const l=Array.isArray(s)?s.join("/"):s;if(!l){if(!a)throw new Error(`Missing required param "${o}"`);n.endsWith("/")?n=n.slice(0,-1):i=!0}n+=l}}return n}}}(function(e){if(!e)return[[]];if("/"===e)return[[Io]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${n})/"${c}": ${e}`)}let n=0,i=n;const o=[];let r;function a(){r&&o.push(r),r=[]}let s,l=0,c="",u="";function h(){c&&(0===n?r.push({type:0,value:c}):1===n||2===n||3===n?(r.length>1&&("*"===s||"+"===s)&&t(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:u,repeatable:"*"===s||"+"===s,optional:"*"===s||"?"===s})):t("Invalid state to consume buffer"),c="")}function f(){c+=s}for(;l<e.length;)if(s=e[l++],"\\"!==s||2===n)switch(n){case 0:"/"===s?(c&&h(),a()):":"===s?(h(),n=1):f();break;case 4:f(),n=i;break;case 1:"("===s?(n=2,u=""):Wo.test(s)?f():(h(),n=0,"*"!==s&&"?"!==s&&"+"!==s&&l--);break;case 2:")"===s?"\\"==u[u.length-1]?u=u.slice(0,-1)+s:n=3:u+=s;break;case 3:h(),n=0,"*"!==s&&"?"!==s&&"+"!==s&&l--;break;default:t("Unknown state")}else i=n,n=4;return 2===n&&t(`Unfinished custom RegExp for param "${c}"`),h(),a(),o}(e.path),n),o=no(i,{record:e,parent:t,children:[],alias:[]});return t&&!o.record.aliasOf==!t.record.aliasOf&&t.children.push(o),o}function Bo(e,t){const n=[],i=new Map;function o(e,n,i){let s=!i,l=function(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:Go(e),children:e.children||[],instances:{},leaveGuards:[],updateGuards:[],enterCallbacks:{},components:"components"in e?e.components||{}:{default:e.component}}}(e);l.aliasOf=i&&i.record;const c=Xo(t,e),u=[l];if("alias"in e){const t="string"==typeof e.alias?[e.alias]:e.alias;for(const e of t)u.push(no({},l,{components:i?i.record.components:l.components,path:e,aliasOf:i?i.record:l}))}let h,f;for(const t of u){let{path:u}=t;if(n&&"/"!==u[0]){let e=n.record.path,i="/"===e[e.length-1]?"":"/";t.path=n.record.path+(u&&i+u)}if(h=Vo(t,n,c),i?i.alias.push(h):(f=f||h,f!==h&&f.alias.push(h),s&&e.name&&!Yo(h)&&r(e.name)),"children"in l){let e=l.children;for(let t=0;t<e.length;t++)o(e[t],h,i&&i.children[t])}i=i||h,a(h)}return f?()=>{r(f)}:oo}function r(e){if(Eo(e)){const t=i.get(e);t&&(i.delete(e),n.splice(n.indexOf(t),1),t.children.forEach(r),t.alias.forEach(r))}else{let t=n.indexOf(e);t>-1&&(n.splice(t,1),e.record.name&&i.delete(e.record.name),e.children.forEach(r),e.alias.forEach(r))}}function a(e){let t=0;for(;t<n.length&&No(e,n[t])>=0;)t++;n.splice(t,0,e),e.record.name&&!Yo(e)&&i.set(e.record.name,e)}return t=Xo({strict:!1,end:!0,sensitive:!1},t),e.forEach(e=>o(e)),{addRoute:o,resolve:function(e,t){let o,r,a,s={};if("name"in e&&e.name){if(o=i.get(e.name),!o)throw Ro(1,{location:e});a=o.record.name,s=no(function(e,t){let n={};for(let i of t)i in e&&(n[i]=e[i]);return n}(t.params,o.keys.filter(e=>!e.optional).map(e=>e.name)),e.params),r=o.stringify(s)}else if("path"in e)r=e.path,o=n.find(e=>e.re.test(r)),o&&(s=o.parse(r),a=o.record.name);else{if(o=t.name?i.get(t.name):n.find(e=>e.re.test(t.path)),!o)throw Ro(1,{location:e,currentLocation:t});a=o.record.name,s=no({},t.params,e.params),r=o.stringify(s)}const l=[];let c=o;for(;c;)l.unshift(c.record),c=c.parent;return{name:a,path:r,params:s,matched:l,meta:jo(l)}},removeRoute:r,getRoutes:function(){return n},getRecordMatcher:function(e){return i.get(e)}}}function Go(e){const t={},n=e.props||!1;if("component"in e)t.default=n;else for(let i in e.components)t[i]="boolean"==typeof n?n:n[i];return t}function Yo(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function jo(e){return e.reduce((e,t)=>no(e,t.meta),{})}function Xo(e,t){let n={};for(let i in e)n[i]=i in t?t[i]:e[i];return n}const Ho=/#/g,Uo=/&/g,qo=/\//g,Zo=/=/g,$o=/\?/g,Jo=/%5B/g,Qo=/%5D/g,Ko=/%5E/g,er=/%60/g,tr=/%7B/g,nr=/%7C/g,ir=/%7D/g;function or(e){return encodeURI(""+e).replace(nr,"|").replace(Jo,"[").replace(Qo,"]")}function rr(e){return or(e).replace(Ho,"%23").replace(Uo,"%26").replace(er,"`").replace(tr,"{").replace(ir,"}").replace(Ko,"^")}function ar(e){return function(e){return or(e).replace(Ho,"%23").replace($o,"%3F")}(e).replace(qo,"%2F")}function sr(e){try{return decodeURIComponent(""+e)}catch(e){}return""+e}function lr(e){const t={};if(""===e||"?"===e)return t;const n=("?"===e[0]?e.slice(1):e).split("&");for(let e=0;e<n.length;++e){const i=n[e];let o=i.indexOf("="),r=sr(o<0?i:i.slice(0,o)),a=o<0?null:sr(i.slice(o+1));if(r in t){let e=t[r];Array.isArray(e)||(e=t[r]=[e]),e.push(a)}else t[r]=a}return t}function cr(e){let t="";for(let n in e){t.length&&(t+="&");const i=e[n];if(n=rr(n).replace(Zo,"%3D"),null==i){void 0!==i&&(t+=n);continue}let o=Array.isArray(i)?i.map(e=>e&&rr(e)):[i&&rr(i)];for(let e=0;e<o.length;e++)t+=(e?"&":"")+n,null!=o[e]&&(t+="="+o[e])}return t}function ur(e){const t={};for(let n in e){let i=e[n];void 0!==i&&(t[n]=Array.isArray(i)?i.map(e=>null==e?null:""+e):null==i?i:""+i)}return t}function hr(){let e=[];return{add:function(t){return e.push(t),()=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)}},list:()=>e,reset:function(){e=[]}}}function fr(e,t,n,i,o){const r=i&&(i.enterCallbacks[o]=i.enterCallbacks[o]||[]);return()=>new Promise((a,s)=>{const l=e=>{var l;!1===e?s(Ro(4,{from:n,to:t})):e instanceof Error?s(e):"string"==typeof(l=e)||l&&"object"==typeof l?s(Ro(2,{from:t,to:e})):(r&&i.enterCallbacks[o]===r&&"function"==typeof e&&r.push(e),a())},c=e.call(i&&i.instances[o],t,n,l);let u=Promise.resolve(c);e.length<3&&(u=u.then(l)),u.catch(e=>s(e))})}function dr(e,t,n,i){const o=[];for(const a of e)for(const e in a.components){let s=a.components[e];if("beforeRouteEnter"===t||a.instances[e])if("object"==typeof(r=s)||"displayName"in r||"props"in r||"__vccOpts"in r){const r=(s.__vccOpts||s)[t];r&&o.push(fr(r,n,i,a,e))}else{let r=s();r=r.catch(console.error),o.push(()=>r.then(o=>{if(!o)return Promise.reject(new Error(`Couldn't resolve component "${e}" at "${a.path}"`));const r=(s=o).__esModule||Zi&&"Module"===s[Symbol.toStringTag]?o.default:o;var s;a.components[e]=r;const l=r[t];return l&&fr(l,n,i,a,e)()}))}}var r;return o}function pr(e){const t=Kn(Ki),n=Kn(eo),i=bi(()=>t.resolve(tt(e.to))),o=bi(()=>{let{matched:e}=i.value,{length:t}=e;const o=e[t-1];let r=n.matched;if(!o||!r.length)return-1;let a=r.findIndex(lo.bind(null,o));if(a>-1)return a;let s=vr(e[t-2]);return t>1&&vr(o)===s&&r[r.length-1].path!==s?r.findIndex(lo.bind(null,e[t-2])):a}),r=bi(()=>o.value>-1&&function(e,t){for(let n in t){let i=t[n],o=e[n];if("string"==typeof i){if(i!==o)return!1}else if(!Array.isArray(o)||o.length!==i.length||i.some((e,t)=>e!==o[t]))return!1}return!0}(n.params,i.value.params)),a=bi(()=>o.value>-1&&o.value===n.matched.length-1&&co(n.params,i.value.params));return{route:i,href:bi(()=>i.value.href),isActive:r,isExactActive:a,navigate:function(n={}){return function(e){if(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;if(void 0!==e.button&&0!==e.button)return;if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}e.preventDefault&&e.preventDefault();return!0}(n)?t[tt(e.replace)?"replace":"push"](tt(e.to)):Promise.resolve()}}}const mr=wi({name:"RouterLink",props:{to:{type:[String,Object],required:!0},activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},setup(e,{slots:t,attrs:n}){const i=je(pr(e)),{options:o}=Kn(Ki),r=bi(()=>({[gr(e.activeClass,o.linkActiveClass,"router-link-active")]:i.isActive,[gr(e.exactActiveClass,o.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive}));return()=>{const o=t.default&&t.default(i);return e.custom?o:xi("a",no({"aria-current":i.isExactActive?e.ariaCurrentValue:null,onClick:i.navigate,href:i.href},n,{class:r.value}),o)}}});function vr(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}let gr=(e,t,n)=>null!=e?e:null!=t?t:n;const yr=wi({name:"RouterView",props:{name:{type:String,default:"default"},route:Object},setup(e,{attrs:t,slots:n}){const i=Kn(eo),o=Kn(Qi,0),r=bi(()=>(e.route||i).matched[o]);Qn(Qi,o+1),Qn(Ji,r);const a=et(s);var s;return qn(()=>[a.value,r.value,e.name],([e,t,n],[i,o,r])=>{t&&(t.instances[n]=e,o&&e===i&&(t.leaveGuards=o.leaveGuards,t.updateGuards=o.updateGuards)),!e||!t||o&&lo(t,o)&&i||(t.enterCallbacks[n]||[]).forEach(t=>t(e))},{flush:"post"}),()=>{const o=e.route||i,s=r.value,l=s&&s.components[e.name],c=e.name;if(!l)return n.default?n.default({Component:l,route:o}):null;const u=s.props[e.name],h=u?!0===u?o.params:"function"==typeof u?u(o):u:null,f=xi(l,no({},h,t,{onVnodeUnmounted:e=>{e.component.isUnmounted&&(s.instances[c]=null)},ref:a}));return n.default?n.default({Component:f,route:o}):f}}});function br(e){return e.reduce((e,t)=>e.then(()=>t()),Promise.resolve())}var wr=function(e,t,n){var i=t[0],o=t[1],r=t[2],a=n[3]*i+n[7]*o+n[11]*r+n[15];return a=a||1,e[0]=(n[0]*i+n[4]*o+n[8]*r+n[12])/a,e[1]=(n[1]*i+n[5]*o+n[9]*r+n[13])/a,e[2]=(n[2]*i+n[6]*o+n[10]*r+n[14])/a,e};var xr=function(e,t,n,i){var o=n[0],r=n[2],a=t[0]-o,s=t[2]-r,l=Math.sin(i),c=Math.cos(i);return e[0]=o+s*l+a*c,e[1]=t[1],e[2]=r+s*c-a*l,e};var _r=function(e,t,n,i){var o=n[1],r=n[2],a=t[1]-o,s=t[2]-r,l=Math.sin(i),c=Math.cos(i);return e[0]=t[0],e[1]=o+a*c-s*l,e[2]=r+a*l+s*c,e};var Cr=function(e,t){var n=e[0],i=e[1],o=e[2],r=t[0],a=t[1],s=t[2];return Math.abs(n-r)<=1e-6*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-s)<=1e-6*Math.max(1,Math.abs(o),Math.abs(s))};var Mr=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e};var Pr=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e};var Sr=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e};var Er=function(e,t){var n=t[0],i=t[1],o=t[2],r=n*n+i*i+o*o;r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r);return e};var Tr=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Ar=function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],y=n*s-i*a,b=n*l-o*a,w=n*c-r*a,x=i*l-o*s,_=i*c-r*s,C=o*c-r*l,M=u*m-h*p,P=u*v-f*p,S=u*g-d*p,E=h*v-f*m,T=h*g-d*m,A=f*g-d*v,O=y*A-b*T+w*E+x*S-_*P+C*M;if(!O)return null;return O=1/O,e[0]=(s*A-l*T+c*E)*O,e[1]=(o*T-i*A-r*E)*O,e[2]=(m*C-v*_+g*x)*O,e[3]=(f*_-h*C-d*x)*O,e[4]=(l*S-a*A-c*P)*O,e[5]=(n*A-o*S+r*P)*O,e[6]=(v*w-p*C-g*b)*O,e[7]=(u*C-f*w+d*b)*O,e[8]=(a*T-s*S+c*M)*O,e[9]=(i*S-n*T-r*M)*O,e[10]=(p*_-m*w+g*y)*O,e[11]=(h*w-u*_-d*y)*O,e[12]=(s*P-a*E-l*M)*O,e[13]=(n*E-i*P+o*M)*O,e[14]=(m*b-p*x-v*y)*O,e[15]=(u*x-h*b+f*y)*O,e};var Or=function(e,t,n){var i,o,r,a,s,l,c,u,h,f,d,p,m=n[0],v=n[1],g=n[2];t===e?(e[12]=t[0]*m+t[4]*v+t[8]*g+t[12],e[13]=t[1]*m+t[5]*v+t[9]*g+t[13],e[14]=t[2]*m+t[6]*v+t[10]*g+t[14],e[15]=t[3]*m+t[7]*v+t[11]*g+t[15]):(i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=i,e[1]=o,e[2]=r,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=i*m+s*v+h*g+t[12],e[13]=o*m+l*v+f*g+t[13],e[14]=r*m+c*v+d*g+t[14],e[15]=a*m+u*v+p*g+t[15]);return e};var zr=function(e,t,n){var i=n[0],o=n[1],r=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e};var Rr=function(e,t,n,i){var o,r,a,s,l,c,u,h,f,d,p=t[0],m=t[1],v=t[2],g=i[0],y=i[1],b=i[2],w=n[0],x=n[1],_=n[2];if(Math.abs(p-w)<1e-6&&Math.abs(m-x)<1e-6&&Math.abs(v-_)<1e-6)return Tr(e);u=p-w,h=m-x,f=v-_,d=1/Math.sqrt(u*u+h*h+f*f),o=y*(f*=d)-b*(h*=d),r=b*(u*=d)-g*f,a=g*h-y*u,(d=Math.sqrt(o*o+r*r+a*a))?(o*=d=1/d,r*=d,a*=d):(o=0,r=0,a=0);s=h*a-f*r,l=f*o-u*a,c=u*r-h*o,(d=Math.sqrt(s*s+l*l+c*c))?(s*=d=1/d,l*=d,c*=d):(s=0,l=0,c=0);return e[0]=o,e[1]=s,e[2]=u,e[3]=0,e[4]=r,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(o*p+r*m+a*v),e[13]=-(s*p+l*m+c*v),e[14]=-(u*p+h*m+f*v),e[15]=1,e};var Fr=function(e,t,n,i,o){var r=1/Math.tan(t/2),a=1/(i-o);return e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*i*a,e[15]=0,e};var Lr=.5*Math.PI-1e-4,Dr=.5*-Math.PI+1e-4,kr=function(e){var t=!0,n={aspectRatio:(e=e||{}).aspectRatio?e.aspectRatio:1,zoomAboutCursor:void 0===e.zoomAboutCursor||e.zoomAboutCursor,distance:void 0===e.distance?10:e.distance,phi:void 0===e.phi?0:e.phi,theta:void 0===e.theta?0:e.theta,fovY:void 0===e.fovY?Math.PI/4:e.fovY,near:void 0===e.near?.1:e.near,far:void 0===e.far?100:e.far,panDecayTime:e.panDecayTime||100,zoomDecayTime:e.zoomDecayTime||100,rotationDecayTime:e.rotationDecayTime||100,dirty:!0,up:e.up||new Float32Array([0,1,0]),center:e.center||new Float32Array(3),rotationCenter:e.rotationCenter||e.center&&e.center.slice()||new Float32Array(3),zoom:0,panX:0,panY:0,panZ:0,pitch:0,yaw:0,dTheta:0,dPhi:0,mouseX:0,mouseY:0},i=null,o={tick:function(e){if(y.zoom&&(n.zoom=y.zoom),y.dTheta&&(n.dTheta=y.dTheta),y.dPhi&&(n.dPhi=y.dPhi),y.panX&&(n.panX=y.panX),y.panY&&(n.panY=y.panY),y.panZ&&(n.panZ=y.panZ),y.yaw&&(n.yaw=y.yaw),y.pitch&&(n.pitch=y.pitch),g(y),e){var r=n.dPhi,a=n.dTheta,s=n.zoom,l=n.panX,c=n.panY,u=n.panZ,p=n.pitch,m=n.yaw;Object.assign(n,e),void 0!==e.dPhi&&(n.dPhi+=r),void 0!==e.dTheta&&(n.dTheta+=a),void 0!==e.zoom&&(n.zoom+=s),void 0!==e.panX&&(n.panX+=l),void 0!==e.panY&&(n.panY+=c),void 0!==e.panZ&&(n.panZ+=u),void 0!==e.pitch&&(n.pitch+=p),void 0!==e.yaw&&(n.yaw+=m)}Cr(n.up,h.up)&&Cr(n.center,h.center)&&n.near===h.near&&n.far===h.far&&n.phi===h.phi&&n.theta===h.theta&&n.distance===h.distance&&n.fovY===h.fovY||(d.dPhi=n.phi-h.phi,d.dTheta=n.theta-h.theta,d.zoom=n.distance/h.distance-1,n.theta=h.theta,n.distance=h.distance,n.phi=h.phi,d.yaw=0,d.pitch=0,d.panX=0,d.panY=0,d.panZ=0,d.mouseX=0,d.mouseY=0,b(d)),!function(){if(Math.abs(n.zoom)>1e-4)return!0;if(Math.abs(n.panX)>1e-4)return!0;if(Math.abs(n.panY)>1e-4)return!0;if(Math.abs(n.panZ)>1e-4)return!0;if(Math.abs(n.dTheta)>1e-4)return!0;if(Math.abs(n.dPhi)>1e-4)return!0;if(Math.abs(n.yaw)>1e-4)return!0;if(Math.abs(n.pitch)>1e-4)return!0}()?g(n):b(n);var v,w,x,_,C=Date.now();null!==i&&(v=C-i,w=n.panDecayTime?Math.exp(-v/n.panDecayTime/Math.LN2):0,x=n.zoomDecayTime?Math.exp(-v/n.zoomDecayTime/Math.LN2):0,_=n.rotationDecayTime?Math.exp(-v/n.rotationDecayTime/Math.LN2):0,n.zoom*=x,n.panX*=w,n.panY*=w,n.panZ*=w,n.dTheta*=_,n.dPhi*=_,n.yaw*=_,n.pitch*=_),i=C,o.state.dirty=t,t=!1,f()},taint:m,resize:v,params:n,rotate:function(e,t){y.dTheta+=e,y.dPhi+=t},pivot:function(e,t){var i=o.params.fovY;y.yaw+=e*i*n.aspectRatio,y.pitch+=t*i},pan:function(e,t){var i=o.params.distance*Math.tan(.5*o.params.fovY)*2;return y.panX+=e*n.aspectRatio*i,y.panY+=t*i,o},zoom:function(e,t,i){return y.zoom+=i,n.mouseX=e,n.mouseY=t,o},state:{}};o.state.projection=new Float32Array(16),o.state.viewInv=new Float32Array(16),o.state.view=new Float32Array(16),o.state.width=null,o.state.height=null,o.state.eye=new Float32Array(3);var r=new Float32Array(3),a=new Float32Array(3),s=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3),u=new Float32Array(16),h={up:new Float32Array(3),center:new Float32Array(3)};function f(){Sr(h.up,n.up),Sr(h.center,n.center),h.near=n.near,h.far=n.far,h.distance=n.distance,h.phi=n.phi,h.theta=n.theta,h.fovY=n.fovY}f();var d={};function p(){o.state.eye[0]=0,o.state.eye[1]=0,o.state.eye[2]=n.distance,_r(o.state.eye,o.state.eye,c,-n.phi),xr(o.state.eye,o.state.eye,c,n.theta),Mr(o.state.eye,o.state.eye,n.center),Rr(o.state.view,o.state.eye,n.center,n.up),Fr(o.state.projection,n.fovY,o.params.aspectRatio,n.near,n.far),Ar(o.state.viewInv,o.state.view)}function m(){t=!0}function v(e){o.params.aspectRatio=e,p(),m()}function g(e){e.zoom=0,e.dTheta=0,e.dPhi=0,e.panX=0,e.panY=0,e.panZ=0,e.yaw=0,e.pitch=0}var y={};function b(e){var t;Tr(u),n.zoomAboutCursor&&(t=n.distance*Math.tan(.5*n.fovY),r[0]=e.mouseX*n.aspectRatio*t,r[1]=e.mouseY*t,r[2]=0,Or(u,u,r)),r[0]=1+e.zoom,r[1]=1+e.zoom,r[2]=1,zr(u,u,r),n.zoomAboutCursor&&(t=n.distance*Math.tan(.5*n.fovY),r[0]=-e.mouseX*n.aspectRatio*t,r[1]=-e.mouseY*t,r[2]=0,Or(u,u,r)),u[12]-=.5*e.panX,u[13]-=.5*e.panY,wr(n.center,n.center,o.state.view),wr(n.center,n.center,u),wr(n.center,n.center,o.state.viewInv),n.rotateAboutCenter&&Sr(n.rotationCenter,n.center),n.distance*=1+e.zoom;var i=n.phi;n.phi+=e.dPhi,n.phi=Math.min(Lr,Math.max(Dr,n.phi));var c=n.phi-i,h=n.theta;n.theta+=e.dTheta;var f=n.theta-h;if(xr(n.center,n.center,n.rotationCenter,f-n.theta),_r(n.center,n.center,n.rotationCenter,-c),xr(n.center,n.center,n.rotationCenter,n.theta),0!==e.yaw||0!==e.pitch){s[0]=o.state.view[0],s[1]=o.state.view[4],s[2]=o.state.view[8],Er(s,s),a[0]=o.state.view[1],a[1]=o.state.view[5],a[2]=o.state.view[9],Er(a,a),l[0]=o.state.view[2],l[1]=o.state.view[6],l[2]=o.state.view[10],Er(l,l);var d=Math.min(Lr,Math.max(Dr,n.phi+.5*e.pitch)),v=d-n.phi;Pr(n.center,n.center,s,-Math.sin(.5*e.yaw)*n.distance),Pr(n.center,n.center,a,-Math.sin(v)*n.distance),Pr(n.center,n.center,l,(2-Math.cos(.5*e.yaw)-Math.cos(v))*n.distance),n.phi=d,n.theta+=.5*e.yaw}p(),m()}return g(y),v(o.params.aspectRatio),o};function Nr(e){return e.target||e.srcElement||window}var Ir={buttons:function(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){if(2===(t=e.which))return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){var t;if(1===(t=e.button))return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0},element:Nr,x:function(e){if("object"==typeof e){if("offsetX"in e)return e.offsetX;var t=Nr(e).getBoundingClientRect();return e.clientX-t.left}return 0},y:function(e){if("object"==typeof e){if("offsetY"in e)return e.offsetY;var t=Nr(e).getBoundingClientRect();return e.clientY-t.top}return 0}},Wr=function(e,t){t||(t=e,e=window);var n=0,i=0,o=0,r={shift:!1,alt:!1,control:!1,meta:!1},a=!1;function s(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==r.alt,r.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==r.shift,r.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==r.control,r.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==r.meta,r.meta=!!e.metaKey),t}function l(e,a){var l=Ir.x(a),c=Ir.y(a);"buttons"in a&&(e=0|a.buttons),(e!==n||l!==i||c!==o||s(a))&&(n=0|e,i=l||0,o=c||0,t&&t(n,i,o,r))}function c(e){l(0,e)}function u(){(n||i||o||r.shift||r.alt||r.meta||r.control)&&(i=o=0,n=0,r.shift=r.alt=r.control=r.meta=!1,t&&t(0,0,0,r))}function h(e){s(e)&&t&&t(n,i,o,r)}function f(e){0===Ir.buttons(e)?l(0,e):l(n,e)}function d(e){l(n|Ir.buttons(e),e)}function p(e){l(n&~Ir.buttons(e),e)}function m(){a||(a=!0,e.addEventListener("mousemove",f),e.addEventListener("mousedown",d),e.addEventListener("mouseup",p),e.addEventListener("mouseleave",c),e.addEventListener("mouseenter",c),e.addEventListener("mouseout",c),e.addEventListener("mouseover",c),e.addEventListener("blur",u),e.addEventListener("keyup",h),e.addEventListener("keydown",h),e.addEventListener("keypress",h),e!==window&&(window.addEventListener("blur",u),window.addEventListener("keyup",h),window.addEventListener("keydown",h),window.addEventListener("keypress",h)))}m();var v={element:e};return Object.defineProperties(v,{enabled:{get:function(){return a},set:function(t){t?m():function(){if(!a)return;a=!1,e.removeEventListener("mousemove",f),e.removeEventListener("mousedown",d),e.removeEventListener("mouseup",p),e.removeEventListener("mouseleave",c),e.removeEventListener("mouseenter",c),e.removeEventListener("mouseout",c),e.removeEventListener("mouseover",c),e.removeEventListener("blur",u),e.removeEventListener("keyup",h),e.removeEventListener("keydown",h),e.removeEventListener("keypress",h),e!==window&&(window.removeEventListener("blur",u),window.removeEventListener("keyup",h),window.removeEventListener("keydown",h),window.removeEventListener("keypress",h))}()},enumerable:!0},buttons:{get:function(){return n},enumerable:!0},x:{get:function(){return i},enumerable:!0},y:{get:function(){return o},enumerable:!0},mods:{get:function(){return r},enumerable:!0}}),v};var Vr={left:0,top:0},Br=function(e,t,n){t=t||e.currentTarget||e.srcElement,Array.isArray(n)||(n=[0,0]);var i=e.clientX||0,o=e.clientY||0,r=(a=t,a===window||a===document||a===document.body?Vr:a.getBoundingClientRect());var a;return n[0]=i-r.left,n[1]=o-r.top,n};function Gr(e,t){return e(t={exports:{}},t.exports),t.exports}var Yr,jr,Xr=function(e){return null!=e},Hr={object:!0,function:!0,undefined:!0},Ur=function(e){if(!function(e){return!!Xr(e)&&hasOwnProperty.call(Hr,typeof e)}(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}},qr=/^\s*class[\s{/}]/,Zr=Function.prototype.toString,$r=function(e){return!!function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!Ur(e)}(e)&&!qr.test(Zr.call(e))},Jr=function(e){return null!=e},Qr=Object.keys,Kr=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}()?Object.keys:function(e){return Qr(Jr(e)?Object(e):e)},ea=function(e){if(!Jr(e))throw new TypeError("Cannot use null or undefined");return e},ta=Math.max,na="function"==typeof(jr=Object.assign)&&(jr(Yr={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),Yr.foo+Yr.bar+Yr.trzy==="razdwatrzy")?Object.assign:function(e,t){var n,i,o,r=ta(arguments.length,2);for(e=Object(ea(e)),o=function(i){try{e[i]=t[i]}catch(e){n||(n=e)}},i=1;i<r;++i)Kr(t=arguments[i]).forEach(o);if(void 0!==n)throw n;return e},ia=Array.prototype.forEach,oa=Object.create,ra=function(e,t){var n;for(n in e)t[n]=e[n]},aa=function(e){var t=oa(null);return ia.call(arguments,(function(e){Jr(e)&&ra(Object(e),t)})),t},sa="razdwatrzy",la=String.prototype.indexOf,ca="function"==typeof sa.contains&&!0===sa.contains("dwa")&&!1===sa.contains("foo")?String.prototype.contains:function(e){return la.call(this,e,arguments[1])>-1},ua=Gr((function(e){(e.exports=function(e,t){var n,i,o,r,a;return arguments.length<2||"string"!=typeof e?(r=t,t=e,e=null):r=arguments[2],Xr(e)?(n=ca.call(e,"c"),i=ca.call(e,"e"),o=ca.call(e,"w")):(n=o=!0,i=!1),a={value:t,configurable:n,enumerable:i,writable:o},r?na(aa(r),a):a}).gs=function(e,t,n){var i,o,r,a;return"string"!=typeof e?(r=n,n=t,t=e,e=null):r=arguments[3],Xr(t)?$r(t)?Xr(n)?$r(n)||(r=n,n=void 0):n=void 0:(r=t,t=n=void 0):t=void 0,Xr(e)?(i=ca.call(e,"c"),o=ca.call(e,"e")):(i=!0,o=!1),a={get:t,set:n,configurable:i,enumerable:o},r?na(aa(r),a):a}})),ha=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},fa=Gr((function(e,t){var n,i,o,r,a,s,l,c=Function.prototype.apply,u=Function.prototype.call,h=Object.create,f=Object.defineProperty,d=Object.defineProperties,p=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var i,r;return ha(t),r=this,n.call(this,e,i=function(){o.call(r,e,i),c.call(t,this,arguments)}),i.__eeOnceListener__=t,this},a={on:n=function(e,t){var n;return ha(t),p.call(this,"__ee__")?n=this.__ee__:(n=m.value=h(null),f(this,"__ee__",m),m.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o=function(e,t){var n,i,o,r;if(ha(t),!p.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==typeof(i=n[e]))for(r=0;o=i[r];++r)o!==t&&o.__eeOnceListener__!==t||(2===i.length?n[e]=i[r?0:1]:i.splice(r,1));else i!==t&&i.__eeOnceListener__!==t||delete n[e];return this},emit:r=function(e){var t,n,i,o,r;if(p.call(this,"__ee__")&&(o=this.__ee__[e]))if("object"==typeof o){for(n=arguments.length,r=new Array(n-1),t=1;t<n;++t)r[t-1]=arguments[t];for(o=o.slice(),t=0;i=o[t];++t)c.call(i,this,r)}else switch(arguments.length){case 1:u.call(o,this);break;case 2:u.call(o,this,arguments[1]);break;case 3:u.call(o,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=new Array(n-1),t=1;t<n;++t)r[t-1]=arguments[t];c.call(o,this,r)}}},s={on:ua(n),once:ua(i),off:ua(o),emit:ua(r)},l=d({},s),e.exports=t=function(e){return null==e?h(l):d(Object(e),s)},t.methods=a})),da=(fa.methods,function(e){e=e||window;var t,n,i,o,r=fa(),a=[null,null],s=[null,null],l=[null,null],c=[null,null],u=0,h={},f=e===window?function(){t=window.innerWidth,n=window.innerHeight}:function(){t=e.clientWidth,n=e.clientHeight},d=0,p={},m=Wr(e,(function(e,t,n,r){i=t,o=n,d=e,p=r}));function v(i){Br(i,e,l),f(),h.buttons=d,h.mods=p,h.x0=h.x=h.x1=2*l[0]/t-1,h.y0=h.y=h.y1=1-2*l[1]/n,h.x2=null,h.y2=null,h.dx=2*i.deltaX/t,h.dy=-2*i.deltaY/n,h.dz=2*i.deltaZ/t,h.active=1,h.zoomx=1,h.zoomy=1,h.theta=0,h.dtheta=0,h.originalEvent=i,r.emit("wheel",h),a[0]=l[0],a[1]=l[1]}var g=null,y=null,b=0;function w(i){Br(i,e,l),b=0,f(),h.buttons=d,h.mods=p,h.x=h.x1=2*l[0]/t-1,h.y=h.y1=1-2*l[1]/n,h.x2=null,h.y2=null,h.active=b,h.x0=2*g/t-1,h.y0=1-2*y/n,h.dx=0,h.dy=0,h.dz=0,h.zoomx=1,h.zoomy=1,h.theta=0,h.dtheta=0,h.originalEvent=i,r.emit("mouseup",h),g=y=null,a[0]=l[0],a[1]=l[1]}function x(s){Br(s,e,l),b=1,f(),g=i,y=o,h.buttons=d,h.mods=p,h.x=h.x0=h.x1=2*l[0]/t-1,h.y=h.y0=h.y1=1-2*l[1]/n,h.x2=null,h.y2=null,h.active=b,h.dx=0,h.dy=0,h.dz=0,h.zoomx=1,h.zoomy=1,h.theta=0,h.dtheta=0,h.originalEvent=s,r.emit("mousedown",h),a[0]=l[0],a[1]=l[1]}function _(i){Br(i,e,l),f(),h.buttons=d,h.mods=p,h.x0=2*g/t-1,h.y0=1-2*y/n,h.x=h.x1=2*l[0]/t-1,h.y=h.y1=1-2*l[1]/n,h.x2=null,h.y2=null,h.dx=2*(l[0]-a[0])/t,h.dy=-2*(l[1]-a[1])/n,h.active=b,h.dz=0,h.zoomx=1,h.zoomy=1,h.theta=0,h.dtheta=0,h.originalEvent=i,r.emit("mousemove",h),a[0]=l[0],a[1]=l[1]}function C(e){for(var t=e.identifier,n=0;n<c.length;n++)if(c[n]&&c[n].touch&&c[n].touch.identifier===t)return n;return-1}function M(i){s[0]=null,s[1]=null;for(var o=0;o<i.changedTouches.length;o++){var a=i.changedTouches[o];if(-1===C(a.identifier)&&u<2){var l=c[0]?1:0,d=c[0]?0:1,p={position:[0,0],touch:null};c[l]=p,u++,p.touch=a,Br(a,e,p.position);c[d]&&c[d].touch}}var m=0,v=0,b=0;for(o=0;o<c.length;o++)c[o]&&(m+=c[o].position[0],v+=c[o].position[1],b++);if(m/=b,v/=b,u>0){if(h.theta=0,b>1){var w=c[1].position[0]-c[0].position[0],x=(c[0].position[1]-c[1].position[1])*t/n;h.theta=Math.atan2(x,w)}f(),h.buttons=0,h.mods={},h.active=u,g=m,y=v,h.x0=2*g/t-1,h.y0=1-2*y/n,h.x=2*m/t-1,h.y=1-2*v/n,h.x1=2*c[0].position[0]/t-1,h.y1=1-2*c[0].position[1]/n,u>1&&(h.x2=2*c[1].position[0]/t-1,h.y2=1-2*c[1].position[1]/n),h.active=u,h.dx=0,h.dy=0,h.dz=0,h.zoomx=1,h.zoomy=1,h.dtheta=0,h.originalEvent=i,r.emit(1===u?"touchstart":"pinchstart",h)}}function P(i){for(var o,a=!1,l=0;l<i.changedTouches.length;l++){var f=i.changedTouches[l];-1!==(o=C(f))&&(a=!0,c[o].touch=f,Br(f,e,c[o].position))}if(a)if(1===u){for(o=0;o<c.length&&!c[o];o++);if(c[o]&&s[o]){var d=c[o].position[0],m=c[o].position[1],v=d-s[o][0],b=m-s[o][1];h.buttons=0,h.mods={},h.active=u,h.x=h.x1=2*d/t-1,h.y=h.y1=1-2*m/n,h.x2=null,h.y2=null,h.x0=2*g/t-1,h.y0=1-2*y/n,h.dx=2*v/t,h.dy=-2*b/n,h.dz=0,h.zoomx=1,h.zoomy=1,h.theta=0,h.dtheta=0,h.originalEvent=i,r.emit("touchmove",h)}}else if(2===u&&s[0]&&s[1]){var w=s[0],x=s[1],_=x[0]-w[0],M=(x[1]-w[1])*t/n,P=c[0].position,S=c[1].position,E=S[0]-P[0],T=(P[1]-S[1])*t/n,A=.5*Math.sqrt(_*_+M*M),O=Math.atan2(M,_),z=.5*Math.sqrt(E*E+T*T),R=Math.atan2(T,E),F=.5*(x[0]+w[0]),L=.5*(x[1]+w[1]),D=(v=.5*(S[0]+P[0]-w[0]-x[0]),b=.5*(S[1]+P[1]-w[1]-x[1]),z/A),k=R-O;h.buttons=0,h.mods=p,h.active=u,h.x=2*F/t-1,h.y=1-2*L/n,h.x0=2*g/t-1,h.y0=1-2*y/n,h.x1=2*P[0]/t-1,h.y1=1-2*P[1]/n,h.x2=2*S[0]/t-1,h.y2=1-2*S[1]/n,h.dx=2*v/t,h.dy=-2*b/n,h.dz=0,h.zoomx=D,h.zoomy=D,h.theta=R,h.dtheta=k,h.originalEvent=i,r.emit("pinchmove",h)}c[0]&&(s[0]=c[0].position.slice()),c[1]&&(s[1]=c[1].position.slice())}function S(e){for(var i,o=0;o<e.changedTouches.length;o++){var a=C(e.changedTouches[o]);if(-1!==a){i=c[a],c[a]=null,u--;var s=0===a?1:0;c[s]&&c[s].touch}}var l=0,f=0;if(0===u)i&&(l=i.position[0],f=i.position[1]);else{var d=0;for(o=0;o<c.length;o++)c[o]&&(l+=c[o].position[0],f+=c[o].position[1],d++);l/=d,f/=d}u<2&&(h.buttons=0,h.mods=p,h.active=u,h.x=2*l/t-1,h.y=1-2*f/n,h.x0=2*g/t-1,h.y0=1-2*y/n,h.dx=0,h.dy=0,h.dz=0,h.zoomx=1,h.zoomy=1,h.theta=0,h.dtheta=0,h.originalEvent=e,r.emit(0===u?"touchend":"pinchend",h)),0===u&&(g=y=null)}var E=!1;function T(){E||(E=!0,m.enabled=!0,e.addEventListener("wheel",v,!1),e.addEventListener("mousedown",x,!1),window.addEventListener("mousemove",_,!1),window.addEventListener("mouseup",w,!1),e.addEventListener("touchstart",M,!1),window.addEventListener("touchmove",P,!1),window.addEventListener("touchend",S,!1),window.addEventListener("touchcancel",S,!1))}return T(),r.enable=T,r.disable=function(){if(!E)return;E=!1,m.enabled=!1,e.removeEventListener("wheel",v,!1),e.removeEventListener("mousedown",x,!1),window.removeEventListener("mousemove",_,!1),window.removeEventListener("mouseup",w,!1),e.removeEventListener("touchstart",M,!1),window.removeEventListener("touchmove",P,!1),window.removeEventListener("touchend",S,!1),window.removeEventListener("touchcancel",S,!1)},r});class pa{constructor(e,t,n,i){let o,r;for(this.stability=null!=e?Math.abs(e):8,this.sensitivity=null!=t?1+Math.abs(t):100,this.tolerance=null!=n?1+Math.abs(n):1.1,this.delay=null!=i?i:150,this.lastUpDeltas=[],o=1,r=2*this.stability;1<=r?o<=r:o>=r;1<=r?o++:o--)this.lastUpDeltas.push(null);for(this.lastDownDeltas=[],o=1,r=2*this.stability;1<=r?o<=r:o>=r;1<=r?o++:o--)this.lastDownDeltas.push(null);for(this.deltasTimestamp=[],o=1,r=2*this.stability;1<=r?o<=r:o>=r;1<=r?o++:o--)this.deltasTimestamp.push(null)}check(e){var t;return null!=(e=e.originalEvent||e).wheelDelta?t=e.wheelDelta:null!=e.deltaY?t=-40*e.deltaY:null==e.detail&&0!==e.detail||(t=-40*e.detail),this.deltasTimestamp.push(Date.now()),this.deltasTimestamp.shift(),t>0?(this.lastUpDeltas.push(t),this.lastUpDeltas.shift(),this.isInertia(1)):(this.lastDownDeltas.push(t),this.lastDownDeltas.shift(),this.isInertia(-1))}isInertia(e){var t,n,i,o,r,a,s;return null===(t=-1===e?this.lastDownDeltas:this.lastUpDeltas)[0]?e:!(this.deltasTimestamp[2*this.stability-2]+this.delay>Date.now()&&t[0]===t[2*this.stability-1])&&(i=t.slice(0,this.stability),n=t.slice(this.stability,2*this.stability),s=i.reduce((function(e,t){return e+t})),r=n.reduce((function(e,t){return e+t})),a=s/i.length,o=r/n.length,Math.abs(a)<Math.abs(o*this.tolerance)&&this.sensitivity<Math.abs(o)&&e)}showLastUpDeltas(){return this.lastUpDeltas}showLastDownDeltas(){return this.lastDownDeltas}}function ma(e,t){const{position:n,target:i}=e,o=[-i[0]+n[0],-i[1]+n[1],-i[2]+n[2]],r=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);let a=Math.atan2(o[1],o[0]);a+=a<0?Math.PI:0;const s=Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),o[2]),l=Object.assign({},e,{zoomDecayTime:100,distance:r,phi:a,theta:s,center:i,aspectRatio:t._gl.canvas.clientWidth/t._gl.canvas.clientHeight}),c=kr(l);!function(e,t,{minDistance:n,maxDistance:i}){const o=new pa,r={left:37,up:38,right:39,down:40};window.addEventListener("keydown",(function(t){switch(t.keyCode){case r.left:e.pan(.01,0);break;case r.up:e.pan(0,-.01);break;case r.right:e.pan(-.01,0);break;case r.down:e.pan(0,.01)}}));const a=.5*Math.PI;da(t).on("wheel",(function(t){t.active&&!1!==o.check(t)&&(e.params.distance<=i&&e.zoom(t.x,t.y,Math.exp(-t.dy)-1),e.params.distance=Math.max(n,Math.min(i,e.params.distance)))})).on("mousemove",(function(t){t.active&&1===t.buttons&&(t.mods.shift?e.pan(t.dx,t.dy):t.mods.meta||e.rotate(-t.dx*a,-t.dy*a))})).on("touchmove",(function(t){t.active&&e.rotate(-t.dx*a,-t.dy*a)}))}(c,t._gl.canvas,{minDistance:e.minDistance||.1,maxDistance:e.maxDistance||10}),c.toConfig=()=>({center:c.params.center,theta:c.params.theta,phi:c.params.phi,distance:c.params.distance});const u=t({uniforms:{projection:(e,t)=>(t.resize(e.viewportWidth/e.viewportHeight),t.state.projection),iProj:(e,t)=>Ar([],t.state.projection),view:(e,t)=>t.state.view,eye:(e,t)=>t.state.eye}});return[c,u]}const va={name:"PHOTON",mass__eVc_2:0,charge__qe:0,chargeMassRatio__Ckg_1:0,id:0,color:[.92,.75,0],icolor:[237,197,0]},ga={name:"ELECTRON",mass__eVc_2:510998.94,chargeMassRatio__Ckg_1:-175882004556.243,charge__qe:-1,id:1,color:[.12,.45,.65],icolor:[33,116,168]},ya={name:"POSITRON",mass__eVc_2:510998.94,chargeMassRatio__Ckg_1:175882004556.243,charge__qe:1,id:2,color:[.22,.9,.9],icolor:[133,116,168]},ba={name:"PROTON",mass__eVc_2:938272081,charge__qe:1,chargeMassRatio__Ckg_1:95788332.3113771,id:3,color:[.77,.2,.2],icolor:[197,50,40]},wa=[va,ga,ya,ba],xa=new Map(wa.map(e=>[e.name,e]));var _a=e=>xa.get(e);function Ca({n:e=0,d:t=0}){const n=t*(e-1)/2;return[...Array(e)].fill(0).map((e,i)=>[0,i*t-n,0]).reduce((e,t)=>e.concat(t),[])}var Ma={sum:function(e){var t=0;if(e.constructor===Array&&e.length)for(var n=0,i=e.length;n<i;++n)t+=e[n];else if(e.constructor===Object)for(var o in e)e.hasOwnProperty(o)&&(t+=e[o]);return t},mean:function(e){var t,n=this.sum(e);if(e.constructor===Array&&e.length)t=e.length;else if(e.constructor===Object)for(var i in t=0,e)e.hasOwnProperty(i)&&++t;return n/t},variance:function(e,t){t=t?1:0;var n=this.mean(e),i=0,o=0;if(e.constructor===Array&&e.length){i=e.length;for(var r=0;r<i;++r)o+=Math.pow(e[r]-n,2)}else if(e.constructor===Object)for(var a in i=0,e)e.hasOwnProperty(a)&&(o+=Math.pow(e[a]-n,2),++i);if(i<2)throw new Error("variance not defined for length < 2");return o/(i-t)},std:function(e,t){return Math.sqrt(this.variance(e,t))},norm:function(e,t){var n,i,o,r=0;if(e)if(t)switch(t.toLowerCase()){case"l1":if(e.constructor===Array&&e.length)for(o=e.length,n=0;n<o;++n)r+=Math.abs(e[n]);else if(e.constructor===Object)for(i in e)e.hasOwnProperty(i)&&(r+=Math.abs(e[i]));break;case"euclidean":if(e.constructor===Array&&e.length)for(o=e.length,n=0;n<o;++n)r+=Math.pow(e[n],2);else if(e.constructor===Object)for(i in e)e.hasOwnProperty(i)&&(r+=Math.pow(e[i],2));r=Math.sqrt(r);break;case"max":if(e.constructor===Array&&e.length)r=Math.max.apply(null,e);else if(e.constructor===Object)for(i in r=null,e)e.hasOwnProperty(i)&&(r=null===r?e[i]:Math.max(r,e[i]));break;case"min":if(e.constructor===Array&&e.length)r=Math.min.apply(null,e);else if(e.constructor===Object)for(i in r=null,e)e.hasOwnProperty(i)&&(r=null===r?e[i]:Math.min(r,e[i]));break;default:r=this.sum(e)}else r=this.sum(e);return r},rescale:function(e,t){if(e&&t)if(e.constructor===Array&&e.length)for(var n=0,i=e.length;n<i;++n)e[n]/=t;else if(e.constructor===Object)for(var o in e)e.hasOwnProperty(o)&&(e[o]/=t);return e},standardize:function(e,t){return this.rescale(e,this.std(e,t))},normalize:function(e,t){return this.rescale(e,this.norm(e,t))}};let Pa=1;const Sa=()=>{let e=1e4*Math.sin(Pa++);return e-Math.floor(e)},Ea=(e=-1,t=1)=>Sa()*(t-e)+e;function Ta({particleCount:e=3,particleTypeDescriptor:t="PHOTON ELECTRON PROTON",bunchShape:n="ROW",particleSeparation:i=.1,gamma:o=1,position:r=[0,0,0],direction:a=[0,0,1],positionJitter:s=[0,0,0],directionJitter:l=[0,0,0]}){const c=function(e,t=0){const n=e.trim().split(/\s+/).map(e=>_a(e));return 0===t?n:Array(t).fill(0).map((e,t)=>n[t%n.length])}(t,e);if(-1===["SQUARE","ROW","DISC","DISC_YZ","COLUMN","SQUARE_YZ","SQUARE_HORIZONTAL"].indexOf(n))throw new Error("unknown distribution type");const u="SQUARE"===n?function({n:e=0,d:t=0}){const n=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/n),o=t*(n-1)/2,r=t*(i-1)/2;return[...Array(e)].fill(0).map((e,i)=>{const a=i%n,s=Math.floor(i/n);return[a*t-o,s*t-r,0]}).reduce((e,t)=>e.concat(t),[])}({n:e,d:i}):"SQUARE_YZ"===n?function({n:e=0,d:t=0}){const n=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/n),o=t*(n-1)/2,r=t*(i-1)/2;return Array(e).fill(0).map((e,i)=>{const a=i%n;return[0,Math.floor(i/n)*t-r,a*t-o]}).reduce((e,t)=>e.concat(t),[])}({n:e,d:i}):"DISC"===n?function({n:e=0,d:t=0}){const n=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/n),o=t*(n-1)/2,r=t*(i-1)/2;return Array(e).fill(0).map((e,i)=>{const a=i%n,s=Math.floor(i/n);return(a*t-o)**2+(s*t-r)**2<(n*t/2)**2?[a*t-o,s*t-r,0]:[a*t-o,s*t-r-1e4,0]}).reduce((e,t)=>e.concat(t),[])}({n:e,d:i}):"DISC_YZ"===n?function({n:e=0,d:t=0}){const n=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/n),o=t*(n-1)/2,r=t*(i-1)/2;return Array(e).fill(0).map((e,i)=>{const a=i%n,s=Math.floor(i/n);return(a*t-o)**2+(s*t-r)**2<(n*t/2)**2?[0,s*t-r,a*t-o]:[0,s*t-r-1e4,a*t-o]}).reduce((e,t)=>e.concat(t),[])}({n:e,d:i}):"SQUARE_HORIZONTAL"===n?function({n:e=0,d:t=0}){const n=Math.ceil(Math.sqrt(e)),i=Math.ceil(e/n),o=t*(n-1)/2,r=t*(i-1)/2;return Array(e).fill(0).map((e,i)=>{const a=i%n,s=Math.floor(i/n);return[a*t-o,0,s*t-r]}).reduce((e,t)=>e.concat(t),[])}({n:e,d:i}):"ROW"===n?function({n:e=0,d:t=0}){const n=t*(e-1)/2;return[...Array(e)].fill(0).map((e,i)=>[i*t-n,0,0]).reduce((e,t)=>e.concat(t),[])}({n:e,d:i}):Ca({n:e,d:i}),h=c.map((e,t)=>{const n=function({position:e=[0,0,0],jitter:t=[0,0,0]}){return e.map((e,n)=>e+Math.floor(Ea()*t[n]*100)/100)}({position:r,jitter:s});return[u[3*t]+n[0],u[3*t+1]+n[1],u[3*t+2]+n[2],0]}).reduce((e,t)=>e.concat(t),[]),f=c.map((e,t)=>{const n=0===e.mass__eVc_2?1:function(e=0){return 0===e?NaN:Math.sqrt(1-1/Math.pow(e,2))}(o),i=function({direction:e=[0,0,1],directionJitter:t=[0,0,0],localPosition:n=[0,0,0]}){const i=e.map((e,i)=>e+Math.floor(Math.abs(Ea())*n[i]*t[i]*100)/100);return Ma.normalize(i,"Euclidean")}({direction:a,directionJitter:l,localPosition:[u[3*t],u[3*t+1],u[3*t+2]]});return[n*i[0],n*i[1],n*i[2],o]}),d=c.map((e,t)=>[(0===e.mass__eVc_2?1:o)*f[t][0],(0===e.mass__eVc_2?1:o)*f[t][1],(0===e.mass__eVc_2?1:o)*f[t][2],o]).reduce((e,t)=>e.concat(t),[]);return{fourPositions:h,fourVelocities:d.reduce((e,t)=>e.concat(t),[]),fourMomenta:d,particleTypes:c.map(e=>e.id)}}function Aa(e,{variables:t,model:n}){const i={},o=Object.keys(t).filter(e=>"position"===e||"velocity"===e);o.forEach(e=>{i[e]=[new Float32Array(n.particleCount*n.bufferLength*4),new Float32Array(n.particleCount*n.bufferLength*4)]}),o.forEach(n=>{e({framebuffer:t[n][0]})(()=>{e.read({data:i[n][0]})}),e({framebuffer:t[n][1]})(()=>{e.read({data:i[n][1]})})});return{tick:t.tick.value,data:{position:Object.values(i.position[t.tick.value%2]).map(e=>Math.floor(1e3*e)/1e3),velocity:Object.values(i.velocity[t.tick.value%2]).map(e=>Math.floor(1e3*e)/1e3),particleTypes:t.initialData.particleTypes}}}function Oa(e,t,n,i){return[0,1].map(()=>e.framebuffer({height:4*n,width:t,format:"rgba",colorType:i,depthStencil:!1,color:e.texture({width:t,height:4*n,min:"nearest",mag:"nearest",format:"rgba",type:i})}))}function za(e,t,n){return[0,1].forEach(i=>e[i].color[0].subimage({width:e[i].width,height:e[i].height,data:"float"===n?t:Ra(t)})),e}function Ra(e){const t=new Uint16Array(e.length);return e.forEach((function(e,n){t[n]=function(e){const t=new Float32Array(1),n=new Int32Array(t.buffer);t[0]=e;const i=n[0];let o=i>>16&32768,r=i>>12&2047,a=i>>23&255;return a<103?o:a>142?(o|=31744,o|=(255===a?0:1)&&8388607&i,o):a<113?(r|=2048,o|=(r>>114-a)+(r>>113-a&1),o):(o|=a-112<<10|r>>1,o+=1&r,o)}(e)})),t}const Fa="QUAD",La=["DRIF","SBEN","QUAD"],Da={DRIF:[.2,.2,.2],QUAD:[.17,.03,.02],QUAD1:[.27,.13,.12],SBEN:[.6,.3,0]};class ka{constructor(e){if(void 0===e)throw new Error("no default constructor");this.origin=e.origin||{phi:0,position:[0,0,0]};let t=0;this.beamline=e.beamline.map(n=>{if(!e.elements[n])throw new Error(`element ${n} not defined`);const i=e.elements[n];return t+=i.l,{...i,local_z_min:t-i.l,local_z_max:t}});const n=this.startEnds;this.beamline.forEach((e,t)=>{e.start=n[t].start,e.end=n[t].end})}segmentIndexForZ(e){const t=e%this.length();for(let e=0;e<Math.min(this.beamline.length,1e3);e++)if(t>=this.beamline[e].local_z_min&&t<=this.beamline[e].local_z_max)return e}length(){return this.beamline.length&&this.beamline[this.beamline.length-1].local_z_max}toGLSLDefinition(){const e=this.startEnds;return this.beamline.map((t,n)=>`beamline[${n}] = BeamlineElement(\n            vec3(${e[n].start.join(",")}),\n            vec3(${e[n].end.join(",")}),\n            ${La.indexOf(t.type)},\n            ${t.strength?t.strength.toFixed(10):"0."})`).join(",")}getClosestBeamlineElement(e){let t=1e3,n=0;const i=this.startEnds;for(let o=0;o<this.beamline.length;o++){const r=Math.pow(e[0]-i[o].start[0],2)+Math.pow(e[1]-i[o].start[1],2)+Math.pow(e[2]-i[o].start[2],2);r<t&&(n=o,t=r)}return this.beamline[n]}get startEnds(){let e=this.origin.phi,[t,n,i]=this.origin.position;return this.beamline.map(o=>{const r=[t,n,i],a=o.angle?e+o.angle/2:e,s=[t-Math.sin(a)*o.l,n,i+Math.cos(a)*o.l];return[t,n,i]=s,e=o.angle?e+o.angle:e,{start:r,end:s}})}get transformations(){let e=this.origin.phi,[t,n,i]=this.origin.position;return this.beamline.map(o=>{const r=[t,n,i],a=o.angle?e+o.angle/2:e,s=[t-Math.sin(a)*o.l,n,i+Math.cos(a)*o.l],l=[(r[0]+s[0])/2,n,(r[2]+s[2])/2];return[t,n,i]=s,e=o.angle?e+o.angle:e,{translation:l,phi:a,scale:[1,1,1]}})}get colors(){return this.beamline.map(e=>e.type===Fa&&e.k1<0?Da.QUAD1:Da[e.type])}}class Na{constructor(e,t,n){this._regl=e,this._logStore=[],this.configuration=t,this.configuration.simulate=!0,this.RTTFloatType=t.simulateHalfFloat?"half float":n.RTTFloatType;const{particleCount:i,bufferLength:o,fourPositions:r,particleTypes:a,fourVelocities:s}=this.initialData=function(e,{randomize:t,bunchShape:n,particleCount:i,particleType:o,particleSeparation:r,direction:a,position:s,directionJitter:l,positionJitter:c,gamma:u}){let h=new Float32Array(i*e*4),f=new Float32Array(i*e*4),d=new Array(i);if(t){for(let e=0;e<i;e++)h[4*e]=.1*Ea(),h[4*e+1]=.1*Ea(),h[4*e+2]=.1*Ea(),h[4*e+3]=0,f[4*e]=Ea(),f[4*e+1]=Ea(),f[4*e+2]=Ea(),f[4*e+3]=0,d[e]=Math.floor(4*Sa());h=new Float32Array([...h,...h,...h,...h].concat(new Array(i*(e-1)*4*4).fill(0))),f=new Float32Array([...f,...f,...f,...f].concat(new Array(i*(e-1)*4*4).fill(0)))}else{const t=Ta({particleCount:i,particleTypeDescriptor:o,bunchShape:n,particleSeparation:r,gamma:u,position:s,positionJitter:c,direction:a,directionJitter:l});h=new Float32Array([...t.fourPositions,...t.fourPositions,...t.fourPositions,...t.fourPositions].concat(new Array(i*(e-1)*4*4).fill(0))),f=new Float32Array([...t.fourVelocities,...t.fourVelocities,...t.fourVelocities,...t.fourVelocities].concat(new Array(i*(e-1)*4*4).fill(0))),d=t.particleTypes}return{particleCount:i,bufferLength:e,fourPositions:h,fourVelocities:f,particleTypes:d}}(t.model.bufferLength,t.model.emitter);this.variables={initialData:this.initialData,position:za(Oa(e,i,o,this.RTTFloatType),r,this.RTTFloatType),velocity:za(Oa(e,i,o,this.RTTFloatType),s,this.RTTFloatType),tick:{value:0},referencePoint:[0,0,0],pingPong:0,particleColorsAndTypes:e.texture({data:a.map(e=>t.colors[e].concat(e)).flat(),shape:[i,1,4],type:"float"}),particleChargesMassesChargeMassRatios:e.texture({data:a.map(e=>[t.charge[e],t.mass[e],t.chargeMassRatio[e],e]).flat(),shape:[i,1,4],type:"float"})},this.model={halfDeltaTOverC:this.configuration.model.tickDurationOverC/2,particleCount:this.initialData.particleCount,particleTypes:this.initialData.particleTypes,bufferLength:this.initialData.bufferLength,stepCount:this.configuration.runner.stepCount,boundingBoxSize:this.configuration.model.boundingBoxSize,latticeConfig:this.configuration.model.lattice,lattice:new ka(this.configuration.model.lattice),interactions:{gravityConstant:this.configuration.model.interactions.gravityConstant,particleInteraction:this.configuration.model.interactions.particleInteraction,electricField:this.configuration.model.interactions.electricField,magneticField:this.configuration.model.interactions.magneticField}},t.simulate&&(this.push=function(e,{variables:t,model:n}){const i=i=>{return e({framebuffer:(e,n)=>t[i][n.pathiclesTick%2],primitive:"triangles",elements:null,offset:0,dither:!1,count:3,attributes:{aXY:[-4,-4,4,-4,0,4]},uniforms:{boundingBoxSize:n.boundingBoxSize,bufferLength:n.bufferLength,particleCount:n.particleCount,tick:e.prop("pathiclesTick"),halfDeltaTOverC:n.halfDeltaTOverC,particleInteraction:n.interactions.particleInteraction?1:0,gravityConstant:n.interactions.gravityConstant,electricField:n.interactions.electricField||[0,0,0],magneticField:n.interactions.magneticField||[0,0,1],utParticleChargesMassesChargeMassRatios:()=>t.particleChargesMassesChargeMassRatios,utPositionBuffer:(e,n)=>t.position[(n.pathiclesTick+1)%2],utVelocityBuffer:(e,n)=>"position"===i?t.velocity[n.pathiclesTick%2]:t.velocity[(n.pathiclesTick+1)%2]},vert:"\n        precision highp float;\n        attribute vec2 aXY;\n        void main () {\n          gl_Position = vec4(aXY, 0, 1);\n        }\n        ",frag:`\n        precision highp float;\n        //#extension WEBGL_color_buffer_float : enable\n\n        const highp float c = 2.99792458e+8;\n        uniform sampler2D utParticleColorAndType;\n        uniform sampler2D utParticleChargesMassesChargeMassRatios;\n        uniform sampler2D utPositionBuffer;\n        uniform sampler2D utVelocityBuffer;\n        uniform float tick;\n        uniform float halfDeltaTOverC;\n        uniform float boundingBoxSize;\n        uniform float particleCount;\n        uniform float bufferLength;\n        uniform float gravityConstant;\n        uniform vec3 electricField;\n        uniform vec3 magneticField;\n        uniform float particleInteraction;\n\n        \n  struct ParticleData {\n    float charge;\n    float mass;\n    float chargeMassRatio;\n    float particleType;\n  };\n  vec4 EncodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n  }\n  float DecodeFloatRGBA( vec4 rgba ) {\n    return dot( rgba, vec4(1.0, 1./255.0, 1./65025.0, 1./16581375.0) );\n  }\n  ParticleData getParticleData(float p) {\n    vec2 coords = vec2(p, 0.) / vec2(particleCount, 1.);\n    vec4 data = texture2D(utParticleChargesMassesChargeMassRatios, coords);\n    return ParticleData(data.x, data.y, data.z, data.w);\n  }\n  vec4 get_color(float p) {\n    vec2 coords = vec2(p, 0.) / vec2(particleCount, 1.);\n    return texture2D(utParticleColorAndType, coords);\n  }\n  vec4 get_position(float p, float b) {\n    vec2 coords = vec2(p, b) / vec2(particleCount, bufferLength);\n    return texture2D(utPositionBuffer, coords);\n  }\n  vec4 get_velocity(float p, float b) {\n    vec2 coords = vec2(p, b) / vec2(particleCount, bufferLength);\n    return texture2D(utVelocityBuffer, coords);\n  }\n\n        ${o=n.lattice,`\n  int BEAMLINE_ELEMENT_TYPE_DRIFT = 0;\n  int BEAMLINE_ELEMENT_TYPE_DIPOLE = 1;\n  int BEAMLINE_ELEMENT_TYPE_QUADRUPOLE = 2;\n  struct BeamlineElement {\n    vec3 start;\n    vec3 end;\n    int type; //0: drift, 1: dipole, 2: quadrupole\n    float strength;\n  };\n\n  ${o.beamline.length>0?"BeamlineElement beamline["+o.beamline.length+"];":"BeamlineElement beamline[1];"}\n\n  BeamlineElement getBeamlineElement(float id) {\n    for (int i=0; i < ${Math.min(o.beamline.length,100)}; i++) {\n        if (float(i) == id) return beamline[i];\n    }\n  }\n\n  BeamlineElement getClosestBeamlineElement(vec3 position) {\n\n    float bestLength = 50.;\n    int bestIndex = 0;\n\n    for (int i=0; i < ${o.beamline.length}; i++) {\n\n      BeamlineElement bl = getBeamlineElement(float(i));\n      float currentLength = length(position - (bl.start+bl.end)/2.) ;\n      if (currentLength < bestLength) {\n\n        bestIndex = i;\n        bestLength = currentLength;\n      }\n    }\n    return getBeamlineElement(float(bestIndex));\n  }\n\n  void initLatticeData() {\n    ${o.toGLSLDefinition()};\n  }\n  `}\n\n        float insideBox3D(vec3 v, vec3 bottomLeft, vec3 topRight) {\n          vec3 s = step(bottomLeft, v) - step(topRight, v);\n          return s.x * s.y * s.z;\n        }\n\n        vec3 getE(vec3 position) {\n\n          vec3 E = electricField;\n          return E;\n\n          // if (particleInteraction != 0.) {\n          //   for ( int p2 = 0; p2 < 24; p2++ ) {\n          //     if ( p == float(p2) ) { continue; }\n          //       ParticleData particleData2 = getParticleData(float(p2));\n          //     if (particleData2.charge > 0.) {\n          //       vec3 position2 = get_position(float(p2), previousBufferHead).xyz;\n          //       // float particleCharge2 = 1.; // POSITRON / PROTRON\n          //       // if (particleType == 1.) { // ELECTRON\n          //       //     particleCharge2 = charge_unit_qe[1];\n          //       //  }\n          //       vec3 dPosition = position2 - position;\n          //       float distance = length( dPosition );\n          //       E += .000000000001 *  particleData.charge * particleData2.charge / (distance * distance) * normalize(dPosition);\n          //     }\n          //   }\n          // }\n\n        }\n\n        vec3 getB(vec3 position) {\n\n          BeamlineElement ble = getClosestBeamlineElement(position);\n\n          vec3 B = magneticField;\n\n          if (ble.type == BEAMLINE_ELEMENT_TYPE_DIPOLE) {\n            B += vec3(0., ble.strength, 0.);\n          } else if (ble.type == BEAMLINE_ELEMENT_TYPE_QUADRUPOLE) {\n          B += (ble.strength > 0.) ?\n              ble.strength * vec3(0, position.z, position.y - 2.)\n              : abs(ble.strength) * vec3(0, -position.z, -(position.y- 2.));\n              }\n           return B;\n        }\n\n        vec4 push_position(float p, float bufferHead, float previousBufferHead) {\n\n          ParticleData particleData = getParticleData(p);\n          vec4 previousValue = get_position(p, previousBufferHead);\n\n          vec3 previousPosition = previousValue.xyz;\n          float previousTime  = previousValue.w;\n\n          vec3 previousMomentum = get_velocity(p, previousBufferHead).xyz;\n          vec3 currentMomentum = get_velocity(p, bufferHead).xyz;\n\n          float nextTime = previousTime + 2. * halfDeltaTOverC;\n\n          return (particleData.particleType < .1)\n            ? vec4(previousPosition + previousMomentum / sqrt(1. + dot(previousMomentum, previousMomentum)) * halfDeltaTOverC + currentMomentum / sqrt(1. + dot(currentMomentum, currentMomentum)) * halfDeltaTOverC, nextTime)\n            : vec4(previousPosition + previousMomentum / sqrt(1. + dot(previousMomentum, previousMomentum)) * halfDeltaTOverC + currentMomentum / sqrt(1. + dot(currentMomentum, currentMomentum)) * halfDeltaTOverC, nextTime);\n        }\n\n\n        vec4 push_velocity(float p, float bufferHead, float previousBufferHead) {\n\n          ParticleData particleData = getParticleData(p);\n          vec3 momentum;\n\n\n\n          vec4 previous4Position = get_position(p, previousBufferHead);\n          vec4 previous4Velocity = get_velocity(p, previousBufferHead);\n          vec3 previousVelocity = previous4Velocity.xyz;\n          float previousGamma = previous4Velocity.w;\n\n          vec3 intermediatePosition = previous4Position.xyz + previousVelocity * halfDeltaTOverC;\n          vec3 E = getE(intermediatePosition);\n          vec3 B = getB(intermediatePosition);\n\n          momentum = previousVelocity;\n          if (particleData.particleType < .1) {\n\n\n          } else {\n\n\n\n\n\n\n\n          float chargeMassRatio = particleData.chargeMassRatio;\n          float charge = particleData.charge;\n          float mass = particleData.mass;\n          momentum += 0.5 * halfDeltaTOverC * chargeMassRatio * E;\n          float gamma = sqrt(1.0 + dot(momentum, momentum));\n          vec3 t_ =  halfDeltaTOverC * charge  * c / (gamma * mass) * B ;\n          vec3 w_ = momentum + cross(momentum, t_);\n          vec3 s_ = 2.0 / (1.0 + dot(t_, t_)) * t_;\n          momentum += cross(w_, s_);\n          momentum +=  halfDeltaTOverC * chargeMassRatio * E;\n\n          }\n\n          if (boundingBoxSize > 0.) {\n            vec3 reflect = step(vec3(-boundingBoxSize), intermediatePosition) - step(vec3(boundingBoxSize), intermediatePosition);\n            momentum *= 2. * reflect * reflect - 1.;\n          }\n          return vec4( momentum, previous4Velocity.w );\n        }\n\n        void main () {\n          initLatticeData();\n          float particleIndex, bufferIndex, rgbaFloatChannel;\n\n          particleIndex = floor(gl_FragCoord.x);\n          bufferIndex = floor(gl_FragCoord.y/4.);\n          rgbaFloatChannel = fract(gl_FragCoord.y/4.)*4.;\n\n          float currentBufferHead = floor(mod(tick, bufferLength + 1.));\n          float previousBufferHead = (bufferIndex == 0.) ? bufferLength : bufferIndex - 1.;\n\n          if (currentBufferHead == bufferIndex) {\n            gl_FragColor = push_${i}(particleIndex, currentBufferHead, previousBufferHead);\n          } else {\n            gl_FragColor = get_${i}(particleIndex, bufferIndex);\n          }\n        }\n        `});var o},o=i("velocity"),r=i("position");return()=>{t.tick.value++;const e=t.tick.value*n.halfDeltaTOverC*2;t.pingPong=t.tick.value%2,t.referencePoint=n.lattice.beamline.length&&n.lattice.beamline[n.lattice.segmentIndexForZ(e)].start,o({pathiclesTick:t.tick.value}),r({pathiclesTick:t.tick.value})}}(this._regl,{variables:this.variables,model:this.model})),this.drawVariableTexture=function(e,{variables:t,texelSize:n=1,y0:i=0}){return e({vert:"\n      precision mediump float;\n      attribute vec2 position;\n      varying vec2 uv;\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform sampler2D texture;\n      varying vec2 uv;\n      void main () {\n        gl_FragColor = vec4(texture2D(texture, uv).xyz, texture2D(texture, uv).w + .5);\n      }",attributes:{position:[2,0,0,2,-2,-2]},uniforms:{texture:({tick:e},n)=>t[n.variableName][e%2]},viewport:{x:(e,i)=>"velocity"===i.variableName?(t.initialData.particleCount+1)*n:0,y:i,width:t.initialData.particleCount*n,height:t.initialData.bufferLength*n},depth:{enable:!1},count:3})}(e,{variables:this.variables,particleCount:this.model.particleCount,bufferLength:this.model.bufferLength,texelSize:t.view.texelSize,x0:100,y0:t.view.texelSize}),this.log=()=>{if(this.configuration.dumpData){const e=Aa(this._regl,{variables:this.variables,model:this.model});this._logStore.push({tick:this.variables.tick.value,data:e})}},this.dump=()=>({configuration:this.configuration,...Aa(this._regl,{variables:this.variables,model:this.model})})}push(e=1){Array(e).fill().map(()=>{this.push({})})}reset(){za(this.variables.position,this.initialData.fourPositions,this.RTTFloatType),za(this.variables.velocity,this.initialData.fourVelocities,this.RTTFloatType),this.variables.tick.value=0}prerender(){const e=this.model.bufferLength,t=Array(Math.floor(e/1)).fill(1);e%1>0&&t.push(e%1),t.forEach(e=>{this.push(e)})}}var Ia=new class{constructor(e=!0){if(window.performanceLogger)return window.performanceLogger;this.current=null,this.active=e,this.entries=[],window.performanceLogger=this}start(e){this.active&&(this.current={label:e,t0:performance.now()})}stop(){this.active&&(this.current.t1=performance.now(),this.current.dt=this.current.t1-this.current.t0,this.entries.push(this.current))}report(){return this.entries.map(({label:e,dt:t})=>`\n      ${e.padStart(25," ")}: ${t.toFixed(1)}`).join("\n")}};class Wa{constructor(e,{prerender:t=!1,stepCount:n=-1,stepsPerTick:i=1,loops:o=0,mode:r="stepwise",simulate:a=!1}){this.simulate=a,this._simulation=e,this._prerender=t,this._stepCount=n<0?this._simulation.constants.model.bufferLength-1:n,this._stepsPerTick=i,this._loopCountMax=o,this._isLooping=o>0,this._mode=r,this.fsm={state:"initial"}}toggleLooping(){this._loopCount=0,this._loopCountMax=10,this._isLooping=!this._isLooping}toggleMode(){this._mode="stepwise"===this._mode?"framewise":"stepwise"}toggleActivity(){"active"===this.fsm.state?this.fsm={state:"paused"}:"paused"===this.fsm.state&&(this.fsm={state:"active"},this._isLooping&&(this._loopCount=1))}start(){if("initial"!==this.fsm.state)throw console.error("PathiclesRunner.start can be called in state initial only"),new Error("PathiclesRunner.start can be called in state initial only");this._runCount=1,this._loopCount=1,this._prerender?(Ia.start("prerender"),this.simulate&&(this._simulation.prerender(),Ia.stop()),this._simulation.variables.tick.value=this._stepCount,this._simulation.push({}),this.fsm={state:"paused"}):this.fsm={state:"restart"}}next(){if("active"===this.fsm.state)if(this._simulation.variables.tick.value>this._stepCount-1)this._isLooping&&this._loopCount<=this._loopCountMax?this.fsm.state="restart":this.fsm.state="paused";else{for(let e=0;e<this._stepsPerTick&&(this._simulation.push({}),!(this._simulation.variables.tick.value>this._stepCount));e++);"stepwise"===this._mode&&(this.fsm.state="paused")}else"restart"===this.fsm.state&&(this._loopCount++,this._runCount++,this._simulation.reset({}),this._simulation.push({}),this.fsm.state=this.fsm.state.replace(/restart/,"active"))}}var Va=function(e,t){var n=t[0],i=t[1],o=t[2],r=n*n+i*i+o*o;r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r);return e};var Ba=function(e,t,n){var i=t[0],o=t[1],r=t[2],a=n[0],s=n[1],l=n[2];return e[0]=o*l-r*s,e[1]=r*a-i*l,e[2]=i*s-o*a,e};var Ga=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Ya=function(e,t,n,i){var o,r,a,s,l,c,u,h,f,d,p=t[0],m=t[1],v=t[2],g=i[0],y=i[1],b=i[2],w=n[0],x=n[1],_=n[2];if(Math.abs(p-w)<1e-6&&Math.abs(m-x)<1e-6&&Math.abs(v-_)<1e-6)return Ga(e);u=p-w,h=m-x,f=v-_,d=1/Math.sqrt(u*u+h*h+f*f),o=y*(f*=d)-b*(h*=d),r=b*(u*=d)-g*f,a=g*h-y*u,(d=Math.sqrt(o*o+r*r+a*a))?(o*=d=1/d,r*=d,a*=d):(o=0,r=0,a=0);s=h*a-f*r,l=f*o-u*a,c=u*r-h*o,(d=Math.sqrt(s*s+l*l+c*c))?(s*=d=1/d,l*=d,c*=d):(s=0,l=0,c=0);return e[0]=o,e[1]=s,e[2]=u,e[3]=0,e[4]=r,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(o*p+r*m+a*v),e[13]=-(s*p+l*m+c*v),e[14]=-(u*p+h*m+f*v),e[15]=1,e};var ja=function(e,t,n,i,o,r){void 0===e&&(e=1),void 0===t&&(t=e),void 0===n&&(n=e),void 0===i&&(i=1),void 0===o&&(o=i),void 0===r&&(r=i);var a=0,s=[],l=[],c=[],u=[];function h(e,t,n,i,o,r,h,f,d,p){for(var m=a,v=0;v<=h;v++)for(var g=0;g<=r;g++){var y=s[a]=[0,0,0];y[e]=(-i/2+g*i/r)*d,y[t]=(-o/2+v*o/h)*p,y[n]=f;var b=l[a]=[0,0,0];b[e]=0,b[t]=0,b[n]=f/Math.abs(f);var w=c[a]=[0,0];w[0]=g/r,w[1]=1-v/h,++a}for(v=0;v<h;v++)for(g=0;g<r;g++){var x=m+v*(r+1)+g;u.push([x,x+r+1,x+r+2]),u.push([x,x+r+2,x+1])}}return h(0,1,2,e,t,i,o,n/2,1,-1),h(0,1,2,e,t,i,o,-n/2,-1,-1),h(2,1,0,n,t,r,o,-e/2,1,-1),h(2,1,0,n,t,r,o,e/2,-1,-1),h(0,2,1,e,n,i,r,t/2,1,1),h(0,2,1,e,n,i,r,-t/2,1,-1),{positions:s,normals:l,uvs:c,cells:u}},Xa="precision highp float;\n#define GLSLIFY 1\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nmat4 lookAt(vec3 eye, vec3 at, vec3 up) {\n  vec3 zaxis = normalize(eye - at);\n  vec3 xaxis = normalize(cross(zaxis, up));\n  vec3 yaxis = cross(xaxis, zaxis);\n  zaxis *= -1.;\n  return mat4(\n  vec4(xaxis.x, xaxis.y, xaxis.z, -dot(xaxis, eye)),\n  vec4(yaxis.x, yaxis.y, yaxis.z, -dot(yaxis, eye)),\n  vec4(zaxis.x, zaxis.y, zaxis.z, -dot(zaxis, eye)),\n  vec4(0, 0, 0, 1)\n  );\n}\n\nattribute vec3 aPosition;\n\nattribute vec3 aNormal;\nattribute vec2 aUV;\n\nattribute float aParticle;\nattribute float aColorCorrection;\nattribute float aStep;\n\nuniform float particleCount;\nuniform float bufferLength;\nuniform float stepCount;\n\nuniform float dt;\nuniform vec2 viewRange;\n\nuniform float pathicleWidth;\nuniform float pathicleGap;\nuniform float pathicleHeight;\nuniform float stageGrid_y;\nuniform float stageGrid_size;\nuniform vec4 shadowColor;\nuniform vec4 uLight;\n\nuniform sampler2D utParticleColorAndType;\nuniform sampler2D utPositionBuffer;\nuniform sampler2D utVelocityBuffer;\nuniform mat4 projection, view, model;\nuniform vec3 eye;\n\nuniform mat4 shadowViewMatrix_top;\nuniform mat4 shadowViewMatrix;\nuniform mat4 shadowProjectionMatrix;\nvarying vec4 vLightNDC;\n// Matrix to shift range from -1->1 to 0->1\nconst mat4 depthScaleMatrix = mat4(\n0.5, 0, 0, 0,\n0, 0.5, 0, 0,\n0, 0, 0.5, 0,\n0.5, 0.5, 0.5, 1\n);\n\nvarying float toBeDiscarded;\nvarying float boxLength;\nvarying vec3 vScale;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec3 vNormalOrig;\nvarying vec2 vUv;\nvarying vec4 vAmbientColor;\nvarying vec4 vDiffuseColor;\n\nvarying float vColorCorrection;\n\nvec3 hemisphere_light(\n  vec3 normal,\n  vec3 sky,\n  vec3 ground,\n  vec3 lightDirection,\n  mat4 modelMatrix,\n  mat4 viewMatrix,\n  vec3 viewPosition,\n  float shininess,\n  float specularity\n) {\n  vec3 direction = normalize((\n  modelMatrix * vec4(lightDirection, 1.0)\n  ).xyz);\n\n  float weight = 0.5 * dot(\n  normal\n  , direction\n  ) + 0.5;\n\n  vec3 diffuse = mix(ground, sky, weight);\n\n  vec3 specDirection = normalize((\n  viewMatrix * modelMatrix * vec4(lightDirection, 1.0)\n  ).xyz);\n\n  float skyWeight = 0.5 * dot(\n  normal\n  , normalize(specDirection + viewPosition)\n  ) + 0.5;\n\n  float gndWeight = 0.5 * dot(\n  normal\n  , normalize(viewPosition - specDirection)\n  ) + 0.5;\n\n  vec3 specular = specularity * diffuse * (\n  max(pow(skyWeight, shininess), 0.0) +\n  max(pow(gndWeight, shininess), 0.0)\n  ) * weight;\n\n  return diffuse + specular;\n}\n\nvec4 get_color(float p) {\n  vec2 coords = vec2(p, 0.) / vec2(particleCount, 1.);\n  return texture2D(utParticleColorAndType, coords);\n}\nvec4 get_position(float p, float b) {\n  vec2 coords = vec2(p, b) / vec2(particleCount, bufferLength);\n  return texture2D(utPositionBuffer, coords);\n}\nfloat calculateToBeDiscarded(vec4 previousFourPosition, vec4 currentFourPosition) {\n\n  float undefinedBuffer = (currentFourPosition.w == 0. || previousFourPosition.w > currentFourPosition.w) ? 1.0 : 0.0;\n  float beyondProgressLower = (currentFourPosition.w / dt < viewRange[0] * stepCount) ? 1.0 : 0.0;\n  float beyondProgressUpper =  (currentFourPosition.w / dt > viewRange[1] * stepCount) ? 1.0 : 0.0;\n  float outsideGrid = (currentFourPosition.x > stageGrid_size || currentFourPosition.x < -stageGrid_size\n  || currentFourPosition.y > stageGrid_size || currentFourPosition.y < -stageGrid_size\n  || currentFourPosition.z > stageGrid_size || currentFourPosition.z < -stageGrid_size) ? 1.0 : 0.0;\n\n  return (outsideGrid > 0. || undefinedBuffer > 0. || beyondProgressLower > 0. || beyondProgressUpper > 0.) ? 1.0 : 0.0;\n\n}\n\nvoid main () {\n\n  float previousBufferHead = (aStep < 1.) ? bufferLength : aStep - 1.;\n  vec4 previousFourPosition = get_position(aParticle, previousBufferHead);\n  vec4 currentFourPosition = get_position(aParticle, aStep);\n\n  mat4 lookAtMat4 = lookAt(currentFourPosition.xyz, previousFourPosition.xyz, vec3(0., 1, 0.));\n\n  float scale = 1.;\n  float shadowProjectionScale = 1.;\n  #ifdef shadow\n  scale = 1.;\n  shadowProjectionScale = .1;\n  #endif\n\n  vScale = vec3(pathicleWidth, pathicleHeight, length(previousFourPosition.xyz - currentFourPosition.xyz) - pathicleGap);\n\n  boxLength = vScale.z;\n\n  vec3 scaledPosition = vec3(\n     aPosition.x,\n    aPosition.y * shadowProjectionScale,\n     aPosition.z ) * vScale;\n\n  vPosition = vec3(1., 1., 1.) * (((lookAtMat4 * vec4(scaledPosition, 1.)).xyz\n  + 0.5 * (currentFourPosition.xyz + previousFourPosition.xyz)));\n\n  vNormalOrig = aNormal;\n  vNormal = normalize((transpose(inverse(lookAtMat4)) * vec4(aNormal, 0.)).xyz);\n\n  vUv = aUV;\n\n#ifdef lighting\n\n  vDiffuseColor = get_color(aParticle);\n  vAmbientColor = get_color(aParticle);\n  //  float maxDistance = 4.;\n  //  vColorCorrection += aColorCorrection + vNormalOrig.z * vNormalOrig.z * .5;\n  vColorCorrection =  aStep/bufferLength * .5;\n  vColorCorrection =  sin(aParticle)*.1;\n  vLightNDC = depthScaleMatrix * shadowProjectionMatrix * shadowViewMatrix_top * model * vec4(vPosition, 1.0);\n#endif\n\n#ifdef shadow\n    vPosition.y = stageGrid_y + 0.01 * abs(sin(aStep));\n    vDiffuseColor = shadowColor;\n//    if (aPosition.y < 0.) toBeDiscarded = 1.;\n#endif\n\n  toBeDiscarded = calculateToBeDiscarded(previousFourPosition, currentFourPosition);\n\n#ifdef shadowMap\n  gl_Position = shadowProjectionMatrix * shadowViewMatrix * model * vec4(vPosition, 1.0);\n#endif\n\n#ifdef lighting\n  gl_Position = projection * view * model * vec4(vPosition, 1.0);\n#endif\n\n}\n\n",Ha="#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n#define GLSLIFY 1\n\nvarying float toBeDiscarded;\nvarying vec3 vPosition;\nvarying vec3 vScale;\nvarying vec3 vNormal;\nvarying vec3 vNormalOrig;\nvarying vec2 vUv;\nvarying vec4 vAmbientColor;\nvarying vec4 vDiffuseColor;\nvarying float vColorCorrection;\n\nuniform vec3 lightPosition;\nuniform float ambientIntensity;\nuniform float stageGrid_size;\nuniform float pathicleWidth;\nuniform vec3 eye;\nuniform vec2 uResolution;\n\n#ifdef lighting\nvarying vec4 vLightNDC;\nuniform samplerCube cubeShadow;\nuniform sampler2D shadowMap;\n#endif\n\nfloat edger(vec2 uv, vec3 boxScale, float edgeWidth) {\n\n  float edgeXY =  smoothstep(0., edgeWidth, uv.x*boxScale.z) * smoothstep(0., edgeWidth, (1.-uv.x)*boxScale.z);\n  float edgeXZ =  smoothstep(0., edgeWidth, uv.y*boxScale.y) * smoothstep(0., edgeWidth, (1.-uv.y)*boxScale.y);\n  float edgeX = (1.-(edgeXY*edgeXZ))*abs(vNormalOrig.x);\n\n  float edgeYX =  smoothstep(0., edgeWidth, uv.x*boxScale.x) * smoothstep(0., edgeWidth, (1.-uv.x)*boxScale.x);\n  float edgeYZ =  smoothstep(0., edgeWidth, uv.y*boxScale.z) * smoothstep(0., edgeWidth, (1.-uv.y)*boxScale.z);\n  float edgeY = (1.-(edgeYX*edgeYZ))*abs(vNormalOrig.y);\n\n  float edgeZX =  smoothstep(0., edgeWidth, uv.x*boxScale.x) * smoothstep(0., edgeWidth, (1.-uv.x)*boxScale.x);\n  float edgeZY =  smoothstep(0., edgeWidth, uv.y*boxScale.z) * smoothstep(0., edgeWidth, (1.-uv.y)*boxScale.z);\n  float edgeZ = (1.-(edgeZX*edgeZY))*abs(vNormalOrig.z);\n\n  return clamp(edgeX, 0., 1.);\n}\n\nfloat edgerFeathered(vec2 uv, vec3 boxScale, float edgeWidth) {\n\n  float feather = .1;\n\n  float edgeXY =  smoothstep(edgeWidth, edgeWidth+feather, uv.x*boxScale.z) * smoothstep(edgeWidth, edgeWidth+feather, (1.-uv.x)*boxScale.z);\n  float edgeXZ =  smoothstep(edgeWidth, edgeWidth+feather, uv.y*boxScale.y) * smoothstep(edgeWidth, edgeWidth+feather, (1.-uv.y)*boxScale.y);\n  float edgeX = (1.-(edgeXY*edgeXZ))*abs(vNormalOrig.x);\n\n  //  float edgeYX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n  //  float edgeYZ =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n  //  float edgeY = (1.-(edgeYX*edgeYZ))*abs(vNormalOrig.y);\n  //\n  //  float edgeZX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n  //  float edgeZY =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n  //  float edgeZ = (1.-(edgeZX*edgeZY))*abs(vNormalOrig.z);\n\n  return clamp(edgeX, 0., 1.);\n}\n\nfloat edgerHard(vec2 uv, vec3 boxScale, float edgeWidth) {\n  float edgeXY =  step(edgeWidth*(1.+uv.x*boxScale.z), uv.x*boxScale.z) * step(edgeWidth, (1.-uv.x)*boxScale.z);\n  float edgeXZ =  step(edgeWidth*(0.5+uv.x/2.), uv.y*boxScale.y) * step(edgeWidth*(0.5+uv.x/2.), (1.-uv.y)*boxScale.y);\n  float edgeX = (1.-(edgeXZ))*abs(vNormalOrig.x);\n\n//  float edgeYX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n//  float edgeYZ =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n//  float edgeY = (1.-(edgeYX*edgeYZ))*abs(vNormalOrig.y);\n//\n//  float edgeZX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n//  float edgeZY =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n//  float edgeZ = (1.-(edgeZX*edgeZY))*abs(vNormalOrig.z);\n\n  return clamp(edgeX, 0., 1.);\n}\n\nfloat fogFactorExp2(\n  const float dist,\n  const float density\n) {\n  const float LOG2 = -1.442695;\n  float d = density * dist;\n  return 1.0 - clamp(exp2(d * d * LOG2), 0.0, 1.0);\n}\n\nconst vec4 fogColor = vec4(1.0);\n\nvec4 packRGBA (float v) {\n  vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n  pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n  return pack;\n}\nfloat unpackRGBA (vec4 v) {\n  return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\n}\n\nvoid main () {\n\n  if (toBeDiscarded > .0) discard;\n\n  //if (length(vPosition.z) > stageGrid_size/2. - .5) discard;\n  //  vec3 hemisphereColor = hemisphere_light(vNormal, vec3(2., 2., 2.), vec3(.5,.5,.5), vec3(0.,1.,0.));\n\n  //  vec3 materialColor = (1. + vColorCorrection) * vDiffuseColor;\n  //  vec3 ambientColor = (ambientIntensity * vec3(1., 1., 1.) * materialColor).rgb;\n  //  vec3 lightingColor = 3. * ambientColor;\n  #ifdef shadow\n  gl_FragColor = vec4(vDiffuseColor.rgb, .2/vPosition.z/vPosition.z);//vec4(lightingColor,\n  #endif\n\n  #ifdef cubeShadow\n  gl_FragColor = packRGBA(gl_FragCoord.z);\n  #endif\n\n  #ifdef shadowMap\n  gl_FragColor = packRGBA(gl_FragCoord.z) + vec4(0.1);\n  #endif\n\n  #ifdef wireframe\n  float opacity = 1. - grid(b, .5);\n  gl_FragColor = vec4(1., 1., 1., .5*opacity);\n  #endif\n\n  #ifdef lighting\n\n  float ambientLightAmount = .75;\n  float diffuseLightAmount = .5;\n\n  // set the specular term to black\n  vec4 spec = vec4(0.0);\n\n  // normalize both input vectors\n  vec3 n = normalize(vNormal);\n  vec3 e = normalize(eye);\n  vec3 lightDirection = normalize(lightPosition);\n\n  vec4 specular = vec4(1.);\n  float shininess = .5;\n\n  float intensity = max(dot(n, lightDirection), 1.0);\n  if (intensity > 0.0) {\n    // compute the half vector\n    vec3 h = normalize(lightDirection + e);\n    // compute the specular term into spec\n    float intSpec = max(dot(h, n), 0.0);\n    spec = specular * pow(intSpec, shininess);\n  }\n\n  vec4 color;\n\n  //  color = (1. - vColorCorrection)  * max(intensity * vDiffuseColor + 0.*spec, vAmbientColor);\n\n  color  = (1. - 1. * vColorCorrection) * (1.*vDiffuseColor + 0.*vAmbientColor);\n\n  //  color = .5 * (1. - vColorCorrection) * vDiffuseColor + vAmbientColor;\n  //  vec3 ambient = ambientLightAmount * vDiffuseColor;\n  //  vec3 diffuse = diffuseLightAmount * vDiffuseColor * clamp(dot(vNormal, normalize(vec3(10., 10., 10.))) , 0.0, 1.0 ) +\n  //                  diffuseLightAmount * vDiffuseColor * clamp(dot(vNormal, normalize(vec3(-10., 10., -10.))) , 0.0, 1.0 ) ;\n  //\n  /*  float cosTheta2 = clamp(1. - 1. * cos(length(vPosition*20.)) , .9, 1.1 );\n    vec3 diffuse2 = 0.02 * vec3(1.) * clamp(cosTheta2 , 0.0, 1.0 ) ;\n    vec4 combinedDiffuse = clamp(vDiffuseColor * cosTheta2 , vec4(0.), vec4(1.));*/\n  //\n  //\n  ////  gl_FragColor =  vec4(pow( (1. - vColorCorrection) * (combinedDiffuse +  ambient), vec3(1.0/gamma)), 1.); //vec4(lightingColor, opacity);\n\n  //color = (1. - 1.* vColorCorrection) * ( vDiffuseColor);\n\n  vec3 lightPos = vLightNDC.xyz / vLightNDC.w;\n\n  float bias = 0.001;\n  float depth = lightPos.z - bias;\n  float occluder = unpackRGBA(texture2D(shadowMap, lightPos.xy));\n\n  // Compare actual depth from light to the occluded depth rendered in the depth map\n  // If the occluded depth is smaller, we must be in shadow\n  float shadow = mix(0.2, 1.0, step(depth, occluder));\n\n  //\n  //  vec3 texCoord = (vPosition - lightPosition);\n  //  float visibility = 0.0;\n  //   //do soft shadows:\n  //  for (int x = 0; x < 2; x++) {\n  //    for (int y = 0; y < 2; y++) {\n  //      for (int z = 0; z < 2; z++) {\n  //        float bias = 0.3;\n  ////        vec4 env = textureCube(cubeShadow, texCoord + vec3(x,y,z) * vec3(0.1));\n  //        vec3 lightPos = vLightNDC.xyz / vLightNDC.w;\n  //        float depth = lightPos.z - bias;\n  //\n  //        float occluder = unpackRGBA(texture2D(shadowMap,texCoord));\n  //\n  //        float shadow = mix(0.2, 1.0, step(depth, occluder));\n  //        visibility += shadow; //(env.x+bias) < (distance(vPosition, lightPos)) ? 0.0 : 1.0;\n  //      }\n  //    }\n  //  }\n  //  visibility *= 1.0 / 8.0;\n  //\n  //  visibility = 1.0;\n\n  shadow = 1.;\n\n  vec4 shadowedColor = shadow * color;\n  shadowedColor +=  smoothstep(10.,1.,length(vPosition-eye))  * color * vec4(edger(vUv, vScale, pathicleWidth*2.) * vec3(.7), 1.);\n\n  gl_FragColor =vec4(shadowedColor.rgb, 1.);\n\n//  const float FOG_DENSITY = .9;\n//  const vec4 FOG_COLOR = vec4(1.0, 1.0, 1.0, .8);\n//  float fogDistance = length(vPosition);\n//  float fogAmount = fogDistance > 9. ? fog_exp2(fogDistance - 9., FOG_DENSITY) : 0.;\n//\n//  vec4 faggedColor = mix(shadowedColor, FOG_COLOR, fogAmount);\n//\n//  gl_FragColor = vec4(faggedColor.rgb, 1.-fogAmount);\n\n  #endif// lighting\n\n}\n\n",Ua=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e};var qa={create:function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},identity:Ga,transpose:function(e,t){if(e===t){var n=t[1],i=t[2],o=t[3],r=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=r,e[11]=t[14],e[12]=o,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],y=n*s-i*a,b=n*l-o*a,w=n*c-r*a,x=i*l-o*s,_=i*c-r*s,C=o*c-r*l,M=u*m-h*p,P=u*v-f*p,S=u*g-d*p,E=h*v-f*m,T=h*g-d*m,A=f*g-d*v,O=y*A-b*T+w*E+x*S-_*P+C*M;if(!O)return null;return O=1/O,e[0]=(s*A-l*T+c*E)*O,e[1]=(o*T-i*A-r*E)*O,e[2]=(m*C-v*_+g*x)*O,e[3]=(f*_-h*C-d*x)*O,e[4]=(l*S-a*A-c*P)*O,e[5]=(n*A-o*S+r*P)*O,e[6]=(v*w-p*C-g*b)*O,e[7]=(u*C-f*w+d*b)*O,e[8]=(a*T-s*S+c*M)*O,e[9]=(i*S-n*T-r*M)*O,e[10]=(p*_-m*w+g*y)*O,e[11]=(h*w-u*_-d*y)*O,e[12]=(s*P-a*E-l*M)*O,e[13]=(n*E-i*P+o*M)*O,e[14]=(m*b-p*x-v*y)*O,e[15]=(u*x-h*b+f*y)*O,e},adjoint:function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15];return e[0]=s*(f*g-d*v)-h*(l*g-c*v)+m*(l*d-c*f),e[1]=-(i*(f*g-d*v)-h*(o*g-r*v)+m*(o*d-r*f)),e[2]=i*(l*g-c*v)-s*(o*g-r*v)+m*(o*c-r*l),e[3]=-(i*(l*d-c*f)-s*(o*d-r*f)+h*(o*c-r*l)),e[4]=-(a*(f*g-d*v)-u*(l*g-c*v)+p*(l*d-c*f)),e[5]=n*(f*g-d*v)-u*(o*g-r*v)+p*(o*d-r*f),e[6]=-(n*(l*g-c*v)-a*(o*g-r*v)+p*(o*c-r*l)),e[7]=n*(l*d-c*f)-a*(o*d-r*f)+u*(o*c-r*l),e[8]=a*(h*g-d*m)-u*(s*g-c*m)+p*(s*d-c*h),e[9]=-(n*(h*g-d*m)-u*(i*g-r*m)+p*(i*d-r*h)),e[10]=n*(s*g-c*m)-a*(i*g-r*m)+p*(i*c-r*s),e[11]=-(n*(s*d-c*h)-a*(i*d-r*h)+u*(i*c-r*s)),e[12]=-(a*(h*v-f*m)-u*(s*v-l*m)+p*(s*f-l*h)),e[13]=n*(h*v-f*m)-u*(i*v-o*m)+p*(i*f-o*h),e[14]=-(n*(s*v-l*m)-a*(i*v-o*m)+p*(i*l-o*s)),e[15]=n*(s*f-l*h)-a*(i*f-o*h)+u*(i*l-o*s),e},determinant:function(e){var t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],v=e[15];return(t*a-n*r)*(h*v-f*m)-(t*s-i*r)*(u*v-f*p)+(t*l-o*r)*(u*m-h*p)+(n*s-i*a)*(c*v-f*d)-(n*l-o*a)*(c*m-h*d)+(i*l-o*s)*(c*p-u*d)},multiply:function(e,t,n){var i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],v=t[13],g=t[14],y=t[15],b=n[0],w=n[1],x=n[2],_=n[3];return e[0]=b*i+w*s+x*h+_*m,e[1]=b*o+w*l+x*f+_*v,e[2]=b*r+w*c+x*d+_*g,e[3]=b*a+w*u+x*p+_*y,b=n[4],w=n[5],x=n[6],_=n[7],e[4]=b*i+w*s+x*h+_*m,e[5]=b*o+w*l+x*f+_*v,e[6]=b*r+w*c+x*d+_*g,e[7]=b*a+w*u+x*p+_*y,b=n[8],w=n[9],x=n[10],_=n[11],e[8]=b*i+w*s+x*h+_*m,e[9]=b*o+w*l+x*f+_*v,e[10]=b*r+w*c+x*d+_*g,e[11]=b*a+w*u+x*p+_*y,b=n[12],w=n[13],x=n[14],_=n[15],e[12]=b*i+w*s+x*h+_*m,e[13]=b*o+w*l+x*f+_*v,e[14]=b*r+w*c+x*d+_*g,e[15]=b*a+w*u+x*p+_*y,e},translate:function(e,t,n){var i,o,r,a,s,l,c,u,h,f,d,p,m=n[0],v=n[1],g=n[2];t===e?(e[12]=t[0]*m+t[4]*v+t[8]*g+t[12],e[13]=t[1]*m+t[5]*v+t[9]*g+t[13],e[14]=t[2]*m+t[6]*v+t[10]*g+t[14],e[15]=t[3]*m+t[7]*v+t[11]*g+t[15]):(i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=i,e[1]=o,e[2]=r,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=i*m+s*v+h*g+t[12],e[13]=o*m+l*v+f*g+t[13],e[14]=r*m+c*v+d*g+t[14],e[15]=a*m+u*v+p*g+t[15]);return e},scale:function(e,t,n){var i=n[0],o=n[1],r=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,n,i){var o,r,a,s,l,c,u,h,f,d,p,m,v,g,y,b,w,x,_,C,M,P,S,E,T=i[0],A=i[1],O=i[2],z=Math.sqrt(T*T+A*A+O*O);if(Math.abs(z)<1e-6)return null;T*=z=1/z,A*=z,O*=z,o=Math.sin(n),r=Math.cos(n),a=1-r,s=t[0],l=t[1],c=t[2],u=t[3],h=t[4],f=t[5],d=t[6],p=t[7],m=t[8],v=t[9],g=t[10],y=t[11],b=T*T*a+r,w=A*T*a+O*o,x=O*T*a-A*o,_=T*A*a-O*o,C=A*A*a+r,M=O*A*a+T*o,P=T*O*a+A*o,S=A*O*a-T*o,E=O*O*a+r,e[0]=s*b+h*w+m*x,e[1]=l*b+f*w+v*x,e[2]=c*b+d*w+g*x,e[3]=u*b+p*w+y*x,e[4]=s*_+h*C+m*M,e[5]=l*_+f*C+v*M,e[6]=c*_+d*C+g*M,e[7]=u*_+p*C+y*M,e[8]=s*P+h*S+m*E,e[9]=l*P+f*S+v*E,e[10]=c*P+d*S+g*E,e[11]=u*P+p*S+y*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e},rotateX:function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=r*o+c*i,e[5]=a*o+u*i,e[6]=s*o+h*i,e[7]=l*o+f*i,e[8]=c*o-r*i,e[9]=u*o-a*i,e[10]=h*o-s*i,e[11]=f*o-l*i,e},rotateY:function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],f=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=r*o-c*i,e[1]=a*o-u*i,e[2]=s*o-h*i,e[3]=l*o-f*i,e[8]=r*i+c*o,e[9]=a*i+u*o,e[10]=s*i+h*o,e[11]=l*i+f*o,e},rotateZ:function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=r*o+c*i,e[1]=a*o+u*i,e[2]=s*o+h*i,e[3]=l*o+f*i,e[4]=c*o-r*i,e[5]=u*o-a*i,e[6]=h*o-s*i,e[7]=f*o-l*i,e},fromRotation:function(e,t,n){var i,o,r,a=n[0],s=n[1],l=n[2],c=Math.sqrt(a*a+s*s+l*l);if(Math.abs(c)<1e-6)return null;return a*=c=1/c,s*=c,l*=c,i=Math.sin(t),o=Math.cos(t),r=1-o,e[0]=a*a*r+o,e[1]=s*a*r+l*i,e[2]=l*a*r-s*i,e[3]=0,e[4]=a*s*r-l*i,e[5]=s*s*r+o,e[6]=l*s*r+a*i,e[7]=0,e[8]=a*l*r+s*i,e[9]=s*l*r-a*i,e[10]=l*l*r+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:function(e,t,n){var i=t[0],o=t[1],r=t[2],a=t[3],s=i+i,l=o+o,c=r+r,u=i*s,h=i*l,f=i*c,d=o*l,p=o*c,m=r*c,v=a*s,g=a*l,y=a*c;return e[0]=1-(d+m),e[1]=h+y,e[2]=f-g,e[3]=0,e[4]=h-y,e[5]=1-(u+m),e[6]=p+v,e[7]=0,e[8]=f+g,e[9]=p-v,e[10]=1-(u+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromTranslation:Ua,fromXRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromQuat:function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=n+n,s=i+i,l=o+o,c=n*a,u=i*a,h=i*s,f=o*a,d=o*s,p=o*l,m=r*a,v=r*s,g=r*l;return e[0]=1-h-p,e[1]=u+g,e[2]=f-v,e[3]=0,e[4]=u-g,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=f+v,e[9]=d-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,i,o,r,a){var s=1/(n-t),l=1/(o-i),c=1/(r-a);return e[0]=2*r*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*r*l,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(o+i)*l,e[10]=(a+r)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*r*2*c,e[15]=0,e},perspective:function(e,t,n,i,o){var r=1/Math.tan(t/2),a=1/(i-o);return e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*i*a,e[15]=0,e},perspectiveFromFieldOfView:function(e,t,n,i){var o=Math.tan(t.upDegrees*Math.PI/180),r=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(o+r);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(o-r)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},ortho:function(e,t,n,i,o,r,a){var s=1/(t-n),l=1/(i-o),c=1/(r-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(o+i)*l,e[14]=(a+r)*c,e[15]=1,e},lookAt:Ya,str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}},Za=qa.identity,$a=qa.multiply,Ja=qa.rotate,Qa=qa.fromQuat,Ka=qa.perspective,es=qa.lookAt;function ts(e,{variables:t,model:n,view:i},o,r){const a=ja();Math.clip=function(e,t,n){return Math.max(t,Math.min(e,n))};let s=Za([]);const l=l=>e({depth:!0,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"src alpha",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},color:[1,1,1,1]},cull:{enable:!1,face:"front"},elements:a.cells,instances:()=>n.particleCount*Math.min(t.tick.value,n.bufferLength),attributes:{aPosition:a.positions,aNormal:a.normals,aUV:a.uvs,aParticle:{buffer:e.buffer(Array(n.particleCount*n.bufferLength).fill(0).map((e,t)=>t%n.particleCount)),divisor:1},aColorCorrection:{buffer:e.buffer(Array(n.particleCount*n.bufferLength).fill(0).map((e,t)=>{const i=Math.sqrt(n.particleCount),o=t%n.particleCount,r=Math.floor(o/i)-i/2,a=((o%Math.sqrt(n.particleCount)-i/2)**2+r**2)/i**2;return s=1.25*Math.pow(Math.cos(2*a),2),l=.25,c=.5,Math.min(Math.max(s,l),c);var s,l,c})),divisor:1},aStep:{buffer:e.buffer(Array(n.particleCount*n.bufferLength).fill(0).map((e,t)=>Math.floor(t/n.particleCount))),divisor:1}},vert:[`#define ${l} 1`,Xa].join("\n"),frag:[`#define ${l} 1`,Ha].join("\n"),..."cubeShadow"===l&&{framebuffer:function(e,t,n){return r.fbo.faces[n]}},..."shadowMap"===l&&{framebuffer:o.fbo},uniforms:{..."shadowMap"===l&&{shadowViewMatrix:o.shadowViewMatrix,shadowProjectionMatrix:o.shadowProjectionMatrix},..."cubeShadow"===l&&{shadowViewMatrix:function(e,t,n){switch(n){case 0:return r.shadowViewMatrix_x;case 1:return r.shadowViewMatrix_x_;case 2:return r.shadowViewMatrix_y;case 3:return r.shadowViewMatrix_y_;case 4:return r.shadowViewMatrix_z;case 5:return r.shadowViewMatrix_z_}}},..."lighting"===l&&{cubeShadow:r.fbo},uResolution:[1,1],uLight:[1,1,0,1],ambientIntensity:i.ambientIntensity,utParticleColorAndType:()=>t.particleColorsAndTypes,utPositionBuffer:()=>t.position[0],viewRange:(e,t)=>t.viewRange||[0,1],lightPosition:i.lightPosition,shadowMap:o.fbo,shadowProjectionMatrix:r.shadowProjectionMatrix,shadowViewMatrix_top:r.shadowViewMatrix_y_,stageGrid_y:i.stageGrid.y,shadowColor:i.shadowColor,stageGrid_size:i.stageGrid.size/2,pathicleHeight:i.pathicleWidth*i.pathicleRelativeHeight,pathicleWidth:i.pathicleWidth,model:(e,t)=>Ua(s,[t.modelTranslateX||0,t.modelTranslateY||0,0])}});return{lighting:l("lighting"),shadow:l("shadow"),shadowMap:l("shadowMap"),cubeShadow:l("cubeShadow")}}class ns{constructor(e,t){this.regl=e,this.fbo=e.framebufferCube({radius:1024,colorFormat:"rgba",colorType:"uint8"}),this.lightPosition=t,this.shadowViewMatrix_x=es([],t,[t[0]+1,t[1],t[2]],[0,-1,0]),this.shadowViewMatrix_x_=es([],t,[t[0]-1,t[1],t[2]],[0,-1,0]),this.shadowViewMatrix_y=es([],t,[t[0],t[1]+1,t[2]],[0,0,1]),this.shadowViewMatrix_y_=es([],t,[t[0],t[1]-1,t[2]],[0,0,-1]),this.shadowViewMatrix_z=es([],t,[t[0],t[1],t[2]+1],[0,-1,0]),this.shadowViewMatrix_z_=es([],t,[t[0],t[1],t[2]-1],[0,-1,0]),this.shadowProjectionMatrix=Ka([],Math.PI/2,1,.25,70)}drawFbo(){return this.regl({vert:"\n      precision mediump float;\n      attribute vec2 position;\n      varying vec2 uv;\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform samplerCube texture;\n      varying vec2 uv;\n      float unpackRGBA (vec4 v) {\n        return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\n      }\n      void main () {\n        vec3 texCoord = vec3(uv.xy, 0.);\n        vec4 texel = vec4(unpackRGBA(textureCube(texture, texCoord)));\n        gl_FragColor = texel;\n      }",attributes:{position:[2,0,0,2,-2,-2]},uniforms:{texture:this.fbo},viewport:{x:(e,t,n)=>{},y:0,width:1024,height:1024},depth:{enable:!1},count:3})()}}class is{constructor(e,t){this.regl=e,this.fbo=e.framebuffer({radius:1024,colorFormat:"rgba",colorType:"uint8"}),this.lightPosition=t,this.shadowViewMatrix=es([],t,[t[0]-1,t[1],t[2]],[0,-1,0]),this.shadowProjectionMatrix=Ka([],Math.PI/2,1,.25,70)}drawFbo(){return this.regl({vert:"\n      precision mediump float;\n      attribute vec2 position;\n      varying vec2 uv;\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform sampler2D texture;\n      varying vec2 uv;\n      float unpackRGBA (vec4 v) {\n        return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\n      }\n      void main () {\n\n        // vec4 texel = vec4(unpackRGBA(texture2D(texture, uv)));\n        vec4 texel = texture2D(texture, uv);\n        gl_FragColor = texel; //vec4(uv,uv);\n      }",attributes:{position:[2,0,0,2,-2,-2]},uniforms:{texture:this.fbo},viewport:{x:0,y:0,width:1024,height:1024},depth:{enable:!0},count:3})()}}var os=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},rs=function(e,t){var n=t[0],i=t[1],o=t[2];return e[0]=n,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-o*o)),e};var as=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ss=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e};var ls=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},cs=function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var us=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},hs=function(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var r=(o+1)%3,a=(o+2)%3;n=Math.sqrt(t[3*o+o]-t[3*r+r]-t[3*a+a]+1),e[o]=.5*n,n=.5/n,e[3]=(t[3*r+a]-t[3*a+r])*n,e[r]=(t[3*r+o]+t[3*o+r])*n,e[a]=(t[3*a+o]+t[3*o+a])*n}return e};var fs=function(e,t,n,i){var o=new Float32Array(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},ds=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var ps=function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=n*n+i*i+o*o+r*r,s=a?1/a:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-o*s,e[3]=r*s,e};var ms=function(e){var t=e[0],n=e[1],i=e[2],o=e[3];return Math.sqrt(t*t+n*n+i*i+o*o)};var vs=function(e,t,n,i){var o=t[0],r=t[1],a=t[2],s=t[3];return e[0]=o+i*(n[0]-o),e[1]=r+i*(n[1]-r),e[2]=a+i*(n[2]-a),e[3]=s+i*(n[3]-s),e},gs=function(e,t,n){var i=t[0],o=t[1],r=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+a*s+o*c-r*l,e[1]=o*u+a*l+r*s-i*c,e[2]=r*u+a*c+i*l-o*s,e[3]=a*u-i*s-o*l-r*c,e};var ys=function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=n*n+i*i+o*o+r*r;a>0&&(a=1/Math.sqrt(a),e[0]=n*a,e[1]=i*a,e[2]=o*a,e[3]=r*a);return e},bs=function(e,t,n){n*=.5;var i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*s,e[1]=o*l+r*s,e[2]=r*l-o*s,e[3]=a*l-i*s,e};var ws=function(e,t,n){n*=.5;var i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l-r*s,e[1]=o*l+a*s,e[2]=r*l+i*s,e[3]=a*l-o*s,e};var xs=function(e,t,n){n*=.5;var i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=o*l-i*s,e[2]=r*l+a*s,e[3]=a*l-r*s,e};var _s=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]};var Cs=function(e){var t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)};var Ms=function(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e};var Ps=function(e,t,n){var i=_s(t,n);return i<-.999999?(Ba(Ss,Es,t),Cs(Ss)<1e-6&&Ba(Ss,Ts,t),Va(Ss,Ss),Ms(e,Ss,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Ba(Ss,t,n),e[0]=Ss[0],e[1]=Ss[1],e[2]=Ss[2],e[3]=1+i,ys(e,e))},Ss=[0,0,0],Es=[1,0,0],Ts=[0,1,0];var As=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e};var Os=function(e,t,n,i,o){return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e};var zs=function(e,t,n,i){return Rs[0]=n[0],Rs[3]=n[1],Rs[6]=n[2],Rs[1]=i[0],Rs[4]=i[1],Rs[7]=i[2],Rs[2]=-t[0],Rs[5]=-t[1],Rs[8]=-t[2],ys(e,hs(e,Rs))},Rs=function(){var e=new Float32Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}();var Fs=function(e,t,n,i){var o,r,a,s,l,c=t[0],u=t[1],h=t[2],f=t[3],d=n[0],p=n[1],m=n[2],v=n[3];(r=c*d+u*p+h*m+f*v)<0&&(r=-r,d=-d,p=-p,m=-m,v=-v);1-r>1e-6?(o=Math.acos(r),a=Math.sin(o),s=Math.sin((1-i)*o)/a,l=Math.sin(i*o)/a):(s=1-i,l=i);return e[0]=s*c+l*d,e[1]=s*u+l*p,e[2]=s*h+l*m,e[3]=s*f+l*v,e};var Ls=function(e,t,n,i,o,r){return Fs(Ds,t,o,r),Fs(ks,n,i,r),Fs(e,Ds,ks,2*r*(1-r)),e},Ds=[0,0,0,1],ks=[0,0,0,1];var Ns={add:os,calculateW:rs,clone:as,conjugate:ss,copy:ls,create:cs,dot:us,fromMat3:hs,fromValues:fs,identity:ds,invert:ps,length:ms,lerp:vs,multiply:gs,normalize:ys,rotateX:bs,rotateY:ws,rotateZ:xs,rotationTo:Ps,scale:As,set:Os,setAxes:zs,setAxisAngle:Ms,slerp:Fs,sqlerp:Ls,squaredLength:function(e){var t=e[0],n=e[1],i=e[2],o=e[3];return t*t+n*n+i*i+o*o}}.rotationTo;function Is(e,{variables:t,model:n,config:i}){const o=new ns(e,i.view.lightPosition),r=new is(e,i.view.lightPosition),a={bufferLength:n.bufferLength,particleCount:n.particleCount,stepCount:n.stepCount||n.bufferLength,pathicleGap:i.view.pathicleRelativeGap*i.view.pathicleWidth,pathicleWidth:i.view.pathicleWidth,viewRange:e.prop("viewRange"),ambient:(e,t)=>new Array(3).fill(t.ambientIntensity),pointLightPosition:i.view.lights[0].position,lightPos:i.view.lightPosition,dt:2*n.halfDeltaTOverC,rgbGamma:i.view.rgbGamma},s=e({uniforms:a}),l=ts(e,{variables:t,model:n,view:i.view},r,o),c=function(e,t,n){const i=function(e,t,n,i,o){e=e||1,t=t||1,n=n||1,i=i||1;const r=!(!o||!o.quads)&&o.quads,a=[],s=[],l=[],c=[];for(let o=0;o<=i;o++)for(let u=0;u<=n;u++){const h=u/n,f=o/i,d=-e/2+h*e,p=t/2-f*t;a.push([d,0,p]),s.push([h,1-f]),l.push([0,0,1]),o<i&&u<n&&(r?c.push([o*(n+1)+u,(o+1)*(n+1)+u,(o+1)*(n+1)+u+1,o*(n+1)+u+1]):(c.push([o*(n+1)+u,(o+1)*(n+1)+u+1,o*(n+1)+u+1]),c.push([(o+1)*(n+1)+u+1,o*(n+1)+u,(o+1)*(n+1)+u])))}return{positions:a,normals:l,uvs:s,cells:c}}(t.stageGrid.size,t.stageGrid.size);return{lighting:e({blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,1]},cull:{enable:!0,face:"front"},depth:!1,primitive:"triangles",elements:i.cells,attributes:{position:i.positions},uniforms:{uOffset:[0,t.stageGrid.y,0],uResolution:[t.stageGrid.size,t.stageGrid.size],shadowMap:n.fbo,lightPosition:t.lightPosition,shadowProjectionMatrix:n.shadowProjectionMatrix,shadowViewMatrix:n.shadowViewMatrix},vert:"precision highp float;\n#define GLSLIFY 1\n\n#define FOG_DENSITY 0.2\n#define FOG_START 10.\n#define FOG_END 20.\nfloat fogFactorLinear(\n  const float dist,\n  const float start,\n  const float end\n) {\n  return 1.0 - clamp((end - dist) / (end - start), 0.0, 1.0);\n}\n\nfloat fogFactorExp2(\n  const float dist,\n  const float density\n) {\n  const float LOG2 = -1.442695;\n  float d = density * dist;\n  return 1.0 - clamp(exp2(d * d * LOG2), 0.0, 1.0);\n}\n\nattribute vec3 position;\n//\nuniform vec3 uOffset;\nuniform mat4 projection;\nuniform mat4 view;\n//\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying float fogAmount;\n\nuniform mat4 shadowViewMatrix;\nuniform mat4 shadowProjectionMatrix;\nvarying vec4 vLightNDC;\n// Matrix to shift range from -1->1 to 0->1\nconst mat4 depthScaleMatrix = mat4(\n0.5, 0, 0, 0,\n0, 0.5, 0, 0,\n0, 0, 0.5, 0,\n0.5, 0.5, 0.5, 1\n);\n\nvoid main () {\n  //  vUv = uv / 1.;\n  vPosition = position + uOffset;\n\n  vLightNDC = depthScaleMatrix * shadowProjectionMatrix * shadowViewMatrix  * vec4(vPosition, 1.0);\n\n  gl_Position = projection * view * vec4(vPosition, 1.);\n\n  float fogDistance = length(vPosition.xyz);\n  fogAmount = fogFactorExp2(fogDistance, FOG_DENSITY);\n  fogAmount = fogFactorLinear(fogDistance, FOG_START, FOG_END);\n}\n",frag:"precision highp float;\n#define TRANSPARENT\n#extension GL_OES_standard_derivatives : enable\n#define GLSLIFY 1\n\nfloat fogFactorExp2(\n  const float dist,\n  const float density\n) {\n  const float LOG2 = -1.442695;\n  float d = density * dist;\n  return 1.0 - clamp(exp2(d * d * LOG2), 0.0, 1.0);\n}\n\n#define SQRT2 1.41421356\n#define PI 3.14159\n\nvec3 mainColor = vec3(.7, .7, .7);\nvec3 lineColor = vec3(.2, .2, .2);\nvec4 gridControl = vec4(.1, 10., .5, .99);\nvec3 gridOffset = vec3(0., 0., 0.);\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nfloat getVisibility(float position) {\n  float majorGridFrequency=gridControl.y;\n  if (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n  {\n    return 1.0;\n  }\n  return gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\n  const float maxNumberOfLines=4.0;\n  return clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines, 0.0, 1.0);\n}\nfloat isPointOnLine(float position, float differentialLength) {\n  float fractionPartOfPosition = position-floor(position+0.5);\n  fractionPartOfPosition/=differentialLength;\n  fractionPartOfPosition=clamp(fractionPartOfPosition, -1., 1.);\n  float result=0.5+0.5*cos(fractionPartOfPosition*PI);\n  return result;\n}\nfloat contributionOnAxis(float position) {\n  float differentialLength=length(vec2(dFdx(position), dFdy(position)));\n  differentialLength*=SQRT2;\n  float result=isPointOnLine(position, differentialLength);\n  float visibility=getVisibility(position);\n  result*=visibility;\n  float anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\n  result*=anisotropicAttenuation;\n  return result;\n}\nfloat normalImpactOnAxis(float x) {\n  float normalImpact=clamp(1.0-3.0*abs(x*x*x), 0.0, 1.0);\n  return normalImpact;\n}\n\nvoid main(void) {\n  float gridRatio=gridControl.x;\n  vec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n  float x=contributionOnAxis(gridPos.x);\n  float y=contributionOnAxis(gridPos.y);\n  float z=contributionOnAxis(gridPos.z);\n  vec3 normal=normalize(vNormal);\n  //  x*=normalImpactOnAxis(normal.x);\n  //  y*=normalImpactOnAxis(normal.y);\n  //  z*=normalImpactOnAxis(normal.z);\n  float grid=clamp(x+y+z, 0., 1.);\n  vec3 color=mix(mainColor, lineColor, grid);\n  float opacity=1.0;\n  opacity=clamp(grid, 0.08, gridControl.w*grid);\n  gl_FragColor=vec4(color.rgb, opacity);\n}\n\n"})}}(e,i.view,r),u=function(e,t){const n=new Float32Array(16);return e({frag:"\n      precision highp float;\n      uniform vec3 axis;\n      void main () {\n        gl_FragColor = vec4(axis,1);\n      }\n    ",vert:"\n      precision highp float;\n      uniform mat4 projection, view, model;\n      uniform vec3 eye, center;\n      attribute vec3 position;\n      void main () {\n        gl_Position = projection * view * model * vec4(position,1);\n      }\n    ",uniforms:{axis:e.prop("axis"),model:function(e,t){Za(n);Ja(n,n,0,t.axis);var i=new Float32Array(16),o=[0,0,0,0];return Ns(o,[0,1,0],t.axis),Qa(i,o),$a(n,n,i),n}},attributes:{position:[[0,0,0],[0,t-.1,0],[.05,t-.2,0],[0,t,0],[-.05,t-.2,0],[0,t-.1,0]],axis:e.prop("axis")},depth:{enable:!1},count:6,primitive:"line strip"})}(e,1),h=function(e){return{lighting:e({blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,1]},frag:"precision highp float;\n#define GLSLIFY 1\n\n// Based on distance functions found at:\n// http://iquilezles.org/www/articles/distfunctions/distfunctions.htm\nfloat sdSquare(vec2 point, float width) {\n  vec2 d = abs(point) - width;\n  return min(max(d.x,d.y),0.0) + length(max(d,0.0));\n}\n\nfloat vignette(vec2 uv, vec2 size, float roundness, float smoothness) {\n  // Center UVs\n  uv -= 0.5;\n\n  // Shift UVs based on the larger of width or height\n  float minWidth = min(size.x, size.y);\n  uv.x = sign(uv.x) * clamp(abs(uv.x) - abs(minWidth - size.x), 0.0, 1.0);\n  uv.y = sign(uv.y) * clamp(abs(uv.y) - abs(minWidth - size.y), 0.0, 1.0);\n\n  // Signed distance calculation\n  float boxSize = minWidth * (1.0 - roundness);\n  float dist = sdSquare(uv, boxSize) - (minWidth * roundness);\n\n  return 1. - smoothstep(0.0, smoothness, dist);\n}\n\nuniform vec2 screenSize;\nuniform vec2 size;\nuniform float roundness;\nuniform float smoothness;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / screenSize;\n  float v = vignette(uv, size, roundness, smoothness);\n  gl_FragColor = vec4(vec3(v), 1.-v);\n}\n",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    void main() {\n      gl_Position = vec4(position, 0, 1);\n    }",attributes:{position:e.buffer([-4,-4,4,-4,0,4])},uniforms:{color:[1,1,0,1],screenSize:({viewportWidth:e,viewportHeight:t})=>[e,t],size:[.1,.1],roundness:.5,smoothness:.9},count:3,depth:{enable:!0}})}}(e);return{destroy:()=>{},drawDiffuse:function(t){s(i.view,()=>{e.clear({color:[1,1,1,1],depth:1,framebuffer:r.fbo}),u([{axis:[1,0,0]},{axis:[0,1,0]},{axis:[0,0,1]}]),l.lighting(t),i.view.isStageVisible&&c.lighting(t),h.lighting(t)})},cubeShadow:o,shadow:r}}new Array(3).fill(0),new Array(3).fill(0),Math.PI;function Ws(e){document.addEventListener("keydown",(function(t){t.stopPropagation();const n=t.which;if(65===n)e.config.view.camera.autorotate=!e.config.view.camera.autorotate;else if(67===n){const t=e.camera.toConfig();console.log(JSON.stringify({camera:t},null,2))}else 68===n?console.log(e.simulation.dump()):77===n?e.pathiclesRunner.toggleMode():84===n?e.config.view.showTextures=!e.config.view.showTextures:71===n?e.config.drawGrid=!e.config.drawGrid:83===n?function(e,t,n="png"){let i,o;if("png"===n.toLowerCase()?(i="image/png",o="png"):"webp"===n.toLowerCase()?(i="image/webp",o="webp"):"gif"===n.toLowerCase()?(i="image/gif",o="gif"):(i="image/jpeg",o="jpg"),navigator.msSaveOrOpenBlob){const n=e.msToBlob(i,1);window.navigator.msSaveBlob(n,t+"."+o)}else{const n=e.toDataURL(i,1),r=document.createElement("a");r.download=t+"."+o,r.href=n,r.dataset.downloadurl=[i,r.download,r.href].join(":"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}}(e.regl._gl.canvas,"pathicles"+(e.presetName?"--"+e.presetName:"")):78===n?e.pathiclesRunner.next():76===n?e.pathiclesRunner.toggleLooping():32===n&&e.pathiclesRunner.toggleActivity();return!1}),!1)}function Vs(e,t,n){const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);const o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,t,1,1,0,e.RGBA,n,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0);return e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE}function Bs(){const e={};try{const t=document.createElement("canvas");if(window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))){const n=t.getContext("webgl")||t.getContext("experimental-webgl");return Ia.start("getRTTFloatType"),e.RTTFloatType=function(e){return e.getExtension("WEBGL_color_buffer_float")&&e.getExtension("OES_texture_float")&&Vs(e,e.RGBA,e.FLOAT)?"float":(e.getExtension("WEBGL_color_buffer_float")&&e.getExtension("OES_texture_half_float")&&Vs(e,e.RGBA,e.HALF_FLOAT),"half float")}(n),Ia.stop(),e.precision={VERTEX_SHADER:{LOW_FLOAT:n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_FLOAT),MEDIUM_FLOAT:n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT),HIGH_FLOAT:n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT),LOW_INT:n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_INT),MEDIUM_INT:n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_INT),HIGH_INT:n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_INT)},FRAGMENT_SHADER:{LOW_FLOAT:n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_FLOAT),MEDIUM_FLOAT:n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT),HIGH_FLOAT:n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),LOW_INT:n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_INT),MEDIUM_INT:n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_INT),HIGH_INT:n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_INT)}},e}}catch(e){throw e}}class Gs{constructor({canvas:e,config:t,pixelRatio:n,control:i,simulate:o=!0}){Ws(this),this.config=t,this.simulate=o,this.control=i,createREGL({canvas:e,profile:this.config.profile,attributes:{preserveDrawingBuffer:!1,antialiasing:!0},pixelRatio:n,onDone:(e,t)=>{if(e)return console.error(e);try{this.regl=t,window.pathicles=this,Ia.start("checkSupport"),this.checkSupport(t),Ia.stop(),Ia.start("init"),this.init(t),Ia.stop(),this.run(t)}catch(e){console.error(e)}},extensions:o?["angle_instanced_arrays","oes_texture_float","OES_standard_derivatives","OES_texture_half_float","WEBGL_depth_texture"]:["angle_instanced_arrays","oes_texture_float","OES_standard_derivatives","WEBGL_depth_texture"]})}destroy(){console.log("destroy"),this.regl.destroy()}loadConfig(e){this.stop(this.regl),this.config=e,this.init(this.regl),this.run(this.regl)}checkSupport(){this.support=Bs()}init(e){this.regl._commands=[],this.cameras=[],this.setCameraUniforms=[],[this.cameras.free,this.setCameraUniforms.free]=ma({...this.config.view.camera},e),this.camera=this.cameras.free,Ia.start("init.simulation"),this.simulation=new Na(e,{...this.config},this.support),Ia.stop(),Ia.start("init.view"),this.view=Is(e,{variables:this.simulation.variables,model:this.simulation.model,config:this.config}),Ia.stop(),Ia.start("init.runner"),this.pathiclesRunner=new Wa(this.simulation,{...this.config.runner,simulate:this.simulate}),Ia.stop()}run(e){this.simulate&&this.pathiclesRunner.start();this.loop=(()=>e.frame(()=>{this.config.view.camera.autorotate&&this.cameras.free.rotate(this.config.view.camera.dTheta,0),this.simulate&&this.pathiclesRunner.next(),this.setCameraUniforms[this.control.cameraMode]({...this.cameras[this.control.cameraMode]},()=>{this.cameras.free.tick({}),this.view.drawDiffuse({viewRange:[0,1]}),this.config.view.showTextures&&(this.simulation.drawVariableTexture({variableName:"position"}),this.simulation.drawVariableTexture({variableName:"velocity"}))})}))()}stop(){this.loop.cancel()}}var Ys={MAX_CANVAS_SIZE:512,MAX_PARTICLE_COUNT:512,MAX_BUFFER_LENGTH:256,logPushing:!1,logPerformance:!1,stats:!1,profile:!1,colors:[[.92,.75,0],[.12,.45,.65],[.12,.45,.65],[.77,.2,.2]],mass:[0,510998.94,510998.94,938272081],charge:[0,-1,1,1],chargeMassRatio:[0,-175882004556.243,175882004556.243,95788332.3113771],pusher:"boris",simulateHalfFloat:!1,runner:{prerender:!1,loops:1,mode:"framewise",stepsPerTick:4,stepCount:127},model:{bufferLength:128,tickDurationOverC:.5,boundingBoxSize:-1,emitter:{particleType:"ELECTRON",randomize:!1,bunchShape:"square",particleCount:128,particleSeparation:.15,gamma:0,position:[0,0,0],direction:[0,0,1],directionJitter:[0,0,0],positionJitter:[0,0,0]},interactions:{particleInteraction:!1,gravityConstant:0,electricField:[0,0,0],magneticField:[0,0,0]},lattice:{elements:{},beamline:[]}},view:{lightPosition:[0,2,0],ssaoEnabled:!1,stageGrid:{y:0,size:20,dark:1,light:.8},sky:[.9,1,0,1],shadowColor:[.8,.8,.8,1],ambientIntensity:.6,diffuse:0,exposure:.2,fresnel:1,fxaa:!1,rgbGamma:1,isStageVisible:!0,isShadowEnabled:!1,isLatticeVisible:!1,pathicleRelativeGap:2,pathicleRelativeHeight:10,pathicleWidth:.002,roughness:.7,specular:1,ssaoBlurPower:2,ssaoBlurRadius:.1,ssaoPower:1,ssaoSampleCount:32,showTextures:!0,texelSize:1,viewRange:[0,1],lights:[{position:[0,1,0],direction:[1,1,0],color:new Array(3).fill(0)},{position:[0,1,0],direction:[-1,-1,0],color:new Array(3).fill(0)}],camera:{position:[1,1,0],target:[0,1,0],fovY:2*Math.PI/7.2,dTheta:.001,autorotate:!1,rotateAboutCenter:!0,zoomAboutCursor:!1,zoomDecayTime:.1,far:50,near:1e-4,minDistance:.1,maxDistance:10}},dumpData:!1};const js="DRIF",Xs="SBEN",Hs="QUAD",Us={name:"story-dipole",view:{camera:{position:[0,1.5,7],target:[0,1.5,0]}},model:{emitter:{particleType:"ELECTRON ELECTRON",bunchShape:"SQUARE",direction:[0,.25,-1],position:[2,-2,0],particleSeparation:.15,directionJitter:[0,0,0],positionJitter:[0,.1,0],gamma:1.55},interactions:{magneticField:[0,0,0],particleInteraction:!1},lattice:{elements:{l:{type:js,l:0},d:{type:Xs,l:20,strength:.001}},beamline:["l","d"],origin:{phi:0,position:[0,0,-10]}}}},qs={name:"story-electric",view:{camera:{position:[2.5,2,-2.5],target:[0,2.1,0]}},model:{emitter:{particleType:"ELECTRON PROTON PHOTON",bunchShape:"SQUARE",position:[0,2,-10],direction:[0,0,1],directionJitter:[0,0,0],positionJitter:[.1,.1,0],gamma:1.2},interactions:{electricField:[0,0,-1e-11],particleInteraction:!1,magneticField:[0,0,0]},lattice:{elements:{},beamline:[],origin:{phi:0,position:[0,1,-6]}}}},Zs={name:"story-quadrupole",view:{camera:{position:[5,1,5],target:[0,1,0]}},model:{tickDurationOverC:.2,emitter:{particleType:"PROTON ",bunchShape:"SQUARE_YZ",direction:[1,0,0],position:[-10,2,0],directionJitter:[.2,.2,0],positionJitter:[0,0,0],gamma:3},lattice:{elements:{q1:{type:Hs,strength:1,l:1},q2:{type:Hs,strength:-1,l:1},l1:{type:js,l:10},l2:{type:js,l:1},l3:{type:js,l:2}},beamline2:["l1","q1","q2","l1","q3","q4","l1"],beamline:["l1","q1","l2","q2","l3","q1","l2","q2","l1"],origin:{phi:-Math.PI/2,position:[-10,0,0]}}}},$s={name:"random",view:{camera:{position:[5,1,-5],target:[0,.2,0]}},runner:{prerender:!1,loops:10,mode:"framewise",stepsPerTick:8,stepCount:128},model:{boundingBoxSize:2,bufferLength:64,tickDurationOverC:.1,emitter:{randomize:!0,gamma:2,particleCount:512,particleType:"PHOTON ELECTRON PROTON"}}},Js={name:"free-electron",view:{camera:{position:[2.5,.2,2.5],target:[0,0,0]}},runner:{prerender:!1,loops:0,mode:"framewise",stepsPerTick:1,stepCount:11},model:{bufferLength:11,tickDurationOverC:.1,emitter:{particleCount:1,particleType:"ELECTRON",bunchShape:"SQUARE",direction:[0,0,1],position:[0,.01,0],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:100},interactions:{electricField:[0,0,0],particleInteraction:!1,magneticField:[0,0,0]}}};var Qs={name:"gyrotest-1-electron",view:{camera:{position:[3,3,0],target:[0,0,0]}},runner:{stepsPerTick:8,stepCount:83},model:{bufferLength:128,tickDurationOverC:.1,emitter:{particleCount:1,particleType:"ELECTRON",bunchShape:"SQUARE",direction:[0,0,1],position:[-1,0,0],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:1.55},lattice:{elements:{l0:{type:Xs,l:20,strength:.002}},beamline:["l0"],origin:{phi:0,position:[0,0,-10]}}}};const Ks={name:"free-photon",view:{camera:{position:[2.5,.2,2.5],target:[0,0,0]}},runner:{prerender:!1,loops:0,mode:"framewise",stepsPerTick:1,stepCount:11},model:{bufferLength:11,tickDurationOverC:.1,emitter:{particleCount:1,particleType:"PHOTON",bunchShape:"SQUARE",direction:[0,0,1],position:[0,0,0],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:0},interactions:{electricField:[0,0,.01],particleInteraction:!1,magneticField:[0,0,0]}}},el={name:"free-photons",view:{camera:{position:[2.5,.2,2.5],target:[0,0,0]}},runner:{prerender:!0,loops:1,mode:"framewise",stepsPerTick:8,stepCount:200},model:{bufferLength:200,tickDurationOverC:.1,emitter:{particleCount:484,particleType:"PHOTON",bunchShape:"SQUARE",direction:[0,0,1],position:[0,1,-10],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:1},interactions:{electricField:[0,0,0],particleInteraction:!1,magneticField:[0,0,0]}}};let tl=(...e)=>{let t={},n=e=>{for(let n in e)e.hasOwnProperty(n)&&("[object Object]"===Object.prototype.toString.call(e[n])?t[n]=tl(t[n],e[n]):t[n]=e[n])};for(let t=0;t<e.length;t++)n(e[t]);return t};const nl={[Us.name]:Us,[qs.name]:qs,[Zs.name]:Zs,[Js.name]:Js,[Ks.name]:Ks,[el.name]:el,[$s.name]:$s,[Qs.name]:Qs},il=e=>tl(!0,Ys,nl[e])||Ys;var ol={name:"PathiclesSimulator",props:{maxScreenWidth:{type:Number,default:300},maxScreenHeight:{type:Number,default:600},maxPixelRatio:{type:Number,default:2}},data:()=>({screenWidth:500,screenHeight:500,progress:.5,cameraMode:"free",viewRange:[0,1],presets:nl,presetName:"story-electric",config:{},configModel:{}}),computed:{pixelRatio(){return!window||Math.min(this.maxPixelRatio,window.devicePixelRatio)},canvasStyles(){return{width:this.screenWidth+"px",height:this.screenHeight+"px"}},canvasWidth(){return this.screenWidth*this.pixelRatio},canvasHeight(){return this.screenHeight*this.pixelRatio}},mounted(){const e=new URL(window.location.href);null!==e.searchParams.get("presetName")&&(this.presetName=e.searchParams.get("presetName")),this.config=il(this.presetName),e.searchParams.get("prerender")&&(this.config.runner.prerender=!0),this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.$nextTick(()=>{this.reglInstance=new Gs({canvas:this.$refs.canvas,config:this.config,pixelRatio:this.pixelRatio,simulate:!0,control:{viewRange:this.viewRange,progress:this.progress,cameraMode:this.cameraMode}})})},methods:{handleResize(){this.scrollyHeight=document.documentElement.clientHeight},onChange(){const e={presetName:this.presetName};history.pushState({},null,this.$route.path+"?"+Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")),this.config=il(this.presetName),this.reglInstance.loadConfig(this.config)},update(e){this.config.model.interactions.electricField=[0,0,parseFloat(e.electricField_z)],this.config.model.interactions.magneticField=[0,parseFloat(e.magneticField_y),0],this.reglInstance.loadConfig(this.config)},initGui(e){}}};const rl={class:"pathicles pathicles-simulator",ref:"scrollContainer"},al={class:"configurator"},sl={class:"canvas-container",ref:"container"};ol.render=function(e,t,n,i,o,r){return $t(),Qt("div",rl,[on("div",al,[Nn(on("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.presetName=t),onChange:t[2]||(t[2]=e=>r.onChange(e))},[($t(!0),Qt(jt,null,_i(e.presets,t=>($t(),Qt("option",{value:t.name,selected:t===e.presetName},h(t.name),9,["value","selected"]))),256))],544),[[Yi,e.presetName]])]),on("div",sl,[on("canvas",{ref:"canvas",style:r.canvasStyles,width:r.canvasWidth,height:r.canvasHeight},null,12,["width","height"]),sn('      dat-gui(:model="configModel" @change="onChange")')],512)],512)},ol.__file="src/components/PathiclesSimulator.vue";const ll="undefined"==typeof window;function cl(e,t){let n=0;return function(...i){const o=(new Date).getTime();if(!(o-n<e))return n=o,t(...i)}}function ul(e){return Math.floor(e.reduce((e,t)=>e+t,0)/e.length)}const hl=new class{constructor(){ll||(this.lastX=0,this.lastY=0,this.lastWidth=window.innerWidth,this.lastHeight=window.innerHeight,this.lastMouseX=0,this.lastMouseY=0,this.lastWindowX=window.screenX,this.lastWindowY=window.screenY,this.lastAlpha=0,this.lastBeta=0,this.lastGamma=0,this.currAlpha=0,this.currBeta=0,this.currGamma=0,this.scrollHeight=document.body.scrollHeight,this.scrollChange=!1,this.sizeChange=!1,this.mouseChange=!1,this.positionChange=!1,this.orientationChange=!1,this.devicePixelRatioChange=!1,this.currX=0,this.currY=0,this.currWidth=window.innerWidth,this.currHeight=window.innerHeight,this.currMouseX=0,this.currMouseY=0,this.currWindowX=0,this.currDevicePixelRatio=this.lastDevicePixelRatio=Math.max(window.devicePixelRatio||1,1),this.mouseXVelocity=[],this.mouseYVelocity=[],this.lastMouseXVelocity=0,this.lastMouseYVelocity=0,this.windowXVelocity=[],this.windowYVelocity=[],this.lastWindowXVelocity=0,this.lastWindowYVelocity=0,this.updating=!1,this.callbacks=[],this.update=this.update.bind(this),this.handleResize=this.handleResize.bind(this),this.handleMouse=this.handleMouse.bind(this),this.handleOrientation=this.handleOrientation.bind(this),this.recalibrateOrientation=this.recalibrateOrientation.bind(this),this.formatData=this.formatData.bind(this),this.watch=this.watch.bind(this),this.unwatch=this.unwatch.bind(this),this.handleResize=cl(110,this.handleResize),this.handleMouse=cl(75,this.handleMouse),window.addEventListener("resize",this.handleResize),window.addEventListener("mousemove",this.handleMouse),window.addEventListener("deviceorientation",this.handleOrientation),requestAnimationFrame(this.update))}handleResize(e){this.currWidth=window.innerWidth,this.currHeight=window.innerHeight}handleMouse(e){this.currMouseX=e.clientX,this.currMouseY=e.clientY}handleOrientation(e){this.initialAlpha||(this.initialAlpha=e.alpha),this.initialBeta||(this.initialBeta=e.beta),this.initialGamma||(this.initialGamma=e.gamma),this.currAlpha=e.alpha,this.currBeta=e.beta,this.currGamma=e.gamma}recalibrateOrientation(){const e={prev:{alpha:this.initialAlpha,beta:this.initialBeta,gamma:this.initialGamma}};return this.initialAlpha=this.lastAlpha,this.initialBeta=this.lastBeta,this.initialGamma=this.lastGamma,e.current={alpha:this.initialAlpha,beta:this.initialBeta,gamma:this.initialGamma},e}formatData(){return{scroll:{changed:this.scrollChange,left:Math.floor(this.lastX),right:Math.floor(this.lastX+this.lastWidth),top:Math.floor(this.lastY),bottom:Math.floor(this.lastY+this.lastHeight),velocity:{x:Math.floor(this.scrollXVelocity)||0,y:Math.floor(this.scrollYVelocity)||0}},size:{changed:this.sizeChange,x:Math.floor(this.lastWidth),y:Math.floor(this.lastHeight),docY:Math.floor(this.scrollHeight)},mouse:{changed:this.mouseChange,x:Math.floor(this.lastMouseX),y:Math.floor(this.lastMouseY),velocity:{x:Math.floor(this.lastMouseXVelocity)||0,y:Math.floor(this.lastMouseYVelocity)||0}},position:{changed:this.positionChange,left:Math.floor(this.lastWindowX),right:Math.floor(this.lastWindowX+this.lastWidth),top:Math.floor(this.lastWindowY),bottom:Math.floor(this.lastWindowY+this.lastHeight),velocity:{x:Math.floor(this.lastWindowXVelocity)||0,y:Math.floor(this.lastWindowYVelocity)||0}},orientation:{changed:this.orientationChange,alpha:Math.floor(this.lastAlpha-this.initialAlpha)||0,beta:Math.floor(this.lastBeta-this.initialBeta)||0,gamma:Math.floor(this.lastGamma-this.initialGamma)||0},devicePixelRatio:{changed:this.devicePixelRatioChange,ratio:this.currDevicePixelRatio}}}update(){const{currWidth:e,currHeight:t,currMouseX:n,currMouseY:i,currAlpha:o,currBeta:r,currGamma:a,currDevicePixelRatio:s}=this;if(this.updating)return!1;this.scrollChange=this.sizeChange=this.mouseChange=this.positionChange=this.orientationChange=this.devicePixelRatioChange=!1,this.windowXVelocity.length>5&&this.windowXVelocity.shift(),this.windowXVelocity.push(window.screenX-this.lastWindowX),ul(this.windowXVelocity)!=this.lastWindowXVelocity&&(this.lastWindowXVelocity=ul(this.windowXVelocity),this.positionChange=!0),window.screenX!=this.lastWindowX&&(this.positionChange=!0,this.lastWindowX=window.screenX),this.windowYVelocity.length>5&&this.windowYVelocity.shift(),this.windowYVelocity.push(window.screenY-this.lastWindowY),ul(this.windowYVelocity)!=this.lastWindowYVelocity&&(this.lastWindowYVelocity=ul(this.windowYVelocity),this.positionChange=!0),window.screenY!=this.lastWindowY&&(this.positionChange=!0,this.lastWindowY=window.screenY),window.pageXOffset==this.lastX&&0!=this.scrollXVelocity&&(this.scrollXVelocity=0,this.scrollChange=!0),window.pageYOffset==this.lastY&&0!=this.scrollYVelocity&&(this.scrollYVelocity=0,this.scrollChange=!0),window.pageXOffset!=this.lastX&&(this.scrollChange=!0,this.scrollXVelocity=Math.floor(window.pageXOffset-this.lastX),this.lastX=window.pageXOffset),window.pageYOffset!=this.lastY&&(this.scrollChange=!0,this.scrollYVelocity=Math.floor(window.pageYOffset-this.lastY),this.lastY=window.pageYOffset),e!=this.lastWidth&&(this.lastWidth=e,this.scrollHeight=document.body.scrollHeight,this.sizeChange=!0),t!=this.lastHeight&&(this.lastHeight=t,this.sizeChange=!0),this.mouseXVelocity.length>5&&this.mouseXVelocity.shift(),this.mouseXVelocity.push(n-this.lastMouseX),ul(this.mouseXVelocity)!=this.lastMouseXVelocity&&(this.lastMouseXVelocity=ul(this.mouseXVelocity),this.mouseChange=!0),n!=this.lastMouseX&&(this.lastMouseX=n,this.mouseChange=!0),this.mouseYVelocity.length>5&&this.mouseYVelocity.shift(),this.mouseYVelocity.push(i-this.lastMouseY),ul(this.mouseYVelocity)!=this.lastMouseYVelocity&&(this.lastMouseYVelocity=ul(this.mouseYVelocity),this.mouseChange=!0),i==this.lastMouseY&&0==ul(this.mouseYVelocity)||(this.lastMouseY=i,this.mouseChange=!0),o!=this.lastAlpha&&(this.lastAlpha=o,this.orientationChange=!0),r!=this.lastBeta&&(this.lastBeta=r,this.orientationChange=!0),a!=this.lastGamma&&(this.lastGamma=a,this.orientationChange=!0),(this.positionChange||this.sizeChange)&&(this.currDevicePixelRatio=Math.max(window.devicePixelRatio||1,1),this.currDevicePixelRatio!==this.lastDevicePixelRatio&&(this.devicePixelRatioChange=!0,this.lastDevicePixelRatio=this.currDevicePixelRatio)),(this.scrollChange||this.sizeChange||this.mouseChange||this.positionChange||this.orientationChange||this.devicePixelRatioChange)&&this.callbacks.forEach(e=>e(this.formatData())),this.updating=!1,requestAnimationFrame(this.update)}watch(e,t=!0){if("function"!=typeof e)throw new Error("Value passed to Watch is not a function");if(!ll){if(t){const t=this.formatData();t.scroll.changed=!0,t.mouse.changed=!0,t.size.changed=!0,t.position.changed=!0,t.orientation.changed=!0,t.devicePixelRatio.changed=!0,e(t)}this.callbacks.push(e)}}unwatch(e){if("function"!=typeof e)throw new Error("The value passed to unwatch is not a function");ll||(this.callbacks=this.callbacks.filter(t=>t!==e))}};ll||(window.__TORNIS={watchViewport:hl.watch,unwatchViewport:hl.unwatch,getViewportState:hl.formatData,recalibrateOrientation:hl.recalibrateOrientation});const fl=hl.watch,dl=hl.unwatch;var pl=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e};var ml=function(e,t){var n=t[0],i=t[1],o=t[2],r=n*n+i*i+o*o;r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r);return e};var vl=function(e,t,n){var i=t[0],o=t[1],r=t[2],a=n[0],s=n[1],l=n[2];return e[0]=o*l-r*s,e[1]=r*a-i*l,e[2]=i*s-o*a,e};var gl=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var yl=function(e,t,n,i){var o,r,a,s,l,c,u,h,f,d,p=t[0],m=t[1],v=t[2],g=i[0],y=i[1],b=i[2],w=n[0],x=n[1],_=n[2];if(Math.abs(p-w)<1e-6&&Math.abs(m-x)<1e-6&&Math.abs(v-_)<1e-6)return gl(e);u=p-w,h=m-x,f=v-_,d=1/Math.sqrt(u*u+h*h+f*f),o=y*(f*=d)-b*(h*=d),r=b*(u*=d)-g*f,a=g*h-y*u,(d=Math.sqrt(o*o+r*r+a*a))?(o*=d=1/d,r*=d,a*=d):(o=0,r=0,a=0);s=h*a-f*r,l=f*o-u*a,c=u*r-h*o,(d=Math.sqrt(s*s+l*l+c*c))?(s*=d=1/d,l*=d,c*=d):(s=0,l=0,c=0);return e[0]=o,e[1]=s,e[2]=u,e[3]=0,e[4]=r,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(o*p+r*m+a*v),e[13]=-(s*p+l*m+c*v),e[14]=-(u*p+h*m+f*v),e[15]=1,e};var bl=function(e,t,n,i,o){var r=1/Math.tan(t/2),a=1/(i-o);return e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*i*a,e[15]=0,e};var wl=function(e,t,n,i,o,r){void 0===e&&(e=1),void 0===t&&(t=e),void 0===n&&(n=e),void 0===i&&(i=1),void 0===o&&(o=i),void 0===r&&(r=i);var a=0,s=[],l=[],c=[],u=[];function h(e,t,n,i,o,r,h,f,d,p){for(var m=a,v=0;v<=h;v++)for(var g=0;g<=r;g++){var y=s[a]=[0,0,0];y[e]=(-i/2+g*i/r)*d,y[t]=(-o/2+v*o/h)*p,y[n]=f;var b=l[a]=[0,0,0];b[e]=0,b[t]=0,b[n]=f/Math.abs(f);var w=c[a]=[0,0];w[0]=g/r,w[1]=1-v/h,++a}for(v=0;v<h;v++)for(g=0;g<r;g++){var x=m+v*(r+1)+g;u.push([x,x+r+1,x+r+2]),u.push([x,x+r+2,x+1])}}return h(0,1,2,e,t,i,o,n/2,1,-1),h(0,1,2,e,t,i,o,-n/2,-1,-1),h(2,1,0,n,t,r,o,-e/2,1,-1),h(2,1,0,n,t,r,o,e/2,-1,-1),h(0,2,1,e,n,i,r,t/2,1,1),h(0,2,1,e,n,i,r,-t/2,1,-1),{positions:s,normals:l,uvs:c,cells:u}},xl="precision highp float;\n#define GLSLIFY 1\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\nmat4 lookAt(vec3 eye, vec3 at, vec3 up) {\n  vec3 zaxis = normalize(eye - at);\n  vec3 xaxis = normalize(cross(zaxis, up));\n  vec3 yaxis = cross(xaxis, zaxis);\n  zaxis *= -1.;\n  return mat4(\n  vec4(xaxis.x, xaxis.y, xaxis.z, -dot(xaxis, eye)),\n  vec4(yaxis.x, yaxis.y, yaxis.z, -dot(yaxis, eye)),\n  vec4(zaxis.x, zaxis.y, zaxis.z, -dot(zaxis, eye)),\n  vec4(0, 0, 0, 1)\n  );\n}\n\nattribute vec3 aPosition;\n\nattribute vec3 aNormal;\nattribute vec2 aUV;\n\nattribute float aParticle;\nattribute float aColorCorrection;\nattribute float aStep;\n\nuniform float particleCount;\nuniform float bufferLength;\nuniform float stepCount;\n\nuniform float dt;\nuniform vec2 viewRange;\n\nuniform float pathicleWidth;\nuniform float pathicleGap;\nuniform float pathicleHeight;\nuniform float stageGrid_y;\nuniform float stageGrid_size;\nuniform vec4 shadowColor;\nuniform vec4 uLight;\n\nuniform sampler2D utParticleColorAndType;\nuniform sampler2D utPositionBuffer;\nuniform sampler2D utVelocityBuffer;\nuniform mat4 projection, view, model;\nuniform vec3 eye;\n\nuniform mat4 shadowViewMatrix_top;\nuniform mat4 shadowViewMatrix;\nuniform mat4 shadowProjectionMatrix;\nvarying vec4 vLightNDC;\n// Matrix to shift range from -1->1 to 0->1\nconst mat4 depthScaleMatrix = mat4(\n0.5, 0, 0, 0,\n0, 0.5, 0, 0,\n0, 0, 0.5, 0,\n0.5, 0.5, 0.5, 1\n);\n\nvarying float toBeDiscarded;\nvarying float boxLength;\nvarying vec3 vScale;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec3 vNormalOrig;\nvarying vec2 vUv;\nvarying vec4 vAmbientColor;\nvarying vec4 vDiffuseColor;\n\nvarying float vColorCorrection;\n\nvec3 hemisphere_light(\n  vec3 normal,\n  vec3 sky,\n  vec3 ground,\n  vec3 lightDirection,\n  mat4 modelMatrix,\n  mat4 viewMatrix,\n  vec3 viewPosition,\n  float shininess,\n  float specularity\n) {\n  vec3 direction = normalize((\n  modelMatrix * vec4(lightDirection, 1.0)\n  ).xyz);\n\n  float weight = 0.5 * dot(\n  normal\n  , direction\n  ) + 0.5;\n\n  vec3 diffuse = mix(ground, sky, weight);\n\n  vec3 specDirection = normalize((\n  viewMatrix * modelMatrix * vec4(lightDirection, 1.0)\n  ).xyz);\n\n  float skyWeight = 0.5 * dot(\n  normal\n  , normalize(specDirection + viewPosition)\n  ) + 0.5;\n\n  float gndWeight = 0.5 * dot(\n  normal\n  , normalize(viewPosition - specDirection)\n  ) + 0.5;\n\n  vec3 specular = specularity * diffuse * (\n  max(pow(skyWeight, shininess), 0.0) +\n  max(pow(gndWeight, shininess), 0.0)\n  ) * weight;\n\n  return diffuse + specular;\n}\n\nvec4 get_color(float p) {\n  vec2 coords = vec2(p, 0.) / vec2(particleCount, 1.);\n  return texture2D(utParticleColorAndType, coords);\n}\nvec4 get_position(float p, float b) {\n  vec2 coords = vec2(p, b) / vec2(particleCount, bufferLength);\n  return texture2D(utPositionBuffer, coords);\n}\nfloat calculateToBeDiscarded(vec4 previousFourPosition, vec4 currentFourPosition) {\n\n  float undefinedBuffer = (currentFourPosition.w == 0. || previousFourPosition.w > currentFourPosition.w) ? 1.0 : 0.0;\n  float beyondProgressLower = (currentFourPosition.w / dt < viewRange[0] * stepCount) ? 1.0 : 0.0;\n  float beyondProgressUpper =  (currentFourPosition.w / dt > viewRange[1] * stepCount) ? 1.0 : 0.0;\n  float outsideGrid = (currentFourPosition.x > stageGrid_size || currentFourPosition.x < -stageGrid_size\n  || currentFourPosition.y > stageGrid_size || currentFourPosition.y < -stageGrid_size\n  || currentFourPosition.z > stageGrid_size || currentFourPosition.z < -stageGrid_size) ? 1.0 : 0.0;\n\n  return (outsideGrid > 0. || undefinedBuffer > 0. || beyondProgressLower > 0. || beyondProgressUpper > 0.) ? 1.0 : 0.0;\n\n}\n\nvoid main () {\n\n  float previousBufferHead = (aStep < 1.) ? bufferLength : aStep - 1.;\n  vec4 previousFourPosition = get_position(aParticle, previousBufferHead);\n  vec4 currentFourPosition = get_position(aParticle, aStep);\n\n  mat4 lookAtMat4 = lookAt(currentFourPosition.xyz, previousFourPosition.xyz, vec3(0., 1, 0.));\n\n  float scale = 1.;\n  float shadowProjectionScale = 1.;\n  #ifdef shadow\n  scale = 1.;\n  shadowProjectionScale = .1;\n  #endif\n\n  vScale = vec3(pathicleWidth, pathicleHeight, length(previousFourPosition.xyz - currentFourPosition.xyz) - pathicleGap);\n\n  boxLength = vScale.z;\n\n  vec3 scaledPosition = vec3(\n     aPosition.x,\n    aPosition.y * shadowProjectionScale,\n     aPosition.z ) * vScale;\n\n  vPosition = vec3(1., 1., 1.) * (((lookAtMat4 * vec4(scaledPosition, 1.)).xyz\n  + 0.5 * (currentFourPosition.xyz + previousFourPosition.xyz)));\n\n  vNormalOrig = aNormal;\n  vNormal = normalize((transpose(inverse(lookAtMat4)) * vec4(aNormal, 0.)).xyz);\n\n  vUv = aUV;\n\n#ifdef lighting\n\n  vDiffuseColor = get_color(aParticle);\n  vAmbientColor = get_color(aParticle);\n  //  float maxDistance = 4.;\n  //  vColorCorrection += aColorCorrection + vNormalOrig.z * vNormalOrig.z * .5;\n  vColorCorrection =  aStep/bufferLength * .5;\n  vColorCorrection =  sin(aParticle)*.1;\n  vLightNDC = depthScaleMatrix * shadowProjectionMatrix * shadowViewMatrix_top * model * vec4(vPosition, 1.0);\n#endif\n\n#ifdef shadow\n    vPosition.y = stageGrid_y + 0.01 * abs(sin(aStep));\n    vDiffuseColor = shadowColor;\n//    if (aPosition.y < 0.) toBeDiscarded = 1.;\n#endif\n\n  toBeDiscarded = calculateToBeDiscarded(previousFourPosition, currentFourPosition);\n\n#ifdef shadowMap\n  gl_Position = shadowProjectionMatrix * shadowViewMatrix * model * vec4(vPosition, 1.0);\n#endif\n\n#ifdef lighting\n  gl_Position = projection * view * model * vec4(vPosition, 1.0);\n#endif\n\n}\n\n",_l="#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n#define GLSLIFY 1\n\nvarying float toBeDiscarded;\nvarying vec3 vPosition;\nvarying vec3 vScale;\nvarying vec3 vNormal;\nvarying vec3 vNormalOrig;\nvarying vec2 vUv;\nvarying vec4 vAmbientColor;\nvarying vec4 vDiffuseColor;\nvarying float vColorCorrection;\n\nuniform vec3 lightPosition;\nuniform float ambientIntensity;\nuniform float stageGrid_size;\nuniform float pathicleWidth;\nuniform vec3 eye;\nuniform vec2 uResolution;\n\n#ifdef lighting\nvarying vec4 vLightNDC;\nuniform samplerCube cubeShadow;\nuniform sampler2D shadowMap;\n#endif\n\nfloat edger(vec2 uv, vec3 boxScale, float edgeWidth) {\n\n  float edgeXY =  smoothstep(0., edgeWidth, uv.x*boxScale.z) * smoothstep(0., edgeWidth, (1.-uv.x)*boxScale.z);\n  float edgeXZ =  smoothstep(0., edgeWidth, uv.y*boxScale.y) * smoothstep(0., edgeWidth, (1.-uv.y)*boxScale.y);\n  float edgeX = (1.-(edgeXY*edgeXZ))*abs(vNormalOrig.x);\n\n  float edgeYX =  smoothstep(0., edgeWidth, uv.x*boxScale.x) * smoothstep(0., edgeWidth, (1.-uv.x)*boxScale.x);\n  float edgeYZ =  smoothstep(0., edgeWidth, uv.y*boxScale.z) * smoothstep(0., edgeWidth, (1.-uv.y)*boxScale.z);\n  float edgeY = (1.-(edgeYX*edgeYZ))*abs(vNormalOrig.y);\n\n  float edgeZX =  smoothstep(0., edgeWidth, uv.x*boxScale.x) * smoothstep(0., edgeWidth, (1.-uv.x)*boxScale.x);\n  float edgeZY =  smoothstep(0., edgeWidth, uv.y*boxScale.z) * smoothstep(0., edgeWidth, (1.-uv.y)*boxScale.z);\n  float edgeZ = (1.-(edgeZX*edgeZY))*abs(vNormalOrig.z);\n\n  return clamp(edgeX, 0., 1.);\n}\n\nfloat edgerFeathered(vec2 uv, vec3 boxScale, float edgeWidth) {\n\n  float feather = .1;\n\n  float edgeXY =  smoothstep(edgeWidth, edgeWidth+feather, uv.x*boxScale.z) * smoothstep(edgeWidth, edgeWidth+feather, (1.-uv.x)*boxScale.z);\n  float edgeXZ =  smoothstep(edgeWidth, edgeWidth+feather, uv.y*boxScale.y) * smoothstep(edgeWidth, edgeWidth+feather, (1.-uv.y)*boxScale.y);\n  float edgeX = (1.-(edgeXY*edgeXZ))*abs(vNormalOrig.x);\n\n  //  float edgeYX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n  //  float edgeYZ =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n  //  float edgeY = (1.-(edgeYX*edgeYZ))*abs(vNormalOrig.y);\n  //\n  //  float edgeZX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n  //  float edgeZY =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n  //  float edgeZ = (1.-(edgeZX*edgeZY))*abs(vNormalOrig.z);\n\n  return clamp(edgeX, 0., 1.);\n}\n\nfloat edgerHard(vec2 uv, vec3 boxScale, float edgeWidth) {\n  float edgeXY =  step(edgeWidth*(1.+uv.x*boxScale.z), uv.x*boxScale.z) * step(edgeWidth, (1.-uv.x)*boxScale.z);\n  float edgeXZ =  step(edgeWidth*(0.5+uv.x/2.), uv.y*boxScale.y) * step(edgeWidth*(0.5+uv.x/2.), (1.-uv.y)*boxScale.y);\n  float edgeX = (1.-(edgeXZ))*abs(vNormalOrig.x);\n\n//  float edgeYX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n//  float edgeYZ =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n//  float edgeY = (1.-(edgeYX*edgeYZ))*abs(vNormalOrig.y);\n//\n//  float edgeZX =  step(edgeWidth, uv.x*boxScale.x) * step(edgeWidth, (1.-uv.x)*boxScale.x);\n//  float edgeZY =  step(edgeWidth, uv.y*boxScale.z) * step(edgeWidth, (1.-uv.y)*boxScale.z);\n//  float edgeZ = (1.-(edgeZX*edgeZY))*abs(vNormalOrig.z);\n\n  return clamp(edgeX, 0., 1.);\n}\n\nfloat fogFactorExp2(\n  const float dist,\n  const float density\n) {\n  const float LOG2 = -1.442695;\n  float d = density * dist;\n  return 1.0 - clamp(exp2(d * d * LOG2), 0.0, 1.0);\n}\n\nconst vec4 fogColor = vec4(1.0);\n\nvec4 packRGBA (float v) {\n  vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n  pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n  return pack;\n}\nfloat unpackRGBA (vec4 v) {\n  return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\n}\n\nvoid main () {\n\n  if (toBeDiscarded > .0) discard;\n\n  //if (length(vPosition.z) > stageGrid_size/2. - .5) discard;\n  //  vec3 hemisphereColor = hemisphere_light(vNormal, vec3(2., 2., 2.), vec3(.5,.5,.5), vec3(0.,1.,0.));\n\n  //  vec3 materialColor = (1. + vColorCorrection) * vDiffuseColor;\n  //  vec3 ambientColor = (ambientIntensity * vec3(1., 1., 1.) * materialColor).rgb;\n  //  vec3 lightingColor = 3. * ambientColor;\n  #ifdef shadow\n  gl_FragColor = vec4(vDiffuseColor.rgb, .2/vPosition.z/vPosition.z);//vec4(lightingColor,\n  #endif\n\n  #ifdef cubeShadow\n  gl_FragColor = packRGBA(gl_FragCoord.z);\n  #endif\n\n  #ifdef shadowMap\n  gl_FragColor = packRGBA(gl_FragCoord.z) + vec4(0.1);\n  #endif\n\n  #ifdef wireframe\n  float opacity = 1. - grid(b, .5);\n  gl_FragColor = vec4(1., 1., 1., .5*opacity);\n  #endif\n\n  #ifdef lighting\n\n  float ambientLightAmount = .75;\n  float diffuseLightAmount = .5;\n\n  // set the specular term to black\n  vec4 spec = vec4(0.0);\n\n  // normalize both input vectors\n  vec3 n = normalize(vNormal);\n  vec3 e = normalize(eye);\n  vec3 lightDirection = normalize(lightPosition);\n\n  vec4 specular = vec4(1.);\n  float shininess = .5;\n\n  float intensity = max(dot(n, lightDirection), 1.0);\n  if (intensity > 0.0) {\n    // compute the half vector\n    vec3 h = normalize(lightDirection + e);\n    // compute the specular term into spec\n    float intSpec = max(dot(h, n), 0.0);\n    spec = specular * pow(intSpec, shininess);\n  }\n\n  vec4 color;\n\n  //  color = (1. - vColorCorrection)  * max(intensity * vDiffuseColor + 0.*spec, vAmbientColor);\n\n  color  = (1. - 1. * vColorCorrection) * (1.*vDiffuseColor + 0.*vAmbientColor);\n\n  //  color = .5 * (1. - vColorCorrection) * vDiffuseColor + vAmbientColor;\n  //  vec3 ambient = ambientLightAmount * vDiffuseColor;\n  //  vec3 diffuse = diffuseLightAmount * vDiffuseColor * clamp(dot(vNormal, normalize(vec3(10., 10., 10.))) , 0.0, 1.0 ) +\n  //                  diffuseLightAmount * vDiffuseColor * clamp(dot(vNormal, normalize(vec3(-10., 10., -10.))) , 0.0, 1.0 ) ;\n  //\n  /*  float cosTheta2 = clamp(1. - 1. * cos(length(vPosition*20.)) , .9, 1.1 );\n    vec3 diffuse2 = 0.02 * vec3(1.) * clamp(cosTheta2 , 0.0, 1.0 ) ;\n    vec4 combinedDiffuse = clamp(vDiffuseColor * cosTheta2 , vec4(0.), vec4(1.));*/\n  //\n  //\n  ////  gl_FragColor =  vec4(pow( (1. - vColorCorrection) * (combinedDiffuse +  ambient), vec3(1.0/gamma)), 1.); //vec4(lightingColor, opacity);\n\n  //color = (1. - 1.* vColorCorrection) * ( vDiffuseColor);\n\n  vec3 lightPos = vLightNDC.xyz / vLightNDC.w;\n\n  float bias = 0.001;\n  float depth = lightPos.z - bias;\n  float occluder = unpackRGBA(texture2D(shadowMap, lightPos.xy));\n\n  // Compare actual depth from light to the occluded depth rendered in the depth map\n  // If the occluded depth is smaller, we must be in shadow\n  float shadow = mix(0.2, 1.0, step(depth, occluder));\n\n  //\n  //  vec3 texCoord = (vPosition - lightPosition);\n  //  float visibility = 0.0;\n  //   //do soft shadows:\n  //  for (int x = 0; x < 2; x++) {\n  //    for (int y = 0; y < 2; y++) {\n  //      for (int z = 0; z < 2; z++) {\n  //        float bias = 0.3;\n  ////        vec4 env = textureCube(cubeShadow, texCoord + vec3(x,y,z) * vec3(0.1));\n  //        vec3 lightPos = vLightNDC.xyz / vLightNDC.w;\n  //        float depth = lightPos.z - bias;\n  //\n  //        float occluder = unpackRGBA(texture2D(shadowMap,texCoord));\n  //\n  //        float shadow = mix(0.2, 1.0, step(depth, occluder));\n  //        visibility += shadow; //(env.x+bias) < (distance(vPosition, lightPos)) ? 0.0 : 1.0;\n  //      }\n  //    }\n  //  }\n  //  visibility *= 1.0 / 8.0;\n  //\n  //  visibility = 1.0;\n\n  shadow = 1.;\n\n  vec4 shadowedColor = shadow * color;\n  shadowedColor +=  smoothstep(10.,1.,length(vPosition-eye))  * color * vec4(edger(vUv, vScale, pathicleWidth*2.) * vec3(.7), 1.);\n\n  gl_FragColor =vec4(shadowedColor.rgb, 1.);\n\n//  const float FOG_DENSITY = .9;\n//  const vec4 FOG_COLOR = vec4(1.0, 1.0, 1.0, .8);\n//  float fogDistance = length(vPosition);\n//  float fogAmount = fogDistance > 9. ? fog_exp2(fogDistance - 9., FOG_DENSITY) : 0.;\n//\n//  vec4 faggedColor = mix(shadowedColor, FOG_COLOR, fogAmount);\n//\n//  gl_FragColor = vec4(faggedColor.rgb, 1.-fogAmount);\n\n  #endif// lighting\n\n}\n\n",Cl=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e};var Ml={create:function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},identity:gl,transpose:function(e,t){if(e===t){var n=t[1],i=t[2],o=t[3],r=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=r,e[11]=t[14],e[12]=o,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],y=n*s-i*a,b=n*l-o*a,w=n*c-r*a,x=i*l-o*s,_=i*c-r*s,C=o*c-r*l,M=u*m-h*p,P=u*v-f*p,S=u*g-d*p,E=h*v-f*m,T=h*g-d*m,A=f*g-d*v,O=y*A-b*T+w*E+x*S-_*P+C*M;if(!O)return null;return O=1/O,e[0]=(s*A-l*T+c*E)*O,e[1]=(o*T-i*A-r*E)*O,e[2]=(m*C-v*_+g*x)*O,e[3]=(f*_-h*C-d*x)*O,e[4]=(l*S-a*A-c*P)*O,e[5]=(n*A-o*S+r*P)*O,e[6]=(v*w-p*C-g*b)*O,e[7]=(u*C-f*w+d*b)*O,e[8]=(a*T-s*S+c*M)*O,e[9]=(i*S-n*T-r*M)*O,e[10]=(p*_-m*w+g*y)*O,e[11]=(h*w-u*_-d*y)*O,e[12]=(s*P-a*E-l*M)*O,e[13]=(n*E-i*P+o*M)*O,e[14]=(m*b-p*x-v*y)*O,e[15]=(u*x-h*b+f*y)*O,e},adjoint:function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15];return e[0]=s*(f*g-d*v)-h*(l*g-c*v)+m*(l*d-c*f),e[1]=-(i*(f*g-d*v)-h*(o*g-r*v)+m*(o*d-r*f)),e[2]=i*(l*g-c*v)-s*(o*g-r*v)+m*(o*c-r*l),e[3]=-(i*(l*d-c*f)-s*(o*d-r*f)+h*(o*c-r*l)),e[4]=-(a*(f*g-d*v)-u*(l*g-c*v)+p*(l*d-c*f)),e[5]=n*(f*g-d*v)-u*(o*g-r*v)+p*(o*d-r*f),e[6]=-(n*(l*g-c*v)-a*(o*g-r*v)+p*(o*c-r*l)),e[7]=n*(l*d-c*f)-a*(o*d-r*f)+u*(o*c-r*l),e[8]=a*(h*g-d*m)-u*(s*g-c*m)+p*(s*d-c*h),e[9]=-(n*(h*g-d*m)-u*(i*g-r*m)+p*(i*d-r*h)),e[10]=n*(s*g-c*m)-a*(i*g-r*m)+p*(i*c-r*s),e[11]=-(n*(s*d-c*h)-a*(i*d-r*h)+u*(i*c-r*s)),e[12]=-(a*(h*v-f*m)-u*(s*v-l*m)+p*(s*f-l*h)),e[13]=n*(h*v-f*m)-u*(i*v-o*m)+p*(i*f-o*h),e[14]=-(n*(s*v-l*m)-a*(i*v-o*m)+p*(i*l-o*s)),e[15]=n*(s*f-l*h)-a*(i*f-o*h)+u*(i*l-o*s),e},determinant:function(e){var t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],v=e[15];return(t*a-n*r)*(h*v-f*m)-(t*s-i*r)*(u*v-f*p)+(t*l-o*r)*(u*m-h*p)+(n*s-i*a)*(c*v-f*d)-(n*l-o*a)*(c*m-h*d)+(i*l-o*s)*(c*p-u*d)},multiply:function(e,t,n){var i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],v=t[13],g=t[14],y=t[15],b=n[0],w=n[1],x=n[2],_=n[3];return e[0]=b*i+w*s+x*h+_*m,e[1]=b*o+w*l+x*f+_*v,e[2]=b*r+w*c+x*d+_*g,e[3]=b*a+w*u+x*p+_*y,b=n[4],w=n[5],x=n[6],_=n[7],e[4]=b*i+w*s+x*h+_*m,e[5]=b*o+w*l+x*f+_*v,e[6]=b*r+w*c+x*d+_*g,e[7]=b*a+w*u+x*p+_*y,b=n[8],w=n[9],x=n[10],_=n[11],e[8]=b*i+w*s+x*h+_*m,e[9]=b*o+w*l+x*f+_*v,e[10]=b*r+w*c+x*d+_*g,e[11]=b*a+w*u+x*p+_*y,b=n[12],w=n[13],x=n[14],_=n[15],e[12]=b*i+w*s+x*h+_*m,e[13]=b*o+w*l+x*f+_*v,e[14]=b*r+w*c+x*d+_*g,e[15]=b*a+w*u+x*p+_*y,e},translate:function(e,t,n){var i,o,r,a,s,l,c,u,h,f,d,p,m=n[0],v=n[1],g=n[2];t===e?(e[12]=t[0]*m+t[4]*v+t[8]*g+t[12],e[13]=t[1]*m+t[5]*v+t[9]*g+t[13],e[14]=t[2]*m+t[6]*v+t[10]*g+t[14],e[15]=t[3]*m+t[7]*v+t[11]*g+t[15]):(i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=i,e[1]=o,e[2]=r,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=i*m+s*v+h*g+t[12],e[13]=o*m+l*v+f*g+t[13],e[14]=r*m+c*v+d*g+t[14],e[15]=a*m+u*v+p*g+t[15]);return e},scale:function(e,t,n){var i=n[0],o=n[1],r=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,n,i){var o,r,a,s,l,c,u,h,f,d,p,m,v,g,y,b,w,x,_,C,M,P,S,E,T=i[0],A=i[1],O=i[2],z=Math.sqrt(T*T+A*A+O*O);if(Math.abs(z)<1e-6)return null;T*=z=1/z,A*=z,O*=z,o=Math.sin(n),r=Math.cos(n),a=1-r,s=t[0],l=t[1],c=t[2],u=t[3],h=t[4],f=t[5],d=t[6],p=t[7],m=t[8],v=t[9],g=t[10],y=t[11],b=T*T*a+r,w=A*T*a+O*o,x=O*T*a-A*o,_=T*A*a-O*o,C=A*A*a+r,M=O*A*a+T*o,P=T*O*a+A*o,S=A*O*a-T*o,E=O*O*a+r,e[0]=s*b+h*w+m*x,e[1]=l*b+f*w+v*x,e[2]=c*b+d*w+g*x,e[3]=u*b+p*w+y*x,e[4]=s*_+h*C+m*M,e[5]=l*_+f*C+v*M,e[6]=c*_+d*C+g*M,e[7]=u*_+p*C+y*M,e[8]=s*P+h*S+m*E,e[9]=l*P+f*S+v*E,e[10]=c*P+d*S+g*E,e[11]=u*P+p*S+y*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e},rotateX:function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=r*o+c*i,e[5]=a*o+u*i,e[6]=s*o+h*i,e[7]=l*o+f*i,e[8]=c*o-r*i,e[9]=u*o-a*i,e[10]=h*o-s*i,e[11]=f*o-l*i,e},rotateY:function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],f=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=r*o-c*i,e[1]=a*o-u*i,e[2]=s*o-h*i,e[3]=l*o-f*i,e[8]=r*i+c*o,e[9]=a*i+u*o,e[10]=s*i+h*o,e[11]=l*i+f*o,e},rotateZ:function(e,t,n){var i=Math.sin(n),o=Math.cos(n),r=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=r*o+c*i,e[1]=a*o+u*i,e[2]=s*o+h*i,e[3]=l*o+f*i,e[4]=c*o-r*i,e[5]=u*o-a*i,e[6]=h*o-s*i,e[7]=f*o-l*i,e},fromRotation:function(e,t,n){var i,o,r,a=n[0],s=n[1],l=n[2],c=Math.sqrt(a*a+s*s+l*l);if(Math.abs(c)<1e-6)return null;return a*=c=1/c,s*=c,l*=c,i=Math.sin(t),o=Math.cos(t),r=1-o,e[0]=a*a*r+o,e[1]=s*a*r+l*i,e[2]=l*a*r-s*i,e[3]=0,e[4]=a*s*r-l*i,e[5]=s*s*r+o,e[6]=l*s*r+a*i,e[7]=0,e[8]=a*l*r+s*i,e[9]=s*l*r-a*i,e[10]=l*l*r+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:function(e,t,n){var i=t[0],o=t[1],r=t[2],a=t[3],s=i+i,l=o+o,c=r+r,u=i*s,h=i*l,f=i*c,d=o*l,p=o*c,m=r*c,v=a*s,g=a*l,y=a*c;return e[0]=1-(d+m),e[1]=h+y,e[2]=f-g,e[3]=0,e[4]=h-y,e[5]=1-(u+m),e[6]=p+v,e[7]=0,e[8]=f+g,e[9]=p-v,e[10]=1-(u+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromTranslation:Cl,fromXRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromQuat:function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=n+n,s=i+i,l=o+o,c=n*a,u=i*a,h=i*s,f=o*a,d=o*s,p=o*l,m=r*a,v=r*s,g=r*l;return e[0]=1-h-p,e[1]=u+g,e[2]=f-v,e[3]=0,e[4]=u-g,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=f+v,e[9]=d-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,i,o,r,a){var s=1/(n-t),l=1/(o-i),c=1/(r-a);return e[0]=2*r*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*r*l,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(o+i)*l,e[10]=(a+r)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*r*2*c,e[15]=0,e},perspective:bl,perspectiveFromFieldOfView:function(e,t,n,i){var o=Math.tan(t.upDegrees*Math.PI/180),r=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(o+r);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(o-r)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},ortho:function(e,t,n,i,o,r,a){var s=1/(t-n),l=1/(i-o),c=1/(r-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(o+i)*l,e[14]=(a+r)*c,e[15]=1,e},lookAt:yl,str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}},Pl=Ml.identity,Sl=Ml.multiply,El=Ml.rotate,Tl=Ml.fromQuat,Al=Ml.perspective,Ol=Ml.lookAt;function zl(e,{variables:t,model:n,view:i},o,r){const a=wl();Math.clip=function(e,t,n){return Math.max(t,Math.min(e,n))};let s=Pl([]);const l=l=>e({depth:!0,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"src alpha",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},color:[1,1,1,1]},cull:{enable:!1,face:"front"},elements:a.cells,instances:()=>n.particleCount*Math.min(t.tick.value,n.bufferLength),attributes:{aPosition:a.positions,aNormal:a.normals,aUV:a.uvs,aParticle:{buffer:e.buffer(Array(n.particleCount*n.bufferLength).fill(0).map((e,t)=>t%n.particleCount)),divisor:1},aColorCorrection:{buffer:e.buffer(Array(n.particleCount*n.bufferLength).fill(0).map((e,t)=>{const i=Math.sqrt(n.particleCount),o=t%n.particleCount,r=Math.floor(o/i)-i/2,a=((o%Math.sqrt(n.particleCount)-i/2)**2+r**2)/i**2;return s=1.25*Math.pow(Math.cos(2*a),2),l=.25,c=.5,Math.min(Math.max(s,l),c);var s,l,c})),divisor:1},aStep:{buffer:e.buffer(Array(n.particleCount*n.bufferLength).fill(0).map((e,t)=>Math.floor(t/n.particleCount))),divisor:1}},vert:[`#define ${l} 1`,xl].join("\n"),frag:[`#define ${l} 1`,_l].join("\n"),..."cubeShadow"===l&&{framebuffer:function(e,t,n){return r.fbo.faces[n]}},..."shadowMap"===l&&{framebuffer:o.fbo},uniforms:{..."shadowMap"===l&&{shadowViewMatrix:o.shadowViewMatrix,shadowProjectionMatrix:o.shadowProjectionMatrix},..."cubeShadow"===l&&{shadowViewMatrix:function(e,t,n){switch(n){case 0:return r.shadowViewMatrix_x;case 1:return r.shadowViewMatrix_x_;case 2:return r.shadowViewMatrix_y;case 3:return r.shadowViewMatrix_y_;case 4:return r.shadowViewMatrix_z;case 5:return r.shadowViewMatrix_z_}}},..."lighting"===l&&{cubeShadow:r.fbo},uResolution:[1,1],uLight:[1,1,0,1],ambientIntensity:i.ambientIntensity,utParticleColorAndType:()=>t.particleColorsAndTypes,utPositionBuffer:()=>t.position[0],viewRange:(e,t)=>t.viewRange||[0,1],lightPosition:i.lightPosition,shadowMap:o.fbo,shadowProjectionMatrix:r.shadowProjectionMatrix,shadowViewMatrix_top:r.shadowViewMatrix_y_,stageGrid_y:i.stageGrid.y,shadowColor:i.shadowColor,stageGrid_size:i.stageGrid.size/2,pathicleHeight:i.pathicleWidth*i.pathicleRelativeHeight,pathicleWidth:i.pathicleWidth,model:(e,t)=>Cl(s,[t.modelTranslateX||0,t.modelTranslateY||0,0])}});return{lighting:l("lighting"),shadow:l("shadow"),shadowMap:l("shadowMap"),cubeShadow:l("cubeShadow")}}class Rl{constructor(e,t){this.regl=e,this.fbo=e.framebufferCube({radius:1024,colorFormat:"rgba",colorType:"uint8"}),this.lightPosition=t,this.shadowViewMatrix_x=Ol([],t,[t[0]+1,t[1],t[2]],[0,-1,0]),this.shadowViewMatrix_x_=Ol([],t,[t[0]-1,t[1],t[2]],[0,-1,0]),this.shadowViewMatrix_y=Ol([],t,[t[0],t[1]+1,t[2]],[0,0,1]),this.shadowViewMatrix_y_=Ol([],t,[t[0],t[1]-1,t[2]],[0,0,-1]),this.shadowViewMatrix_z=Ol([],t,[t[0],t[1],t[2]+1],[0,-1,0]),this.shadowViewMatrix_z_=Ol([],t,[t[0],t[1],t[2]-1],[0,-1,0]),this.shadowProjectionMatrix=Al([],Math.PI/2,1,.25,70)}drawFbo(){return this.regl({vert:"\n      precision mediump float;\n      attribute vec2 position;\n      varying vec2 uv;\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform samplerCube texture;\n      varying vec2 uv;\n      float unpackRGBA (vec4 v) {\n        return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\n      }\n      void main () {\n        vec3 texCoord = vec3(uv.xy, 0.);\n        vec4 texel = vec4(unpackRGBA(textureCube(texture, texCoord)));\n        gl_FragColor = texel;\n      }",attributes:{position:[2,0,0,2,-2,-2]},uniforms:{texture:this.fbo},viewport:{x:(e,t,n)=>{},y:0,width:1024,height:1024},depth:{enable:!1},count:3})()}}class Fl{constructor(e,t){this.regl=e,this.fbo=e.framebuffer({radius:1024,colorFormat:"rgba",colorType:"uint8"}),this.lightPosition=t,this.shadowViewMatrix=Ol([],t,[t[0]-1,t[1],t[2]],[0,-1,0]),this.shadowProjectionMatrix=Al([],Math.PI/2,1,.25,70)}drawFbo(){return this.regl({vert:"\n      precision mediump float;\n      attribute vec2 position;\n      varying vec2 uv;\n      void main () {\n        uv = position;\n        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform sampler2D texture;\n      varying vec2 uv;\n      float unpackRGBA (vec4 v) {\n        return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\n      }\n      void main () {\n\n        // vec4 texel = vec4(unpackRGBA(texture2D(texture, uv)));\n        vec4 texel = texture2D(texture, uv);\n        gl_FragColor = texel; //vec4(uv,uv);\n      }",attributes:{position:[2,0,0,2,-2,-2]},uniforms:{texture:this.fbo},viewport:{x:0,y:0,width:1024,height:1024},depth:{enable:!0},count:3})()}}var Ll=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Dl=function(e,t){var n=t[0],i=t[1],o=t[2];return e[0]=n,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-o*o)),e};var kl=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Nl=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e};var Il=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Wl=function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var Vl=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Bl=function(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var r=(o+1)%3,a=(o+2)%3;n=Math.sqrt(t[3*o+o]-t[3*r+r]-t[3*a+a]+1),e[o]=.5*n,n=.5/n,e[3]=(t[3*r+a]-t[3*a+r])*n,e[r]=(t[3*r+o]+t[3*o+r])*n,e[a]=(t[3*a+o]+t[3*o+a])*n}return e};var Gl=function(e,t,n,i){var o=new Float32Array(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},Yl=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var jl=function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=n*n+i*i+o*o+r*r,s=a?1/a:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-o*s,e[3]=r*s,e};var Xl=function(e){var t=e[0],n=e[1],i=e[2],o=e[3];return Math.sqrt(t*t+n*n+i*i+o*o)};var Hl=function(e,t,n,i){var o=t[0],r=t[1],a=t[2],s=t[3];return e[0]=o+i*(n[0]-o),e[1]=r+i*(n[1]-r),e[2]=a+i*(n[2]-a),e[3]=s+i*(n[3]-s),e},Ul=function(e,t,n){var i=t[0],o=t[1],r=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+a*s+o*c-r*l,e[1]=o*u+a*l+r*s-i*c,e[2]=r*u+a*c+i*l-o*s,e[3]=a*u-i*s-o*l-r*c,e};var ql=function(e,t){var n=t[0],i=t[1],o=t[2],r=t[3],a=n*n+i*i+o*o+r*r;a>0&&(a=1/Math.sqrt(a),e[0]=n*a,e[1]=i*a,e[2]=o*a,e[3]=r*a);return e},Zl=function(e,t,n){n*=.5;var i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*s,e[1]=o*l+r*s,e[2]=r*l-o*s,e[3]=a*l-i*s,e};var $l=function(e,t,n){n*=.5;var i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l-r*s,e[1]=o*l+a*s,e[2]=r*l+i*s,e[3]=a*l-o*s,e};var Jl=function(e,t,n){n*=.5;var i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=o*l-i*s,e[2]=r*l+a*s,e[3]=a*l-r*s,e};var Ql=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]};var Kl=function(e){var t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)};var ec=function(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e};var tc=function(e,t,n){var i=Ql(t,n);return i<-.999999?(vl(nc,ic,t),Kl(nc)<1e-6&&vl(nc,oc,t),ml(nc,nc),ec(e,nc,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(vl(nc,t,n),e[0]=nc[0],e[1]=nc[1],e[2]=nc[2],e[3]=1+i,ql(e,e))},nc=[0,0,0],ic=[1,0,0],oc=[0,1,0];var rc=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e};var ac=function(e,t,n,i,o){return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e};var sc=function(e,t,n,i){return lc[0]=n[0],lc[3]=n[1],lc[6]=n[2],lc[1]=i[0],lc[4]=i[1],lc[7]=i[2],lc[2]=-t[0],lc[5]=-t[1],lc[8]=-t[2],ql(e,Bl(e,lc))},lc=function(){var e=new Float32Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}();var cc=function(e,t,n,i){var o,r,a,s,l,c=t[0],u=t[1],h=t[2],f=t[3],d=n[0],p=n[1],m=n[2],v=n[3];(r=c*d+u*p+h*m+f*v)<0&&(r=-r,d=-d,p=-p,m=-m,v=-v);1-r>1e-6?(o=Math.acos(r),a=Math.sin(o),s=Math.sin((1-i)*o)/a,l=Math.sin(i*o)/a):(s=1-i,l=i);return e[0]=s*c+l*d,e[1]=s*u+l*p,e[2]=s*h+l*m,e[3]=s*f+l*v,e};var uc=function(e,t,n,i,o,r){return cc(hc,t,o,r),cc(fc,n,i,r),cc(e,hc,fc,2*r*(1-r)),e},hc=[0,0,0,1],fc=[0,0,0,1];var dc={add:Ll,calculateW:Dl,clone:kl,conjugate:Nl,copy:Il,create:Wl,dot:Vl,fromMat3:Bl,fromValues:Gl,identity:Yl,invert:jl,length:Xl,lerp:Hl,multiply:Ul,normalize:ql,rotateX:Zl,rotateY:$l,rotateZ:Jl,rotationTo:tc,scale:rc,set:ac,setAxes:sc,setAxisAngle:ec,slerp:cc,sqlerp:uc,squaredLength:function(e){var t=e[0],n=e[1],i=e[2],o=e[3];return t*t+n*n+i*i+o*o}}.rotationTo;function pc(e,{variables:t,model:n,config:i}){const o=new Rl(e,i.view.lightPosition),r=new Fl(e,i.view.lightPosition),a={bufferLength:n.bufferLength,particleCount:n.particleCount,stepCount:n.stepCount||n.bufferLength,pathicleGap:i.view.pathicleRelativeGap*i.view.pathicleWidth,pathicleWidth:i.view.pathicleWidth,viewRange:e.prop("viewRange"),ambient:(e,t)=>new Array(3).fill(t.ambientIntensity),pointLightPosition:i.view.lights[0].position,lightPos:i.view.lightPosition,dt:2*n.halfDeltaTOverC,rgbGamma:i.view.rgbGamma},s=e({uniforms:a}),l=zl(e,{variables:t,model:n,view:i.view},r,o),c=function(e,t,n){const i=function(e,t,n,i,o){e=e||1,t=t||1,n=n||1,i=i||1;const r=!(!o||!o.quads)&&o.quads,a=[],s=[],l=[],c=[];for(let o=0;o<=i;o++)for(let u=0;u<=n;u++){const h=u/n,f=o/i,d=-e/2+h*e,p=t/2-f*t;a.push([d,0,p]),s.push([h,1-f]),l.push([0,0,1]),o<i&&u<n&&(r?c.push([o*(n+1)+u,(o+1)*(n+1)+u,(o+1)*(n+1)+u+1,o*(n+1)+u+1]):(c.push([o*(n+1)+u,(o+1)*(n+1)+u+1,o*(n+1)+u+1]),c.push([(o+1)*(n+1)+u+1,o*(n+1)+u,(o+1)*(n+1)+u])))}return{positions:a,normals:l,uvs:s,cells:c}}(t.stageGrid.size,t.stageGrid.size);return{lighting:e({blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,1]},cull:{enable:!0,face:"front"},depth:!1,primitive:"triangles",elements:i.cells,attributes:{position:i.positions},uniforms:{uOffset:[0,t.stageGrid.y,0],uResolution:[t.stageGrid.size,t.stageGrid.size],shadowMap:n.fbo,lightPosition:t.lightPosition,shadowProjectionMatrix:n.shadowProjectionMatrix,shadowViewMatrix:n.shadowViewMatrix},vert:"precision highp float;\n#define GLSLIFY 1\n\n#define FOG_DENSITY 0.2\n#define FOG_START 10.\n#define FOG_END 20.\nfloat fogFactorLinear(\n  const float dist,\n  const float start,\n  const float end\n) {\n  return 1.0 - clamp((end - dist) / (end - start), 0.0, 1.0);\n}\n\nfloat fogFactorExp2(\n  const float dist,\n  const float density\n) {\n  const float LOG2 = -1.442695;\n  float d = density * dist;\n  return 1.0 - clamp(exp2(d * d * LOG2), 0.0, 1.0);\n}\n\nattribute vec3 position;\n//\nuniform vec3 uOffset;\nuniform mat4 projection;\nuniform mat4 view;\n//\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying float fogAmount;\n\nuniform mat4 shadowViewMatrix;\nuniform mat4 shadowProjectionMatrix;\nvarying vec4 vLightNDC;\n// Matrix to shift range from -1->1 to 0->1\nconst mat4 depthScaleMatrix = mat4(\n0.5, 0, 0, 0,\n0, 0.5, 0, 0,\n0, 0, 0.5, 0,\n0.5, 0.5, 0.5, 1\n);\n\nvoid main () {\n  //  vUv = uv / 1.;\n  vPosition = position + uOffset;\n\n  vLightNDC = depthScaleMatrix * shadowProjectionMatrix * shadowViewMatrix  * vec4(vPosition, 1.0);\n\n  gl_Position = projection * view * vec4(vPosition, 1.);\n\n  float fogDistance = length(vPosition.xyz);\n  fogAmount = fogFactorExp2(fogDistance, FOG_DENSITY);\n  fogAmount = fogFactorLinear(fogDistance, FOG_START, FOG_END);\n}\n",frag:"precision highp float;\n#define TRANSPARENT\n#extension GL_OES_standard_derivatives : enable\n#define GLSLIFY 1\n\nfloat fogFactorExp2(\n  const float dist,\n  const float density\n) {\n  const float LOG2 = -1.442695;\n  float d = density * dist;\n  return 1.0 - clamp(exp2(d * d * LOG2), 0.0, 1.0);\n}\n\n#define SQRT2 1.41421356\n#define PI 3.14159\n\nvec3 mainColor = vec3(.7, .7, .7);\nvec3 lineColor = vec3(.2, .2, .2);\nvec4 gridControl = vec4(.1, 10., .5, .99);\nvec3 gridOffset = vec3(0., 0., 0.);\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nfloat getVisibility(float position) {\n  float majorGridFrequency=gridControl.y;\n  if (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n  {\n    return 1.0;\n  }\n  return gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\n  const float maxNumberOfLines=4.0;\n  return clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines, 0.0, 1.0);\n}\nfloat isPointOnLine(float position, float differentialLength) {\n  float fractionPartOfPosition = position-floor(position+0.5);\n  fractionPartOfPosition/=differentialLength;\n  fractionPartOfPosition=clamp(fractionPartOfPosition, -1., 1.);\n  float result=0.5+0.5*cos(fractionPartOfPosition*PI);\n  return result;\n}\nfloat contributionOnAxis(float position) {\n  float differentialLength=length(vec2(dFdx(position), dFdy(position)));\n  differentialLength*=SQRT2;\n  float result=isPointOnLine(position, differentialLength);\n  float visibility=getVisibility(position);\n  result*=visibility;\n  float anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\n  result*=anisotropicAttenuation;\n  return result;\n}\nfloat normalImpactOnAxis(float x) {\n  float normalImpact=clamp(1.0-3.0*abs(x*x*x), 0.0, 1.0);\n  return normalImpact;\n}\n\nvoid main(void) {\n  float gridRatio=gridControl.x;\n  vec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n  float x=contributionOnAxis(gridPos.x);\n  float y=contributionOnAxis(gridPos.y);\n  float z=contributionOnAxis(gridPos.z);\n  vec3 normal=normalize(vNormal);\n  //  x*=normalImpactOnAxis(normal.x);\n  //  y*=normalImpactOnAxis(normal.y);\n  //  z*=normalImpactOnAxis(normal.z);\n  float grid=clamp(x+y+z, 0., 1.);\n  vec3 color=mix(mainColor, lineColor, grid);\n  float opacity=1.0;\n  opacity=clamp(grid, 0.08, gridControl.w*grid);\n  gl_FragColor=vec4(color.rgb, opacity);\n}\n\n"})}}(e,i.view,r),u=function(e,t){const n=new Float32Array(16);return e({frag:"\n      precision highp float;\n      uniform vec3 axis;\n      void main () {\n        gl_FragColor = vec4(axis,1);\n      }\n    ",vert:"\n      precision highp float;\n      uniform mat4 projection, view, model;\n      uniform vec3 eye, center;\n      attribute vec3 position;\n      void main () {\n        gl_Position = projection * view * model * vec4(position,1);\n      }\n    ",uniforms:{axis:e.prop("axis"),model:function(e,t){Pl(n);El(n,n,0,t.axis);var i=new Float32Array(16),o=[0,0,0,0];return dc(o,[0,1,0],t.axis),Tl(i,o),Sl(n,n,i),n}},attributes:{position:[[0,0,0],[0,t-.1,0],[.05,t-.2,0],[0,t,0],[-.05,t-.2,0],[0,t-.1,0]],axis:e.prop("axis")},depth:{enable:!1},count:6,primitive:"line strip"})}(e,1),h=function(e){return{lighting:e({blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,1]},frag:"precision highp float;\n#define GLSLIFY 1\n\n// Based on distance functions found at:\n// http://iquilezles.org/www/articles/distfunctions/distfunctions.htm\nfloat sdSquare(vec2 point, float width) {\n  vec2 d = abs(point) - width;\n  return min(max(d.x,d.y),0.0) + length(max(d,0.0));\n}\n\nfloat vignette(vec2 uv, vec2 size, float roundness, float smoothness) {\n  // Center UVs\n  uv -= 0.5;\n\n  // Shift UVs based on the larger of width or height\n  float minWidth = min(size.x, size.y);\n  uv.x = sign(uv.x) * clamp(abs(uv.x) - abs(minWidth - size.x), 0.0, 1.0);\n  uv.y = sign(uv.y) * clamp(abs(uv.y) - abs(minWidth - size.y), 0.0, 1.0);\n\n  // Signed distance calculation\n  float boxSize = minWidth * (1.0 - roundness);\n  float dist = sdSquare(uv, boxSize) - (minWidth * roundness);\n\n  return 1. - smoothstep(0.0, smoothness, dist);\n}\n\nuniform vec2 screenSize;\nuniform vec2 size;\nuniform float roundness;\nuniform float smoothness;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.xy / screenSize;\n  float v = vignette(uv, size, roundness, smoothness);\n  gl_FragColor = vec4(vec3(v), 1.-v);\n}\n",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    void main() {\n      gl_Position = vec4(position, 0, 1);\n    }",attributes:{position:e.buffer([-4,-4,4,-4,0,4])},uniforms:{color:[1,1,0,1],screenSize:({viewportWidth:e,viewportHeight:t})=>[e,t],size:[.1,.1],roundness:.5,smoothness:.9},count:3,depth:{enable:!0}})}}(e);return{destroy:()=>{},drawDiffuse:function(t){s(i.view,()=>{e.clear({color:[1,1,1,1],depth:1,framebuffer:r.fbo}),u([{axis:[1,0,0]},{axis:[0,1,0]},{axis:[0,0,1]}]),l.lighting(t),i.view.isStageVisible&&c.lighting(t),h.lighting(t)})},cubeShadow:o,shadow:r}}var mc=function(e,t,n,i,o,r){var a,s,l,c,u=n.length,h=n[0].length;if(t<1)throw new Error("degree must be at least 1 (linear)");if(t>u-1)throw new Error("degree must be less than or equal to point count - 1");if(!o)for(o=[],a=0;a<u;a++)o[a]=1;if(i){if(i.length!==u+t+1)throw new Error("bad knot vector length")}else{i=[];for(a=0;a<u+t+1;a++)i[a]=a}var f=[t,i.length-1-t],d=i[f[0]],p=i[f[1]];if((e=e*(p-d)+d)<d||e>p)throw new Error("out of bounds");for(l=f[0];l<f[1]&&!(e>=i[l]&&e<=i[l+1]);l++);var m,v=[];for(a=0;a<u;a++){for(v[a]=[],s=0;s<h;s++)v[a][s]=n[a][s]*o[a];v[a][h]=o[a]}for(c=1;c<=t+1;c++)for(a=l;a>l-t-1+c;a--)for(m=(e-i[a])/(i[a+t+1-c]-i[a]),s=0;s<h+1;s++)v[a][s]=(1-m)*v[a-1][s]+m*v[a][s];for(r=r||[],a=0;a<h;a++)r[a]=v[l][a]/v[l][h];return r},vc={MAX_CANVAS_SIZE:512,MAX_PARTICLE_COUNT:512,MAX_BUFFER_LENGTH:256,logPushing:!1,logPerformance:!1,stats:!1,profile:!1,colors:[[.92,.75,0],[.12,.45,.65],[.12,.45,.65],[.77,.2,.2]],mass:[0,510998.94,510998.94,938272081],charge:[0,-1,1,1],chargeMassRatio:[0,-175882004556.243,175882004556.243,95788332.3113771],pusher:"boris",simulateHalfFloat:!1,runner:{prerender:!1,loops:1,mode:"framewise",stepsPerTick:4,stepCount:127},model:{bufferLength:128,tickDurationOverC:.5,boundingBoxSize:-1,emitter:{particleType:"ELECTRON",randomize:!1,bunchShape:"square",particleCount:128,particleSeparation:.15,gamma:0,position:[0,0,0],direction:[0,0,1],directionJitter:[0,0,0],positionJitter:[0,0,0]},interactions:{particleInteraction:!1,gravityConstant:0,electricField:[0,0,0],magneticField:[0,0,0]},lattice:{elements:{},beamline:[]}},view:{lightPosition:[0,2,0],ssaoEnabled:!1,stageGrid:{y:0,size:20,dark:1,light:.8},sky:[.9,1,0,1],shadowColor:[.8,.8,.8,1],ambientIntensity:.6,diffuse:0,exposure:.2,fresnel:1,fxaa:!1,rgbGamma:1,isStageVisible:!0,isShadowEnabled:!1,isLatticeVisible:!1,pathicleRelativeGap:2,pathicleRelativeHeight:10,pathicleWidth:.002,roughness:.7,specular:1,ssaoBlurPower:2,ssaoBlurRadius:.1,ssaoPower:1,ssaoSampleCount:32,showTextures:!0,texelSize:1,viewRange:[0,1],lights:[{position:[0,1,0],direction:[1,1,0],color:new Array(3).fill(0)},{position:[0,1,0],direction:[-1,-1,0],color:new Array(3).fill(0)}],camera:{position:[1,1,0],target:[0,1,0],fovY:2*Math.PI/7.2,dTheta:.001,autorotate:!1,rotateAboutCenter:!0,zoomAboutCursor:!1,zoomDecayTime:.1,far:50,near:1e-4,minDistance:.1,maxDistance:10}},dumpData:!1};const gc="DRIF",yc="SBEN",bc="QUAD",wc={name:"story-dipole",view:{camera:{position:[0,1.5,7],target:[0,1.5,0]}},model:{emitter:{particleType:"ELECTRON ELECTRON",bunchShape:"SQUARE",direction:[0,.25,-1],position:[2,-2,0],particleSeparation:.15,directionJitter:[0,0,0],positionJitter:[0,.1,0],gamma:1.55},interactions:{magneticField:[0,0,0],particleInteraction:!1},lattice:{elements:{l:{type:gc,l:0},d:{type:yc,l:20,strength:.001}},beamline:["l","d"],origin:{phi:0,position:[0,0,-10]}}}},xc={name:"story-electric",view:{camera:{position:[2.5,2,-2.5],target:[0,2.1,0]}},model:{emitter:{particleType:"ELECTRON PROTON PHOTON",bunchShape:"SQUARE",position:[0,2,-10],direction:[0,0,1],directionJitter:[0,0,0],positionJitter:[.1,.1,0],gamma:1.2},interactions:{electricField:[0,0,-1e-11],particleInteraction:!1,magneticField:[0,0,0]},lattice:{elements:{},beamline:[],origin:{phi:0,position:[0,1,-6]}}}},_c={name:"story-quadrupole",view:{camera:{position:[5,1,5],target:[0,1,0]}},model:{tickDurationOverC:.2,emitter:{particleType:"PROTON ",bunchShape:"SQUARE_YZ",direction:[1,0,0],position:[-10,2,0],directionJitter:[.2,.2,0],positionJitter:[0,0,0],gamma:3},lattice:{elements:{q1:{type:bc,strength:1,l:1},q2:{type:bc,strength:-1,l:1},l1:{type:gc,l:10},l2:{type:gc,l:1},l3:{type:gc,l:2}},beamline2:["l1","q1","q2","l1","q3","q4","l1"],beamline:["l1","q1","l2","q2","l3","q1","l2","q2","l1"],origin:{phi:-Math.PI/2,position:[-10,0,0]}}}},Cc={name:"random",view:{camera:{position:[5,1,-5],target:[0,.2,0]}},runner:{prerender:!1,loops:10,mode:"framewise",stepsPerTick:8,stepCount:128},model:{boundingBoxSize:2,bufferLength:64,tickDurationOverC:.1,emitter:{randomize:!0,gamma:2,particleCount:512,particleType:"PHOTON ELECTRON PROTON"}}},Mc={name:"free-electron",view:{camera:{position:[2.5,.2,2.5],target:[0,0,0]}},runner:{prerender:!1,loops:0,mode:"framewise",stepsPerTick:1,stepCount:11},model:{bufferLength:11,tickDurationOverC:.1,emitter:{particleCount:1,particleType:"ELECTRON",bunchShape:"SQUARE",direction:[0,0,1],position:[0,.01,0],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:100},interactions:{electricField:[0,0,0],particleInteraction:!1,magneticField:[0,0,0]}}};var Pc={name:"gyrotest-1-electron",view:{camera:{position:[3,3,0],target:[0,0,0]}},runner:{stepsPerTick:8,stepCount:83},model:{bufferLength:128,tickDurationOverC:.1,emitter:{particleCount:1,particleType:"ELECTRON",bunchShape:"SQUARE",direction:[0,0,1],position:[-1,0,0],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:1.55},lattice:{elements:{l0:{type:yc,l:20,strength:.002}},beamline:["l0"],origin:{phi:0,position:[0,0,-10]}}}};const Sc={name:"free-photon",view:{camera:{position:[2.5,.2,2.5],target:[0,0,0]}},runner:{prerender:!1,loops:0,mode:"framewise",stepsPerTick:1,stepCount:11},model:{bufferLength:11,tickDurationOverC:.1,emitter:{particleCount:1,particleType:"PHOTON",bunchShape:"SQUARE",direction:[0,0,1],position:[0,0,0],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:0},interactions:{electricField:[0,0,.01],particleInteraction:!1,magneticField:[0,0,0]}}},Ec={name:"free-photons",view:{camera:{position:[2.5,.2,2.5],target:[0,0,0]}},runner:{prerender:!0,loops:1,mode:"framewise",stepsPerTick:8,stepCount:200},model:{bufferLength:200,tickDurationOverC:.1,emitter:{particleCount:484,particleType:"PHOTON",bunchShape:"SQUARE",direction:[0,0,1],position:[0,1,-10],directionJitter:[0,0,0],positionJitter:[0,0,0],gamma:1},interactions:{electricField:[0,0,0],particleInteraction:!1,magneticField:[0,0,0]}}};let Tc=(...e)=>{let t={},n=e=>{for(let n in e)e.hasOwnProperty(n)&&("[object Object]"===Object.prototype.toString.call(e[n])?t[n]=Tc(t[n],e[n]):t[n]=e[n])};for(let t=0;t<e.length;t++)n(e[t]);return t};const Ac={[wc.name]:wc,[xc.name]:xc,[_c.name]:_c,[Mc.name]:Mc,[Sc.name]:Sc,[Ec.name]:Ec,[Cc.name]:Cc,[Pc.name]:Pc};function Oc(e,t,n){return e.texture({width:t,height:n,min:"nearest",mag:"nearest",format:"rgba",type:"float32",data:new Float32Array(t*n*4)})}function zc(e,t,n,i){let o=0;t.forEach((n,i)=>{var r;n.presetName=n.preset,n.preset=(r=n.preset,Tc(!0,vc,Ac[r])||vc),n.particleCount=n.preset.model.emitter.particleCount,n.bufferLength=n.preset.model.bufferLength||128,n.position=[Oc(e,n.particleCount,n.bufferLength)],n.particleColorsAndTypes=e.texture({data:Array(4*n.particleCount),shape:[n.particleCount,1,4]}),n.data&&n.data().then(({data:e})=>{performance.mark("scene data"),n.position[0]({width:n.particleCount,height:n.bufferLength,min:"nearest",mag:"nearest",format:"rgba",data:new Float32Array(e.position.map(e=>e/1))}),n.particleColorsAndTypes({data:e.particleTypes.map(e=>n.preset.colors[e].concat(e)).flat(),shape:[n.particleCount,1,4],type:"float"})}),n.variables={referencePoint:[0,0,0],pingPong:0,tick:{value:n.bufferLength},position:n.position,particleColorsAndTypes:n.particleColorsAndTypes},n.model={halfDeltaTOverC:n.preset.model.tickDurationOverC/2,particleCount:n.particleCount,particleTypes:n.data?n.data.particleTypes:[],bufferLength:n.bufferLength,stepCount:n.preset.runner.stepCount,boundingBoxSize:n.preset.model.boundingBoxSize,interactions:{gravityConstant:n.preset.model.interactions.gravityConstant,particleInteraction:n.preset.model.interactions.particleInteraction,electricField:n.preset.model.interactions.electricField,magneticField:n.preset.model.interactions.magneticField}},n._s=i,n._t0=o,n._t0_normalized=o/t.duration,n._t1=o+n.duration,n._t1_normalized=n._t1/t.duration,o=n._t1,n.cameraSploints&&n.cameraSploints.position&&(n.cameraPositionBSpline=e=>mc(e,2,n.cameraSploints.position),n.cameraSploints.target&&(n.cameraTargetBSpline=e=>mc(e,2,n.cameraSploints.target)))});const r={sceneIdx:0,scene:t[0]},a={};function s(e){e>1&&(e=1);const n=(t.find(t=>t._t0_normalized<=e&&e<=t._t1_normalized)||{_s:0})._s;return n!==r.sceneIdx&&n>=0&&n<t.length?(a.sceneIdx={from:r.sceneIdx,to:n},r.sceneIdx=n,r.scene=t[n]):delete a.sceneIdx,r.activeSceneProgress=(e-r.scene._t0_normalized)*t.duration/r.scene.duration,r.viewRange=r.activeSceneProgress<.5?[0,2*r.activeSceneProgress]:[2*r.activeSceneProgress-1,1],Object.keys(a).length>0}let l=0;s(l);const c={setPosition:function(e){l=e;return s(e)&&i&&i(r,a),c},getPosition:function(){return l},getState:function(){return r}};return c}class Rc{constructor({canvas:e,pixelRatio:t,control:n}){this.config=vc,this.control=n,createREGL({canvas:e,attributes:{preserveDrawingBuffer:!0,antialiasing:!0},pixelRatio:t,extensions:["angle_instanced_arrays","oes_texture_float","OES_standard_derivatives","OES_texture_half_float","WEBGL_depth_texture"],onDone:(e,t)=>{if(e)return console.error(e);try{this.regl=t,this.init(t),this.run(t)}catch(e){console.error(e)}}})}destroy(){this.regl.destroy()}init(e){this.regl._commands=[],this.initStory(),this.initCameras(),this.loopTick=-1,this.view=pc(e,{variables:this.variables,model:this.model,config:this.config})}initStory(){this.story=zc(this.regl,this.control.scenes,0,e=>{e.scene.position&&(this.variables.position=e.scene.position),e.scene.particleColorsAndTypes&&(this.variables.particleColorsAndTypes=e.scene.particleColorsAndTypes)}),this.story.setPosition(0),this.variables=this.control.scenes[0].variables,this.model=this.story.getState().scene.model}initCameras(){this.cameras=[],this.setCameraUniforms=[],[this.cameras.guided,this.setCameraUniforms.guided]=function({scenes:e,camera:t},n){const i={mView:new Float32Array(16),mProj:new Float32Array(16),vSky:new Float32Array([0,1,0]),vEye:new Float32Array(3),pEye:new Float32Array(3),vUp:new Float32Array(3),pTarget:new Float32Array(3),toConfig:()=>i},o=t.fovY,r=n({uniforms:{eye:(e,{scene:t,activeSceneProgress:n})=>(i.pEye=t.cameraPositionBSpline(Math.min(n,1)),i.pTarget=t.cameraTargetBSpline(Math.min(n,1)),pl(i.vEye,i.pTarget,i.pEye),i.pEye),view:(e,{scene:t,activeSceneProgress:n})=>(i.pEye=t.cameraPositionBSpline(Math.min(n,1)),i.pTarget=t.cameraTargetBSpline(Math.min(n,1)),pl(i.vEye,i.pTarget,i.pEye),ml(i.vUp,vl(i.vUp,vl(i.vUp,i.vEye,i.vSky),i.vEye)),yl(i.mView,i.pEye,i.pTarget,i.vUp),i.mView),projection:e=>{const n=e.viewportWidth/e.viewportHeight;return yl(i.mView,i.pEye,i.pTarget,i.vUp),bl(i.mProj,o,n,t.near,t.far),i.mProj}}});return[i,r]}({scenes:this.story.scenes,...this.config.view},this.regl),this.camera=this.cameras.guided,this.modelTranslateX=0,this.modelTranslateY=0}run(e){(()=>{e.frame(()=>{const t=this.story.getState();let n,i;t.scene.pathicles&&"story-loop"===t.scene.pathicles.preset?(this.loopTick>=128&&(this.modelTranslateX=.1*(Math.random()-.5),this.modelTranslateY=.1*(Math.random()-.5)),this.loopTick=this.loopTick<128?this.loopTick+1:0,n=this.loopTick<16?this.loopTick/32:this.loopTick>96?(this.loopTick-96)/32+.5:.5,i=n<.5?[0,2*n]:[2*n-1,1]):(n=t.activeSceneProgress,i=t.viewRange,this.modelTranslateX=0,this.modelTranslateY=0),this.setCameraUniforms[this.control.cameraMode]({...this.cameras[this.control.cameraMode],scene:t.scene,activeSceneProgress:n},()=>{e.clear({color:[1,1,1,1],depth:1}),this.view.drawDiffuse({modelTranslateX:this.modelTranslateX,modelTranslateY:this.modelTranslateY,viewRange:i})})})})()}}var Fc={name:"PathiclesStory",props:{story:{type:Object,default:{scenes:[{type:"caption",title:"<strong>Wir&nbsp;beschleunigen</strong>",subtitle_1_1:"<strong>Teilchen</strong> in&nbsp;unseren&nbsp;Berufen",subtitle_1_2:"<strong>und die Beschleunigerphysik</strong> im Berufsverband.",image:"/images/story/story-electric.jpg",pathicles:{preset:"story-loop",data:"story-electric.js",camera:{position:[-2,1.5,2],target:[0,1.5,0]}}},{type:"caption",title:"Beschleunigung<br><strong>macht&nbsp;schneller</strong>.",body:'Elektrische Kräfte wirken sich auf Photonen, Elektronen und Protonen verschieden aus: Masselose <span class="photon">Photonen</span> sind immer mit Lichtgeschwindigkeit unterwegs, daran ändert auch eine Kraft nichts.  <span class="electron">Elektronen</span> werden rasch auf Fast-Lichtgeschwindigkeit beschleunigt, erreichen diese aber nie ganz. <span class="proton">Protonen</span> sind schwerer und brauchen etwas länger, um in Fahrt zu kommen.\n',image:"/images/story/story-electric.jpg",scene_index:1,pathicles:{preset:"story-electric",data:"story-electric.js",camera:{position:[-2,1.5,0],target:[0,1.5,0]}}},{type:"caption",title:"Beschleunigung<br><strong>hält&nbsp;auf&nbsp;Spur</strong>.",scene_index:2,body:"Magnetfelder wirken senkrecht zur Geschwindigkeit geladener Teilchen, die dadurch ihre Richtung ändern. Gleichförmige Magnetfelder führen zu einer Kreisbahn und kommen etwa in Ringbeschleunigern zum Einsatz.\n",image:"/images/story/story-dipole.jpg",pathicles:{preset:"story-dipole",data:"story-dipole.js",camera:{position:[2,1.5,2],target:[0,1.5,0]}}},{type:"caption",title:"Beschleunigung<br><strong>schafft Zusammenhalt</strong>.",scene_index:3,body:"Magnetfelder, deren Stärke mit Abstand zur optimalen Teilchenbahn zunimmt, wirken wie optische Linsen: In einer Ebene bringen sie die Teilchen zusammen, in der dazu senkrechten Ebene jedoch auseinander. In modernen Beschleunigern sorgen hunderte solcher Bündelungsmagnete für den Zusammenhalt.\n",image:"/images/story/story-quadrupole.jpg",pathicles:{preset:"story-quadrupole",data:"story-quadrupole.js",camera:{position:[2,1.5,2],target:[0,1.5,0]}}},{type:"options",pathicles:{preset:"story-empty",camera:{position:[1,5,0],target:[-1,0,0]}}}]}},scrollFactor:{type:Number,default:1}},data:()=>({screenWidth:600,canvasWidth:600,canvasHeight:600,screenHeight:600,storyHeight:500,progress:0,activeSceneProgress:0,vp:null,cameraMode:"guided",viewRange:[0,0],activeScene:0,maxPixelRatio:2}),mounted(){this.story.scenes.forEach(e=>{e.duration=e.duration||(e.type&&e.type,1)}),this.story.scenes.duration=this.story.scenes.reduce((e,t)=>e+t.duration,0),this.story.scenes.forEach((e,t)=>{e.pathicles&&e.pathicles.data&&("story-quadrupole.js"===e.pathicles.data?e.data=()=>import("./story-quadrupole.81132af4.js").then(e=>e):"story-dipole.js"===e.pathicles.data?e.data=()=>import("./story-dipole.5d756283.js").then(e=>e):e.data=()=>import("./story-electric.b5779590.js").then(e=>e)),e.cameraSploints={position:e.pathicles.camera?[0,1,2,3].map(()=>e.pathicles.camera.position):[...[0,1].map(()=>this.story.scenes[t-1].pathicles.camera.position),...[2,3].map(()=>this.story.scenes[t+1].pathicles.camera.position)],target:e.pathicles.camera?[0,1,2,3].map(()=>e.pathicles.camera.target):[...[0,1].map(()=>this.story.scenes[t-1].pathicles.camera.target),...[2,3].map(()=>this.story.scenes[t+1].pathicles.camera.target)]}}),fl(this.handleViewportChange),this.reglInstance=new Rc({canvas:this.$refs.canvas,pixelRatio:this.pixelRatio,control:{viewRange:this.viewRange,cameraMode:this.cameraMode,scenes:this.story.scenes}}),this.$nextTick(()=>{this.storyHeight=this.$refs.scrollContainer.clientHeight})},computed:{pixelRatio(){return!window||Math.min(this.maxPixelRatio,window.devicePixelRatio)},canvasStyles(){return{width:this.screenWidth+"px",height:this.screenHeight+"px"}},canvasWidth(){return this.screenWidth*this.pixelRatio},canvasHeight(){return this.screenHeight*this.pixelRatio}},unmounted(){"undefined"!=typeof window&&window.document&&(this.reglInstance.destroy(),dl(this.handleViewportChange))},methods:{handleViewportChange({size:e,scroll:t}){var n;e.changed&&(this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.storyHeight=this.$refs.scrollContainer.clientHeight),t.changed&&(this.progress=(n=(t.top+this.screenHeight)/this.storyHeight)<0?0:n<1?n:1,this.reglInstance&&(this.reglInstance.story.setPosition(this.progress),this.activeScene=this.reglInstance.story.getState().sceneIdx,this.activeSceneProgress=this.reglInstance.story.getState().activeSceneProgress.toFixed(2)))}}};const Lc={class:"debug debug-only"},Dc={class:"canvas-container",ref:"canvasContainer"},kc={class:"scenes"},Nc={key:0,class:"scene-content-wrapper options"},Ic={class:"scene-main"},Wc={key:0,class:"subtitle"},Vc={key:1,class:"subtitle"},Bc={class:"body"};Fc.render=function(e,t,n,i,o,r){return $t(),Qt("div",{class:"pathicles-story__container",ref:"scrollContainer","data-active-scene":e.activeScene},[on("div",Lc,h(e.vp),1),on("div",Dc,[on("canvas",{ref:"canvas",style:r.canvasStyles,width:r.canvasWidth,height:r.canvasHeight},null,12,["width","height"]),sn("  .scene-backgrounds    "),sn(" .scene-background(v-for='(scene, sceneIndex) in story.scenes'"),sn("        :style=\"scene.image ? {'background-image': 'url(' + scene.image  + ')'} : {}\" :class=\"'pathicles-story__scene-background--' + sceneIndex\") &nbsp;"),sn("    .scene-captions"),sn("      .scene-caption("),sn("        v-for='(scene, sceneIndex) in story.scenes'"),sn('        :data-scene="sceneIndex")'),sn("        .scene-caption-header"),sn("          .scene-caption-title"),sn("            span.pathicles(v-html='scene.caption_title')"),sn("          .scene-caption-body"),sn("            p(v-html='scene.body')")],512),on("div",kc,[($t(!0),Qt(jt,null,_i(n.story.scenes,(t,n)=>($t(),Qt("div",{class:["scene",t.type],id:"scrolly-story__scene--"+n,style:{height:100*t.duration+"vh"},key:"scene-"+n,"data-scene":n,"data-active":n===e.activeScene,"data-status":n===e.activeScene?"present":n<e.activeScene?"past":"future"},["options"===t.type?($t(),Qt("div",Nc,[sn('        .option(slot-key="option-1")'),sn('        .option(slot-key="option-2")'),sn('        .option(slot-key="option-3")')])):sn("v-if",!0),"caption"===t.type?($t(),Qt("div",{key:1,class:"scene-content-wrapper",id:"scrolly-story__scene-content-wrapper--"+n,style:{opacity2:n===e.activeScene?1-4*e.activeSceneProgress:1}},[on("div",Ic,[on("div",{class:"title","data-index":t.scene_index},[t.title?($t(),Qt("span",{key:0,class:"pathicles",innerHTML:t.title},null,8,["innerHTML"])):sn("v-if",!0)],8,["data-index"]),t.subtitle_1_1?($t(),Qt("div",Wc,[on("span",{class:"pathicles",innerHTML:t.subtitle_1_1},null,8,["innerHTML"])])):sn("v-if",!0),t.subtitle_1_2?($t(),Qt("div",Vc,[on("span",{class:"pathicles",innerHTML:t.subtitle_1_2},null,8,["innerHTML"])])):sn("v-if",!0),on("div",Bc,[on("p",{innerHTML:t.body},null,8,["innerHTML"])])])],12,["id"])):sn("v-if",!0)],14,["id","data-scene","data-active","data-status"]))),128))])],8,["data-active-scene"])},Fc.__file="src/components/PathiclesStory.vue";const Gc=function(e){const t=Bo(e.routes,e);let n=e.parseQuery||lr,i=e.stringifyQuery||cr,{scrollBehavior:o}=e,r=e.history;const a=hr(),s=hr(),l=hr(),c=et(To,!0);let u=To;to&&o&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=io.bind(null,e=>""+e),f=io.bind(null,ar),d=io.bind(null,sr);function p(e,o){if(o=no({},o||c.value),"string"==typeof e){let i=ao(n,e,o.path),a=t.resolve({path:i.path},o),s=r.createHref(i.fullPath);return no(i,a,{params:d(a.params),hash:sr(i.hash),redirectedFrom:void 0,href:s})}let a;"path"in e?a=no({},e,{path:ao(n,e.path,o.path).path}):(a=no({},e,{params:f(e.params)}),o.params=f(o.params));let s=t.resolve(a,o);const l=e.hash||"";s.params=h(d(s.params));const u=function(e,t){let n=t.query?e(t.query):"";return t.path+(n&&"?")+n+(t.hash||"")}(i,no({},e,{hash:(p=l,or(p).replace(tr,"{").replace(ir,"}").replace(Ko,"^")),path:s.path}));var p;let m=r.createHref(u);return no({fullPath:u,hash:l,query:i===cr?ur(e.query):e.query},s,{redirectedFrom:void 0,href:m})}function m(e){return"string"==typeof e?{path:e}:no({},e)}function v(e,t){if(u!==e)return Ro(8,{from:t,to:e})}function g(e){return y(e)}function y(e,t){const n=u=p(e),o=c.value,r=e.state,a=e.force,s=!0===e.replace,l=n.matched[n.matched.length-1];if(l&&l.redirect){const{redirect:e}=l;let i=m("function"==typeof e?e(n):e);return y(no({query:n.query,hash:n.hash,params:n.params},i,{state:r,force:a,replace:s}),t||n)}const h=n;let f;return h.redirectedFrom=t,!a&&function(e,t,n){let i=t.matched.length-1,o=n.matched.length-1;return i>-1&&i===o&&lo(t.matched[i],n.matched[o])&&co(t.params,n.params)&&e(t.query)===e(n.query)&&t.hash===n.hash}(i,o,n)&&(f=Ro(16,{to:h,from:o}),O(o,o,!0,!1)),(f?Promise.resolve(f):w(h,o)).catch(e=>Fo(e,14)?e:T(e)).then(e=>{if(e){if(Fo(e,2))return y(no(m(e.to),{state:r,force:a,replace:s}),t||h)}else e=_(h,o,!0,s,r);return x(h,o,e),e})}function b(e,t){const n=v(e,t);return n?Promise.reject(n):Promise.resolve()}function w(e,t){let n;const[i,o,r]=function(e,t){const n=[],i=[],o=[],r=Math.max(t.matched.length,e.matched.length);for(let a=0;a<r;a++){const r=t.matched[a];r&&(e.matched.indexOf(r)<0?n.push(r):i.push(r));const s=e.matched[a];s&&t.matched.indexOf(s)<0&&o.push(s)}return[n,i,o]}(e,t);n=dr(i.reverse(),"beforeRouteLeave",e,t);for(const o of i)for(const i of o.leaveGuards)n.push(fr(i,e,t));const l=b.bind(null,e,t);return n.push(l),br(n).then(()=>{n=[];for(const i of a.list())n.push(fr(i,e,t));return n.push(l),br(n)}).then(()=>{n=dr(o,"beforeRouteUpdate",e,t);for(const i of o)for(const o of i.updateGuards)n.push(fr(o,e,t));return n.push(l),br(n)}).then(()=>{n=[];for(const i of e.matched)if(i.beforeEnter&&t.matched.indexOf(i)<0)if(Array.isArray(i.beforeEnter))for(const o of i.beforeEnter)n.push(fr(o,e,t));else n.push(fr(i.beforeEnter,e,t));return n.push(l),br(n)}).then(()=>(e.matched.forEach(e=>e.enterCallbacks={}),n=dr(r,"beforeRouteEnter",e,t),n.push(l),br(n))).then(()=>{n=[];for(const i of s.list())n.push(fr(i,e,t));return n.push(l),br(n)}).catch(e=>Fo(e,8)?e:Promise.reject(e))}function x(e,t,n){for(const i of l.list())i(e,t,n)}function _(e,t,n,i,o){const a=v(e,t);if(a)return a;const s=t===To,l=to?history.state:{};n&&(i||s?r.replace(e.fullPath,no({scroll:s&&l&&l.scroll},o)):r.push(e.fullPath,o)),c.value=e,O(e,t,n,s),A()}let C;function M(){C=r.listen((e,t,n)=>{const i=p(e);u=i;const o=c.value;var a,s;to&&(a=_o(o.fullPath,n.delta),s=wo(),Co.set(a,s)),w(i,o).catch(e=>Fo(e,12)?e:Fo(e,2)?(n.delta&&r.go(-n.delta,!1),y(e.to,i).catch(oo),Promise.reject()):(n.delta&&r.go(-n.delta,!1),T(e))).then(e=>{(e=e||_(i,o,!1))&&n.delta&&r.go(-n.delta,!1),x(i,o,e)}).catch(oo)})}let P,S=hr(),E=hr();function T(e){return A(e),E.list().forEach(t=>t(e)),Promise.reject(e)}function A(e){P||(P=!0,M(),S.list().forEach(([t,n])=>e?n(e):t()),S.reset())}function O(e,t,n,i){if(!to||!o)return Promise.resolve();let r=!n&&function(e){const t=Co.get(e);return Co.delete(e),t}(_o(e.fullPath,0))||(i||!n)&&history.state&&history.state.scroll||null;return wt().then(()=>o(e,t,r)).then(e=>e&&xo(e)).catch(T)}const z=e=>r.go(e);let R;const F=new Set;return{currentRoute:c,addRoute:function(e,n){let i,o;return Eo(e)?(i=t.getRecordMatcher(e),o=n):o=e,t.addRoute(o,i)},removeRoute:function(e){let n=t.getRecordMatcher(e);n&&t.removeRoute(n)},hasRoute:function(e){return!!t.getRecordMatcher(e)},getRoutes:function(){return t.getRoutes().map(e=>e.record)},resolve:p,options:e,push:g,replace:function(e){return g(no(m(e),{replace:!0}))},go:z,back:()=>z(-1),forward:()=>z(1),beforeEach:a.add,beforeResolve:s.add,afterEach:l.add,onError:E.add,isReady:function(){return P&&c.value!==To?Promise.resolve():new Promise((e,t)=>{S.add([e,t])})},install(e){e.component("RouterLink",mr),e.component("RouterView",yr),e.config.globalProperties.$router=this,Object.defineProperty(e.config.globalProperties,"$route",{get:()=>tt(c)}),to&&!R&&c.value===To&&(R=!0,g(r.location).catch(e=>{}));const t={};for(let e in To)t[e]=bi(()=>c.value[e]);e.provide(Ki,this),e.provide(eo,je(t));let n=e.unmount;F.add(e),e.unmount=function(){F.delete(e),F.size<1&&(C(),c.value=To,R=!1,P=!1),n.call(this,arguments)}}}}({history:function(e){const t=So(e=go(e)),n=function(e,t,n,i){let o=[],r=[],a=null;const s=({state:r})=>{const s=Mo(e,location),l=n.value,c=t.value;let u=0;if(r){if(n.value=s,t.value=r,a&&a===l)return void(a=null);u=c?r.position-c.position:0}else i(s);o.forEach(e=>{e(n.value,l,{delta:u,type:fo.pop,direction:u?u>0?mo.forward:mo.back:mo.unknown})})};function l(){const{history:e}=window;e.state&&e.replaceState(no({},e.state,{scroll:wo()}),"")}return window.addEventListener("popstate",s),window.addEventListener("beforeunload",l),{pauseListeners:function(){a=n.value},listen:function(e){o.push(e);const t=()=>{const t=o.indexOf(e);t>-1&&o.splice(t,1)};return r.push(t),t},destroy:function(){for(const e of r)e();r=[],window.removeEventListener("popstate",s),window.removeEventListener("beforeunload",l)}}}(e,t.state,t.location,t.replace),i=no({location:"",base:e,go:function(e,t=!0){t||n.pauseListeners(),history.go(e)},createHref:bo.bind(null,e)},t,n);return Object.defineProperty(i,"location",{get:()=>t.location.value}),Object.defineProperty(i,"state",{get:()=>t.state.value}),i}(),routes:[{path:"/",redirect:"/simulator"},{path:"/simulator",component:ol},{path:"/story",component:Fc}]});((...e)=>{const t=(Ui||(Ui=Xn(Hi))).createApp(...e),{mount:n}=t;return t.mount=e=>{const i=function(e){if(A(e)){return document.querySelector(e)}return e}(e);if(!i)return;const o=t._component;T(o)||o.render||o.template||(o.template=i.innerHTML),i.innerHTML="";const r=n(i);return i.removeAttribute("v-cloak"),i.setAttribute("data-v-app",""),r},t})(qi).use(Gc).mount("#app");
